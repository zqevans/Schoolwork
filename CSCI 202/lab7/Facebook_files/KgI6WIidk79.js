/*1369421084,173220647*/

if (self.CavalryLogger) { CavalryLogger.start_js(["x18sW"]); }

__d("TickerReadStateTracking",["Style","clickRefAction"],function(a,b,c,d,e,f){var g=b('Style'),h=b('clickRefAction'),i=73,j='ticker_hover',k=[];function l(n){var o=JSON.parse(n.getAttribute('data-ft'));if(!o)return null;if(o.mf_story_key)return o.mf_story_key;if(o.fbid)return o.fbid;return null;}function m(n){var o=l(n);if(!o||o in k)return;k[o]=true;var p={evt:i};h(j,n,null,'FORCE',{ft:p});}e.exports.log=m;});
__d("TickerRightHideController",["CSS","DOM","ge"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('ge');function j(){}j._markAsClosedHelper=function(k){var l=i('pagelet_reminders');if(l){var m=h.scry(l,'div.tickerToggleWrapper')[0];if(m)g.conditionClass(m,'displayedTickerToggleWrapper',k);}var n=i('pagelet_moments');if(n){var o=h.scry(n,'div.tickerToggleWrapper')[0];if(o)g.conditionClass(o,'displayedTickerToggleWrapper',k);}var p=i('pagelet_rhc_ticker');if(p){var q=h.scry(p,'div.tickerToggleWrapper')[0];if(q)g.conditionClass(q,"displayedTickerToggleWrapper",!k);g.conditionClass(p,"hidden_rhc_ticker",k);}};j.markAsClosed=function(){j._markAsClosedHelper(true);};j.markAsUnclosed=function(){j._markAsClosedHelper(false);};e.exports=j;});
__d("legacy:TickerRightHideController",["TickerRightHideController"],function(a,b,c,d){a.TickerRightHideController=b('TickerRightHideController');},3);
__d("TickerController",["Event","Animation","Arbiter","AsyncRequest","AsyncSignal","Bootloader","ChannelConstants","LegacyContextualDialog","CSS","DOM","HTML","JSLogger","Keys","LayerFadeOnHide","LiveTimer","NavigationMessage","Parent","Run","ScrollableArea","SelectorDeprecated","Style","TickerReadStateTracking","Toggler","UIPagelet","URI","UserActivity","UserAgent","Vector","$","clickRefAction","collectDataAttributes","copyProperties","cx","emptyFunction","ge","goURI","throttle","userAction","TickerRHCPageletByGK"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Animation'),i=b('Arbiter'),j=b('AsyncRequest'),k=b('AsyncSignal'),l=b('Bootloader'),m=b('ChannelConstants'),n=b('LegacyContextualDialog'),o=b('CSS'),p=b('DOM'),q=b('HTML'),r=b('JSLogger'),s=b('Keys'),t=b('LayerFadeOnHide'),u=b('LiveTimer'),v=b('NavigationMessage'),w=b('Parent'),x=b('Run'),y=b('ScrollableArea'),z=b('SelectorDeprecated'),aa=b('Style'),ba=b('TickerReadStateTracking'),ca=b('Toggler'),da=b('UIPagelet'),ea=b('URI'),fa=b('UserActivity'),ga=b('UserAgent'),ha=b('Vector'),ia=b('$'),ja=b('clickRefAction'),ka=b('collectDataAttributes'),la=b('copyProperties'),ma=b('cx'),na=b('emptyFunction'),oa=b('ge'),pa=b('goURI'),qa=b('throttle'),ra=b('userAction'),sa=1,ta=2,ua=3,va=4,wa=r.create('ticker_controller');function xa(){}la(xa,{_instances:{},_activeInstance:null,_placeholders:{},_logPositionChange:false,getInstance:function(ya){var za=w.byClass(ia(ya),'fbFeedTicker');return za?xa._instances[za.id]:null;},isLoaded:function(ya){var za=xa._placeholders[ya.id];return !za||za.status==ua;},show:function(ya,za){za=za||na;for(var ab in xa._instances){var bb=oa(ab);if(!bb||bb.parentNode.id==ya.id)continue;xa.hide(bb.parentNode);}xa._doPositionChange(ya);o.show(ya);var cb=xa._placeholders[ya.id];if(cb&&cb.status==sa){xa._fetchTickerForPlaceholder(ya,za);}else{var db=p.scry(ya,'.fbFeedTicker')[0],eb=db&&xa.getInstance(db);xa._activeInstance=eb;eb&&eb._poll();xa._placeholders[ya.id]={status:va,callback:za};za();}},_doPositionChange:function(ya){if(!xa._logPositionChange||o.shown(ya))return;new k('/common/ods_endpoint.php',{k:'ticker.render.switch.'+ya.id}).send();},hide:function(ya){var za=p.scry(ya,'.fbFeedTicker')[0],ab=za&&xa.getInstance(za);ab&&ab.hideActiveStory();o.hide(ya);},hideStoriesByClass:function(ya){for(var za in xa._instances)p.scry(ia(za),ya).forEach(o.hide);},hideStory:function(ya){var za=ya&&xa.getInstance(ya);za&&za.hideStory(ya);},undoHideStory:function(ya){var za=ya&&xa.getInstance(ya);za&&za.undoHideStory(ya);},insertStoriesAtBottom:function(ya){xa._activeInstance.insertStoriesAtBottom(ya);},_fetchTickerForPlaceholder:function(ya,za){var ab={handler:function(){xa._placeholders[ya.id].status=ua;za();}},bb=b('TickerRHCPageletByGK'),cb=bb.pagelet_name;da.loadFromEndpoint(cb,ya.id,xa._placeholders[ya.id].pageletData,ab);xa._placeholders[ya.id].status=ta;},registerStoryDialog:function(ya,za){i.subscribe('ticker/init',function(){var ab=oa(ya),bb=ab&&xa.getInstance(ab);bb&&bb.registerStoryDialog(ab,za);},i.SUBSCRIBE_ALL);},registerPlaceholder:function(ya,za){var ab=xa._placeholders[ya];xa._placeholders[ya]={status:sa,pageletData:za};if(ab&&ab.status==va){xa.show(ia(ya));ab.callback();}}});la(xa.prototype,{ADS_IDLE_MS:300000,FLYOUT_MAX_HEIGHT:450,FLYOUT_OFFSET_THRESHOLD:20,FLYOUT_COMMENT_OFFSET:15,FLYOUT_VIEWPORT_PADDING:75,FLYOUT_TARGET_HEIGHT_OFFSET:25,init:function(ya,za,ab){xa._instances[ya.id]=this;xa._activeInstance=this;this._root=ya;this._content=p.find(ya,'.ticker_stream');this._stories=p.find(this._root,'.tickerActivityStories');this._scrollableArea=za;this._container=p.find(ya,'div.uiScrollableAreaWrap');this._newestStory={};this._storyIDs=[];this._objectIDs=[];this._fetchedStories={};this._removedStoryIDs=[];this._storiesToRemove=[];var bb=Date.now();this._initTime=bb;this._lastUpdate=bb;this._lastPull=bb;this._lastInsert=bb;this._lastCustomStory=0;this._pollOnly=false;this._needNonCustomStoryNum=0;this._doCustomUpdate=true;this._autoloadStoryIndex=1;this._scrollTopThreshold=100;this._scrollTopPrompt=p.find(this._root,'.scrollTopPrompt');this._scrollTopPromptVisible=false;this._maxStoriesToKeep=50;this._minStoriesToKeep=25;this._tickerInSidebarMode=!!w.byClass(this._root,'fbChatSidebar');this._loadStoriesWithActions();ja('ticker_flyout');ja('ticker_flyout_prefetch');ja('ticker_flyout_loadtime');ja('ticker_stream');this._ua={flyout:ra('ticker').uai('flyout','flyout',false),flyout_prefetch:ra('ticker').uai('flyout_prefetch','flyout_prefetch',false),flyout_loadtime:ra('ticker').uai('ticker_flyout_loadtime','flyout_loadtime',false),stream:ra('ticker').uai('ticker_stream','stream',false)};this._uaCurStoryIDFetch=null;this._uaCurStoryIDPrefetch=null;var cb=p.create('div',{className:'storyQueue hidden_elem'});this._storyQueue=cb;p.appendContent(this._root,cb);this._initObjectIDs();this._initConfig(ab);this._resetMorePager();this._initListeners();this._initSubscriptions(ab);i.inform('ticker/init',this,i.BEHAVIOR_PERSISTENT);this._poll();if(this._prefetchAfterLoad){this._logUserEvent('stream','prefetch');this._fetchStories(this._getInsertedStories().slice(0,5));}},_loadStoriesWithActions:function(){var ya=oa('rightCol');if(!ya)return;this._toggleWrapper=p.scry(ya,'.tickerToggleWrapper')[0];if(this._toggleWrapper){var za=p.scry(this._stories,'.tickerStoryWithButton');this._storiesWithActions={};for(var ab=0;ab<za.length;ab++){var bb=za[ab];this._storiesWithActions[bb.getAttribute('data-story-key')]=bb;}}},_initConfig:function(ya){la(this,{_newest:ya.newest,_page_newest:ya.newest,_timeout:ya.timeout,_heartbeatTimeout:Math.min(5000,ya.heartbeatTimeout),_maxHeartbeatTimeout:Math.max(30000,ya.maxHeartbeatTimeout),_pullTimeout:Math.max(30000,ya.pullTimeout),_insertTimeout:ya.insertTimeout,_friendCount:ya.friendCount,_maxQueueLength:ya.maxQueueLength,_heartbeatEndpoint:ya.heartbeatEndpoint,_noPoll:ya.nopoll,_maxCustomQueueLength:ya.maxCustomQueueLength,_customStoryInsertTimeout:Math.max(5000,ya.customStoryInsertTimeout),_nonCustomToCustomStoryRatio:ya.nonCustomToCustomStoryRatio,_minForceUpdateInterval:Math.max(ya.insertTimeout,ya.minForceUpdateInterval),_popupOnHover:ya.popupOnHover,_priorityAppId:ya.priorityAppId,_prefetchOnHover:ya.prefetchStoriesOnHover,_userIdleTimeout:ya.userIdleTimeout,_firstCustomStoryDelay:ya.firstCustomStoryDelay,_pollOnly:ya.pollOnly,_tickerSource:ya.tickerSource,_prefetchAfterLoad:ya.prefetchAfterLoad,_logFlyouts:ya.logFlyouts,_userScrollGaurdDelay:ya.userScrollGaurdDelay,_rescheduleScrollToTopDelay:ya.rescheduleScrollToTopDelay,_aggressiveRegulator:ya.aggressiveRegulator});this._queueCustomStories(ya.customStories);},_initListeners:function(){this._listeners=g.listen(this._root,{click:this._handleClick.bind(this),keydown:this._handleKeydown.bind(this),mouseout:this._handleMouseout.bind(this),mouseover:this._handleMouseover.bind(this),mousedown:this._tickerDeClicker.bind(this),mouseup:this._handleMouseup.bind(this)});this._listeners.scroll=g.listen(this._container,'scroll',this._handleScroll.bind(this));this._initInfiniteScrollListener.bind(this).defer();},_initSubscriptions:function(ya){x.onLeave(this._cleanup.bind(this));this._subscriptions=[i.subscribe(v.NAVIGATION_BEGIN,this._onNavHandler.bind(this)),i.subscribe('composer/publish',this._handleComposerPublish.bind(this)),i.subscribe('Ticker/storiesInserted',this._handleStoriesInserted.bind(this)),i.subscribe('Ticker/fixed',this._setFixed.bind(this,true)),i.subscribe('Ticker/unfixed',this._setFixed.bind(this,false)),i.subscribe('Ticker/resized',this._checkInfiniteScroll.bind(this)),i.subscribe('ufi/comment',this._scrollDialogToBottom.bind(this)),i.subscribe('Ticker/chatOpened',this._handleChatOpened.bind(this))];if(!ya.pollOnly)this._subscriptions.push(i.subscribe(m.getArbiterType('ticker_update'),this._handleTickerPush.bind(this)));if(ya.pushChannel&&!ya.pollOnly)this.setPushChannel(ya.pushChannel);},_handleClick:function(event){var ya=event.getTarget();if(this._getButtonFromNode(ya)){this._logUserAction(ya,'click',event);this._handleActionButton(event);return;}var za=this._getStoryFromNode(ya),ab=w.byClass(ya,'tickerStoryAllowClick');if(!za||za==this._selectedStory||ab)return;if(this._storyIsHidden(za))return;if(za==this._activeStory&&!this._selectedStory)this._selecting=true;this._clearNux();this._logUserEvent('flyout','click');this._logUserEvent('flyout_loadtime','open');if(this._storyCanOpenExternally(za)){var bb=za.getAttribute('data-href');if(bb&&!ya.getAttribute('href')){var cb={href:bb},db=ka(ya,['ft','gt']);ja('click',cb,event,'FORCE',db);ra('ticker',cb,event).uai('click');}else this._logUserAction(ya,'click',event);this._openStoryExternally(za,event);return;}this._logUserAction(ya,'flyout',event);this._activateStory(za,'click');this._selectStory(za);},_handleMouseover:function(event){this._setLocked(true);var ya=event.getTarget(),za=this._getOpenableStory(ya);if(!za)return;event.kill();if(this._prefetchOnHover||this._popupOnHover){if(!(za.id in this._fetchedStories)){this._logUserEvent('flyout_prefetch','prefetch_on_hover');this._uaCurStoryIDPrefetch=za.id;}this._fetchStory(za);}if(this._selectedStory)return;if(this._popupOnHover){this._clearHoverTimeouts();var ab=this._storyCanOpenExternally(za)?500:1000,bb=this._activeStory?75:ab;this._hoverShowTimeout=this._setTimeout(function(){this._logUserEvent('flyout','hover',bb);this._logUserEvent('flyout_loadtime','open');this._activateStory(za,'hover');this._logUserAction(ya,'flyout',event);}.bind(this),bb);}},_handleMouseout:function(event){var ya=event.getTarget();this._setLocked(false);if(ya==this._getStoryFromNode(ya)){var za=p.scry(ya.parentNode,'.openToggler');for(var ab=0;ab<za.length;ab++)z.toggle(za[ab]);}this._clearClickedStory();this._scheduleHide();},_handleKeydown:function(event){this._tickerDeClicker(event);var ya=this._activeStory;if(!ya)return;var za=g.getKeyCode(event);switch(za){case s.UP:case s.DOWN:var ab=this._getInsertedStories(),bb;if(event.getModifiers().any){bb=za===s.UP?0:ab.length-1;}else bb=ab.indexOf(ya)+(za===s.UP?-1:1);ya=ab[bb];break;case s.ESC:this._deactivateStory(true);return;default:return;}event.kill();if(!ya)return;this._activateStory(ya,'keypress');this._selectStory(ya);},_fadeTopmostStoryButton:function(){var ya=0,za=15;if(this._storiesWithActions)for(var ab in this._storiesWithActions){var bb=this._storiesWithActions[ab],cb=p.scry(bb,'.tickerInlineActionButton')[0],db=p.scry(cb,'.tickerActionIcon')[0],eb=ha.getElementPosition(cb).y-ha.getElementPosition(this._toggleWrapper).y;if(eb<ya){aa.set(cb,'opacity',0);aa.set(db,'opacity',0);}else if(eb>=ya&&eb<za){var fb=(eb-ya)/(za-ya);aa.set(cb,'opacity',fb);aa.set(db,'opacity',fb);break;}else{aa.set(cb,'opacity',1);aa.set(db,'opacity',1);}}},_handleScroll:function(){if(!this._preventScrollDismiss){this._deactivateStory(true);}else this._preventScrollDismiss=false;if(!this._handleScrollThrottled)this._handleScrollThrottled=qa(this._handleScrollInner.bind(this));this._handleScrollThrottled();},_handleScrollInner:function(){this._fadeTopmostStoryButton();this._checkInfiniteScroll();this._setIsUserScrolling();if(!this._scrollLogged){this._scrollLogged=true;var ya=this._stories.childNodes.length,za=this._stories.getAttribute('data-gt'),ab={ticker_scroll:1,number_stories:ya,source:za};ja('scroll',null,null,'FORCE',{gt:ab});ra('ticker').uai('scroll');}},_setIsUserScrolling:function(){clearTimeout(this._userScrollingToken);if(this._isScrolledToTop()){this._userScrolling=false;return;}this._userScrolling=true;this._userScrollingToken=setTimeout(function(){this._userScrolling=false;this._userScrollingToken=null;}.bind(this),this._userScrollGaurdDelay);},_isUserScrolling:function(){return this._userScrolling;},_handleStoriesInserted:function(){this._initInfiniteScrollListener();if(this._scrollableArea instanceof y){this._scrollableArea.adjustGripper();}else wa.error('wrong_scrollable_area',{dump:this});this._logUserEvent('stream','insert');},_handleActionButton:function(event){var ya=event.getTarget(),za=this._getOpenableStory(ya),ab=this._getStoryDialog(za);if(ab)var bb=ab.subscribe('beforehide',function(){ab.unsubscribe(bb);return false;});},_handleScrollToTopClick:function(){this._scrollToTop(this._poll.bind(this));},_scheduleScrollToTop:function(){this._scrollToTopToken&&clearTimeout(this._scrollToTopToken);this._scrollToTopToken=setTimeout(function(){if(this._isLocked()||this._isUserScrolling()){this._scheduleScrollToTop();}else{this._scrollToTopToken=null;this._scrollToTop();}}.bind(this),this._rescheduleScrollToTopDelay);},_scrollToTop:function(ya){new h(this._container).to('scrollTop',0).ease(h.ease.end).ondone(ya).go();},_clearHoverTimeouts:function(){clearTimeout(this._hoverShowTimeout);clearTimeout(this._hoverHideTimeout);},_getAllStories:function(){return p.scry(this._root,'div.fbFeedTickerStory');},_getInsertedStories:function(){return this._getAllStories().filter(function(ya){return !o.hasClass(ya,'queuedStory')&&!o.hasClass(ya,'customStory');});},_getQueuedStories:function(){return p.scry(this._storyQueue,'.fbFeedTickerStory.queuedStory');},_getQueuedCustomStories:function(){return p.scry(this._storyQueue,'.fbFeedTickerStory.customStory');},_getButtonFromNode:function(ya){return w.byClass(ya,'tickerInlineOverlay');},_getStoryFromNode:function(ya){return w.byClass(ya,'fbFeedTickerStory');},_getActionButtonFromStory:function(ya){return p.scry(ya,'.tickerInlineActionButton')[0];},_getOpenableStory:function(ya){var za=this._getStoryFromNode(ya);return this._storyCanOpenDialog(za)?za:null;},_getStoryDialog:function(ya){return n.getInstance(ya);},_getStoryDialogEndpoint:function(ya){return ya&&ya.getAttribute('data-rel')=='async'&&ya.getAttribute('data-ajaxify')||null;},_storyCanOpenDialog:function(ya){return !!this._getStoryDialogEndpoint(ya)&&!this._storyIsHidden(ya);},_storyCanOpenExternally:function(ya){return !!ya.getAttribute('data-href')||!this._storyCanOpenDialog(ya);},_storyIsHidden:function(ya){return o.hasClass(ya,'tickerStoryHidden');},hideActiveStory:function(){this._activeStory&&this.hideStory(this._activeStory);},hideStory:function(ya){this._deactivateStory();if(p.getText(ya)==='')p.remove(ya);o.addClass(ya,'tickerStoryHidden');o.removeClass(ya,'tickerStoryClickable');},undoHideStory:function(ya){o.addClass(ya,'tickerStoryClickable');o.removeClass(ya,'tickerStoryHidden');},insertStoriesAtBottom:function(ya){if(!ya)return;var za=p.create('div');za.appendChild(ya);var ab=p.scry(za,'.fbFeedTickerStory'),bb=p.find(za,'.tickerMorePager'),cb=[];for(var db=0;db<ab.length;db++)if(!this.dedupeStory(ab[db]))cb.push(ab[db]);if(cb.length){cb.push(bb);p.replace(p.find(this._root,'.tickerMorePager'),cb);}i.inform('Ticker/storiesInserted');},_scheduleHide:function(){if(this._popupOnHover&&!this._selectedStory){this._clearHoverTimeouts();this._hoverHideTimeout=this._setTimeout(this._deactivateStory.bind(this),100);}},_setScrollTopPromptVisible:function(ya){this._scrollTopPromptVisible=ya;o.conditionShow(this._scrollTopPrompt,ya);if(ya&&!this._listeners.scrollTop){this._listeners.scrollTop=g.listen(this._scrollTopPrompt,{click:this._handleScrollToTopClick.bind(this)});}else if(!ya&&this._listeners.scrollTop){this._listeners.scrollTop.click.remove();this._listeners.scrollTop=null;}},_isUserIdle:function(){return !fa.isActive(this._userIdleTimeout);},_schedulePoll:function(){clearTimeout(this._pollToken);this._pollToken=this._setTimeout(this._poll.bind(this),this._timeout);},_poll:function(){if(!this._isTickerVisible())return;if(this._storiesToRemove.length>0){if(this._isInsertingStory)return this._schedulePoll();var ya=this._storiesToRemove.pop();this.removeStory(ya);}var za=!this._isScrolledToTop()&&this._getQueuedStories().length;this._setScrollTopPromptVisible(za);var ab=Date.now(),bb=ab-this._lastInsert;if(bb<this._insertTimeout||this._isLocked())return this._schedulePoll();var cb=this._getQueuedStories(),db=this._getQueuedCustomStories(),eb=this._isUserIdle(),fb=cb.length>0,gb=db.length>0&&!eb&&(ab-this._initTime>this._firstCustomStoryDelay)&&(this._needNonCustomStoryNum===0||(!fb&&(ab-this._lastCustomStory)>this._customStoryInsertTimeout));if(gb){this.insertStory(db.shift());this._lastCustomStory=ab;this._needNonCustomStoryNum=this._nonCustomToCustomStoryRatio;return this._schedulePoll();}if(fb){this.insertStory(cb.shift());this._needNonCustomStoryNum--;if(this._needNonCustomStoryNum<0)this._needNonCustomStoryNum=0;return this._schedulePoll();}if(eb)return fa.subscribeOnce(this._poll.bind(this));var hb=db.length===0&&this._needNonCustomStoryNum===0&&this._nonCustomToCustomStoryRatio>0&&fa.isActive(this.ADS_IDLE_MS)&&((ab-this._lastUpdate)>this._minForceUpdateInterval),ib=false,jb=false;if(this._pollOnly){jb=ab-this._lastUpdate>this._heartbeatTimeout;}else ib=(ab-this._lastPull>this._pullTimeout);var kb=(hb&&this._doCustomUpdate)||ib||jb;if(!kb)return this._schedulePoll();if(hb)this._doCustomUpdate=false;this.update({pull:ib,fullpoll:jb,needcustomstory:hb});},_updatePollOnlyHeartbeatTimeout:function(){if(this._pollOnly&&this._heartbeatTimeout<this._maxHeartbeatTimeout)this._heartbeatTimeout=Math.min(this._heartbeatTimeout+5000,this._maxHeartbeatTimeout);},update:function(ya){this._updatePollOnlyHeartbeatTimeout();if(this._noPoll&&!this._pollOnly)return this._schedulePoll();var za={newest:(ya.fullpoll||ya.cache_update)?this._newest:this._page_newest,storyids:this._storyIDs,friendcount:this._friendCount,priorityappid:this._priorityAppId,source:this._tickerSource,needcustomstory:this._nonCustomToCustomStoryRatio>0};la(za,ya);new j().setURI(this._heartbeatEndpoint).setReadOnly(true).setOption('retries',0).setData(za).setHandler(this._handleResponse.bind(this)).setFinallyHandler(this._poll.bind(this)).setAllowCrossPageTransition(true).send();this._lastUpdate=Date.now();if(za.pull)this._lastPull=this._lastUpdate;this._storyIDs=[];},insertStory:function(ya,za,ab){this._lastInsert=Date.now();window.LiveTimer&&u.addTimeStamps(ya);o.removeClass(ya,'queuedStory');o.removeClass(ya,'customStory');if(za!==false){var bb=ab?this._fadeStoryIn:this._flyStoryIn;if(this._isUserScrolling()){var cb=function(){this._container.scrollTop=this._container.scrollTop+this._stories.firstChild.offsetHeight;this._scheduleScrollToTop();}.bind(this);this._fadeStoryIn(ya,cb);}else this._scrollToTop(bb.bind(this,ya));}else p.prependContent(this._stories,ya);if(this._storiesWithActions&&o.hasClass(ya,'tickerStoryWithButton'))this._storiesWithActions[ya.getAttribute('data-story-key')]=ya;this._removeOldStories();},_removeOldStories:function(){var ya=this._getInsertedStories();if(ya.length<=this._maxStoriesToKeep)return;var za=this._minStoriesToKeep,ab=ya.slice(za);ab.forEach(p.remove);if(this._storiesWithActions)for(var bb=0;bb<ab.length;bb++)delete this._storiesWithActions[ab[bb].getAttribute('data-story-key')];this._resetMorePager();},_resetMorePager:function(){var ya=this._getInsertedStories();if(!ya||!ya.length)return;var za=ya[ya.length-1].getAttribute('data-ticker-timestamp'),ab=p.scry(this._root,'.tickerMorePager a')[0];if(!ab||!za)return;var bb=new ea(ab.getAttribute('ajaxify'));bb.addQueryData({oldest:za});ab.setAttribute('ajaxify',bb);},_setLocked:function(ya){this._locked=ya;},_isLocked:function(){return !!(this._locked||this._activeStory);},informAndRemoveStory:function(ya,za,ab){var bb=this._getStoryFromNode(ya),cb=bb.getAttribute('data-story-key');p.setContent(bb,za);o.addClass(bb,'highlightedStory');this._setTimeout(this.removeStory.bind(this,cb),ab||6000);},_getStoryByStoryKey:function(ya){var za=this._getAllStories();for(var ab=0;ab<za.length;ab++){var bb=za[ab];if(bb.getAttribute('data-story-key')==ya)return bb;}return null;},removeStory:function(ya){this._removedStoryIDs[ya]=true;var za=this._getStoryByStoryKey(ya);if(!za)return;if(this._storiesWithActions)delete this._storiesWithActions[ya];if(za==this._activeStory)this._deactivateStory();var ab=this._getStoryDialog(za);ab&&ab.destroy();if(o.hasClass(za,'queuedStory')){p.remove(za);return;}this._animateStoryOut(za);},_isScrolledToTop:function(){return this._container.scrollTop<=this._scrollTopThreshold;},_flyStoryIn:function(ya){var za=p.create('div',{style:{marginTop:'-1000px'}},ya);aa.set(za,'opacity',0);p.prependContent(this._stories,za);var ab=ha.getElementDimensions(za).y;aa.set(za,'marginTop','-'+ab+'px');this._isInsertingStory=true;new h(za).to('marginTop',0).ease(h.ease.end).checkpoint(.5).to('opacity',1).ondone(function(){p.replace(za,ya);this._afterInsert(ya);this._isInsertingStory=false;}.bind(this)).go();},_fadeStoryIn:function(ya,za){new h(this._stories).to('opacity',.5).ondone(function(){p.prependContent(this._stories,ya);if(za)za();new h(this._stories).to('opacity',1).ondone(function(){this._afterInsert(ya);}.bind(this)).go();}.bind(this)).go();},_animateStoryOut:function(ya){var za=p.create('div',{style:{overflow:'hidden',position:'relative'}});p.insertBefore(ya,za);p.appendContent(za,ya);new h(za).to('top',20).to('height',0).to('opacity',0).ease(h.ease.end).ondone(function(){p.remove(za);i.inform('Ticker/animateOut');}.bind(this)).go();},_afterInsert:function(ya){i.inform('Ticker/afterInsert');},setPushChannel:function(ya){this._pushSubscription&&this._pushSubscription.unsubscribe();this._pushSubscription=i.subscribe(m.getArbiterType(ya),this._handleTickerPush.bind(this));d(['ChatConfig','ChannelConnection'],function(za,ab){this._channelConnection=ab;this._checkChannelConnection();this._channelConnectionSubscription=this._channelConnection.subscribe([this._channelConnection.CONNECTED,this._channelConnection.RECONNECTING,this._channelConnection.SHUTDOWN,this._channelConnection.MUTE_WARNING,this._channelConnection.UNMUTE_WARNING],this._handleChannelConnection.bind(this));}.bind(this));},_checkChannelConnection:function(){o.conditionClass(this._root,'disconnected',this._channelConnection.disconnected());},setCurrentAppId:function(ya){this._priorityAppId=ya;},_handleTickerPush:function(ya,za){var ab=za.obj;if(ab.delete_id){this._storiesToRemove.push(ab.delete_id);return;}if(ab.fromups)if(ab.do_logging)this._logDarkLaunch(ab);var bb=ab.story_xhp;if(!bb)return;this._newest=ab.story_time;var cb=q(bb).getRootNode();this.queueStory(cb,ab.flyout_js_cmds);if(this._aggressiveRegulator&&ab.actor==this._newestStory.actorID){this.removeStory(this._newestStory.storyKey);new k('/common/ods_endpoint.php',{k:'ticker.aggr.remove'}).send();}this._newestStory={actorID:ab.actor,storyKey:cb.getAttribute('data-story-key')};},_handleComposerPublish:function(ya,za){za.tickerMarkup&&this.insertStory(za.tickerMarkup);},_clearNux:function(){var ya=p.scry(document.body,'div.tickerNUXContainer');if(ya.length){ya.forEach(function(za){var ab=n.getInstance(za);ab&&ab.hide();});new j().setURI('/ajax/feed/ticker/nux.php').send();}this._clearNux=na;},_logDarkLaunch:function(ya){var za={actor:ya.actor,story_time:ya.story_time,key:ya.story_obj_id,dark:1};new j().setURI('/alite/push/log.php').setData({msg:JSON.stringify(za)}).send();},_logRender:function(){if(this._loggedRender)return;var ya=this._tickerInSidebarMode;if(ya||w.byClass(this._content,'home_right_column')){new k('/ajax/log_ticker_render.php',{sidebar_mode:ya}).send();this._loggedRender=true;}},_isTickerVisible:function(){var ya=(xa._activeInstance==this);ya&&this._logRender();return ya;},_handleResponse:function(ya){var za=ya.getPayload();if(za.newest)this._newest=this._page_newest=za.newest;if(za.content)if(za.content instanceof Array){for(var ab=0;ab<za.content.length;ab++)this.queueStoryMarkup(za.content[ab]);}else this.queueStoryMarkup(za.content);if(za.custom_stories&&za.custom_stories.length){this._queueCustomStories(za.custom_stories);this._doCustomUpdate=true;}},queueStoryMarkup:function(ya){var za=q(ya).getRootNode();this.queueStory(za);},dedupeStory:function(ya){var za=ya.getAttribute('data-story-key'),ab=za&&(!!this._objectIDs[za]||!!this._removedStoryIDs[za]);za&&(this._objectIDs[za]=true);return ab;},queueStory:function(ya,za){if(this.dedupeStory(ya))return;o.addClass(ya,'queuedStory');p.appendContent(this._storyQueue,ya);var ab=za&&za.length;if(ab)za.forEach(function(cb){new Function(cb).apply();});ya.setAttribute('id',ya.id+'_'+this._root.id);var bb=this._getQueuedStories();bb.slice(0,-this._maxQueueLength).forEach(p.remove);if(ab)this._fetchedStories[ya.id]=true;},_queueCustomStories:function(ya){while(ya.length){var za=ya.shift();za=q(za).getRootNode();if(this.dedupeStory(za))continue;o.addClass(za,'customStory');p.appendContent(this._storyQueue,za);}var ab=this._getQueuedCustomStories();ab.slice(0,-this._maxQueueLength).forEach(p.remove);},_cleanup:function(){xa._placeholders.pagelet_rhc_ticker=null;if(!w.byClass(this._content,'hasRightCol'))return;this._objectIDs=[];this._subscriptions.forEach(i.unsubscribe);this._channelConnectionSubscription&&this._channelConnection.unsubscribe(this._channelConnectionSubscription);this._pushSubscription&&this._pushSubscription.unsubscribe();for(var ya in this._listeners)this._listeners[ya]&&this._listeners[ya].remove();clearTimeout(this._pollToken);this._pollToken=null;this._cleanupInputFocusListener();this._cleanupContentResizeListener();i.inform('Ticker/cleanup');},_onNavHandler:function(ya,za){var ab=za.params.key;if(ab!='lf'&&ab!='h')this._cleanup();},_getPositionForDialog:function(){if(this._tickerInSidebarMode&&o.hasClass(document.body,"_58v4"))return 'right';return 'left';},registerStoryDialog:function(ya,za){if(this._uaCurStoryIDFetch==ya.id){this._uaCurStoryIDFetch=null;this._logUserEvent('flyout','fetch_success');}if(this._uaCurStoryIDPrefetch==ya.id){this._uaCurStoryIDPrefetch=null;this._logUserEvent('flyout_prefetch','prefetch_success');}this._fetchedStories[ya.id]=true;za.setContext(ya);za.setPosition(this._getPositionForDialog());za.subscribe('hide',this._deactivateStory.bind(this,true));za.subscribe('success',this._focusStory.bind(this,ya));za.subscribe('beforehide',function(){if(this._selecting){this._selecting=false;return false;}}.bind(this));if(this._popupOnHover){za.subscribe('mouseenter',this._clearHoverTimeouts.bind(this));za.subscribe('mouseleave',this._scheduleHide.bind(this));za.subscribe('show',function(){this._highlightDialogScrollbar.bind(this,za).defer();var ab=g.listen(za.getContent(),'mousedown',function(){this._selectStory(ya);ab.remove();}.bind(this));}.bind(this));}if(ya==this._activeStory){this._logUserEvent('flyout_loadtime','show_fetched');this._logUserEvent('flyout','show');this._openDialog(za);}},_highlightDialogScrollbar:function(ya){var za=p.scry(ya.getContent(),'.uiScrollableArea')[0];za&&y.poke(za);},_openStoryExternally:function(ya,event){var za=ya.getAttribute('data-href');if(!za||za=='#')return;var ab=ya.getAttribute('data-story-rel');switch(ab){case 'theater':this._deactivateAndClearStory();l.loadModules(['PhotoViewer'],function(db){db.bootstrap(za,ya);});return;case 'async':this._deactivateAndClearStory();j.bootstrap(za,ya);return;}var bb=ya.getAttribute('data-target'),cb=(event.which!=1||event.getModifiers().any||bb=='_blank');cb?window.open(za,'_blank'):pa(za);},_deactivateAndClearStory:function(){this._clearHoverTimeouts();this._deactivateStory();},_focusStoryWillTriggerScroll:function(ya){var za=this._container,ab=za.clientHeight,bb=ya.offsetHeight,cb=za.scrollTop,db=cb+ab,eb=ya.offsetTop,fb=eb+bb;return eb<cb||fb>db;},_focusStory:function(ya){if(this._focusStoryWillTriggerScroll(ya))this._preventScrollDismiss=true;ya.focus();},_selectStory:function(ya){this._selectedStory=ya;o.addClass(ya,'tickerStorySelected');o.addClass(this._root,'tickerChildSelected');},_activateStory:function(ya,za){this._clearHoverTimeouts();if(ya==this._activeStory||!this._storyCanOpenDialog(ya))return;this._deactivateStory();this._focusStory(ya);this._activeStory=ya;o.addClass(ya,'tickerStoryActive');window.Toggler&&ca.hide();if(this._logFlyouts){za=za||'unknown';new k('/ajax/feed/ticker/flyout.php',{src:za}).send();}ba.log(ya);var ab=this._getStoryDialog(ya);if(ab){this._logUserEvent('flyout_loadtime','show_prefetched');this._logUserEvent('flyout','show');this._openDialog(ab);return;}if(!(ya.id in this._fetchedStories)){this._uaCurStoryIDFetch=ya.id;this._logUserEvent('flyout','fetch');}this._fetchStory(ya);},_deactivateStory:function(ya){if(this._activeStory===this._deactivatingStory)return;this._deactivatingStory=this._activeStory;if(this._dialog){if(ya===true){this._dialog.enableBehavior(t);}else this._dialog.disableBehavior(t);this._dialog.hide();this._logUserEvent('flyout','close');}if(this._activeStory){o.removeClass(this._activeStory,'tickerStoryActive');o.removeClass(this._activeStory,'tickerStorySelected');o.removeClass(this._root,'tickerChildSelected');}this._dialog=this._selectedStory=this._activeStory=null;this._cleanupInputFocusListener();this._cleanupContentResizeListener();this._deactivatingStory=null;},_logUserAction:function(ya,za,event){ja(za,ya,event,'FORCE');ra('ticker',ya,event).uai(za);},_logUserEvent:function(ya,event){if(this._ua[ya])this._ua[ya].add_event(event);},_fetchStory:function(ya){clearTimeout(this._fetchToken);var za=[],ab=this._getInsertedStories(),bb=ab.indexOf(ya);[-1,0,1].forEach(function(cb){var db=ab[bb+cb];db&&za.push(db);},this);this._fetchToken=setTimeout(this._fetchStories.bind(this,za),100);},_fetchStories:function(ya){var za=[],ab,bb=function(cb){clearTimeout(ab);ya.forEach(function(db){o.conditionClass(db,'tickerStoryFetching',cb);});};ya=ya.filter(function(cb){if(cb.id in this._fetchedStories)return false;this._fetchedStories[cb.id]=true;var db=this._getStoryDialogEndpoint(cb),eb=ea(db).getQueryData();if(!db||!eb)return false;eb.uniq_id=cb.getAttribute('id');eb.referrer=this._tickerSource;za.push(eb);return true;},this);if(!za.length)return;ab=this._setTimeout(bb.curry(true),500);new j('/ajax/feed/ticker/multi_story').setFinallyHandler(bb.curry(false)).setErrorHandler(na).setData({stories:za}).setAllowCrossPageTransition(this._tickerInSidebarMode).send();},_tickerDeClicker:function(event){var ya=event.getTarget(),za=w.byTag(ya,'a'),ab=this._getStoryFromNode(ya),bb=this._getButtonFromNode(ya);if(ab&&za&&!bb&&o.hasClass(ab,'tickerStoryClickable')&&!o.hasClass(za,'tickerStoryAllowClick')&&!this._storyIsHidden(ab)){za.setAttribute('rel','ignore');za.removeAttribute('onclick');za.removeAttribute('ajaxify');za.removeAttribute('href');}var cb=(event.button==2),db=(event.type==='keydown'),eb=ab&&this._getActionButtonFromStory(ab);if(!cb&&eb&&!db)this._setClickedStory(ab);},_handleMouseup:function(event){this._clearClickedStory();},_setClickedStory:function(ya){this._clearClickedStory();o.addClass(ya,'tickerStoryClicked');this._clickedStory=ya;},_clearClickedStory:function(){if(this._clickedStory){o.removeClass(this._clickedStory,'tickerStoryClicked');this._clickedStory=null;}},_initInfiniteScrollListener:function(){var ya=this._getInsertedStories();if(this._storiesWithActions)for(var za=0;za<ya.length;za++){var ab=ya[za];if(o.hasClass(ab,'tickerStoryWithButton'))this._storiesWithActions[ab.getAttribute('data-story-key')]=ab;}var bb=Math.max(0,ya.length-this._autoloadStoryIndex);this._infiniteScrollStory=ya[bb];this._checkInfiniteScroll();},_checkInfiniteScroll:function(){if(this._infiniteScrollStory){var ya=ha.getElementPosition(this._infiniteScrollStory).y,za=ha.getElementPosition(this._container).y+ha.getElementDimensions(this._container).y;if(ya<za){var ab=p.scry(this._root,'.tickerMorePager a')[0];if(ab){var bb=w.byClass(ab,'stat_elem')||ab;new j(ab.getAttribute('ajaxify')).setReadOnly(true).setRelativeTo(ab).setStatusElement(bb).setAllowCrossPageTransition(true).send();this._logUserEvent('stream','scroll');}this._infiniteScrollStory=null;this._autoloadStoryIndex=5;}}},_setFixed:function(ya){if(!this._selectedStory)return;var za=this._getStoryDialog(this._selectedStory);if(za){za.setPosition(this._getPositionForDialog());za.setFixed(ya);za.updatePosition();}},_setTimeout:function(ya,za){return setTimeout(ya,za,!this._tickerInSidebarMode);},_scrollDialogToBottom:function(){var ya=this._dialog&&this._dialog.getContent(),za=ya&&p.scry(ya,'.uiScrollableAreaWrap')[0],ab=za&&y.getInstance(za);ab&&ab.scrollToBottom();},_openDialog:function(ya){if(!this._tickerInSidebarMode)o.addClass(ya.getRoot(),'tickerStoryOverlayOnTop');this._dialog=ya.show();this._updateDialogPosition();this._writeSwfFrame(ya);this._initCommentFocusListener.bind(this).defer();this._initContentResizeListener.bind(this).defer();this._stupidIE7VideoResizeHack(ya);},_stupidIE7VideoResizeHack:function(ya){if(ga.ie()===7){var za=p.scry(ya.getContent(),'.uiVideoThumb .img');za.forEach(function(ab){aa.set(ab,'width','');});}},_updateDialogPosition:function(){var ya=this._tickerInSidebarMode||!!w.byClass(this._root,'fixed_elem');this._dialog.setPosition(this._getPositionForDialog());this._dialog.setFixed(ya);this._adjustFlyoutContentHeight();this._dialog.updatePosition();},_writeSwfFrame:function(ya){var za=this._dialog&&this._dialog.getContent(),ab=p.scry(za,'.swfObject')[0];if(!ab)return;var bb=ab.getAttribute('data-swfid');if(bb&&window[bb]){var cb=window[bb];cb.write(ab);}},_initCommentFocusListener:function(){var ya=this._dialog&&this._dialog.getContent(),za=ya&&p.scry(ya,'.tickerDialogFooter textarea')[0];if(!za)return;this._listeners.inputFocus=g.listen(za,'focus',this._scrollDialogToBottom.bind(this));},_cleanupInputFocusListener:function(){if(this._listeners.inputFocus){this._listeners.inputFocus.remove();this._listeners.inputFocus=null;}},_initContentResizeListener:function(){var ya=this._dialog&&this._dialog.getContent();if(!ya)return;this._listeners.contentResize=g.listen(ya,'click',function(){this._dialog.updatePosition.bind(this._dialog).defer();}.bind(this));},_cleanupContentResizeListener:function(){if(this._listeners.contentResize){this._listeners.contentResize.remove();this._listeners.contentResize=null;}},_adjustFlyoutContentHeight:function(){var ya=this._dialog&&this._dialog.getContent(),za=ya&&p.scry(ya,'.uiScrollableAreaWrap')[0];if(!za)return;var ab=ha.getElementDimensions(za),bb=ha.getElementPosition(za),cb=p.scry(za,'.uiUfi .uiUfiComment'),db=ha.getViewportDimensions().y-this.FLYOUT_VIEWPORT_PADDING,eb=Math.min(this.FLYOUT_MAX_HEIGHT,db),fb=eb-this.FLYOUT_TARGET_HEIGHT_OFFSET;for(var gb=0;gb<cb.length;gb++){var hb=cb[gb],ib=ha.getElementPosition(hb),jb=ib.y-bb.y;if(Math.abs(jb-fb)<=this.FLYOUT_OFFSET_THRESHOLD){fb=jb+this.FLYOUT_COMMENT_OFFSET;break;}}if(ab.y>fb){aa.set(za,'height',fb+'px');aa.set(za,'max-height',null);}else{aa.set(za,'max-height',eb+'px');aa.set(za,'height',null);}},_initObjectIDs:function(){var ya=this._getAllStories();for(var za=0;za<ya.length;++za){var ab=ya[za].getAttribute('data-story-key');ab&&(this._objectIDs[ab]=true);}},_handleChatOpened:function(){this._deactivateStory(true);},_handleChannelConnection:function(){this._checkChannelConnection();},getNewest:function(){return this._newest;}});e.exports=xa;});
__d("legacy:TickerController",["TickerController"],function(a,b,c,d){a.TickerController=b('TickerController');},3);
__d("HomeTickerFirstRightColumnController",["$","ge","debounceAcrossTransitions","throttle","UIPagelet","Arbiter","Style","csx","CSS","DOM","Vector","Run","LegacyContextualDialog","TickerController","UIIntentionalStreamMessage","Event"],function(a,b,c,d,e,f){var g=b('$'),h=b('ge'),i=b('debounceAcrossTransitions'),j=b('throttle'),k=b('UIPagelet'),l=b('Arbiter'),m=b('Style'),n=b('csx'),o=b('CSS'),p=b('DOM'),q=b('Vector'),r=b('Run'),s=b('LegacyContextualDialog'),t=b('TickerController'),u=b('UIIntentionalStreamMessage'),v=b('Event'),w=null,x=75,y=50,z=15,aa=false,ba=false,ca,da,ea,fa,ga,ha,ia,ja,ka,la=y,ma=[],na=[],oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,ab;function bb(){var sb=ob;function tb(){sb.defer();}var ub=p.scry(ra,'img.img');ub.forEach(function(vb){if(!vb.complete)v.listen(vb,{load:tb,error:tb,abort:tb});});tb();}function cb(){na=[l.subscribe('page_transition',fb),l.subscribe('netego_loaded',ob),l.subscribe('Ticker/storiesInserted',ob),l.subscribe(u.INSERT_STORIES,ob)];if(w.enableSidebar){na.push(l.subscribe('sidebar/hide',pb));na.push(l.subscribe('sidebar/show',qb));}}function db(){if(ra){var sb=p.scry(ra,"div._4u8");for(var tb=0;tb<sb.length;tb++){var ub=JSON.parse(sb[tb].getAttribute('data-ad')).segment;if(ub==='premium')return true;}}return false;}function eb(){ab=p.scry(document,'div.fbRemindersContent');va=p.scry(h('rightCol'),'div.home_right_column')[0];wa=p.find(va,'div.rightColumnWrapper');ra=h('pagelet_ego_pane_w')||h('pagelet_ego_pane_m');fa=w.refreshPremiumAds||!db();v.listen(ra,'mouseenter',function(){aa=true;});v.listen(ra,'mouseleave',function(){aa=false;});sa=h('pagelet_rhc_ticker');if(!sa)return false;ta=p.scry(sa,'.ticker_container')[0];ua=p.scry(sa,'.ticker_stream')[0];return ta&&ua;}function fb(sb,tb){if(sb==='page_transition'&&tb&&tb.uri){var ub=tb.uri;if(ub.path==='/photo.php'){ba=true;return;}if(ba&&ub.path==='/'){ba=false;return;}}na.forEach(l.unsubscribe);na=[];ma.forEach(function(vb){vb.remove();});ma=[];oa.reset();}function gb(){if(ja||!ca)ka=q.getElementPosition(ra,'viewport').y-q.getElementPosition(wa,'viewport').y;}function hb(){gb();var sb=la;lb();if(sb!=la){ja=true;mb();}za=xa+q.getElementPosition(qa,'viewport').y;var tb=za,ub=q.getElementPosition(va,'viewport').y;for(var vb=0;vb<ab.length;vb++){var wb=s.getInstance(ab[vb]);wb.hide();}if(da||!ua){if(ia!==null){var xb=ub+ka,yb=xb<=tb-ia;if(ja||yb!==ca){ja=false;var zb=tb-ia-ka;nb(yb,zb);}}return;}var ac=ub<=tb+z;if(ac!==ca)nb(ac);}function ib(){var sb=Date.now();if(fa&&!aa&&w.adsRefreshInterval&&sb-ga>=w.adsRefreshInterval)jb();}function jb(){ga=Date.now();k.loadFromEndpoint('WebEgoPane',ra,{pid:27,data:{organic_only:false,ads_only:false,refresh_num:++ha}},{bundle:false,crossPage:false,handler:bb});}function kb(){ja=true;gb();lb();mb();hb();}function lb(){var sb=q.getDocumentDimensions().y-(q.getScrollPosition('document').y+q.getViewportDimensions().y);la=sb>ya?y:x;}function mb(){var sb=q.getViewportDimensions().y-xa-la,tb=q.getElementDimensions(wa).y;if(tb<=sb){ia=0-ka-z;return;}var ub=tb-ka,vb=p.scry(ra,'div.egoOrganicColumn')[0];if(ub<=sb&&vb){ia=0;}else{var wb=p.scry(ra,'div.ego_unit').reverse(),xb=p.scry(ra,"div._4u8").length,yb=w.maxFixedAds;if(xb<=w.maxFixedAds)yb=wb.length;var zb=null;for(var ac=0;ac<yb;ac++){var bc=wb[ac],cc=q.getElementPosition(bc,'viewport').y-q.getElementPosition(wa,'viewport').y,dc=q.getElementDimensions(wa).y-cc;if(dc>sb){if(ac>0)zb=wb[ac-1];break;}if(ac==yb-1)zb=bc;}if(zb==null){ia=null;}else ia=q.getElementPosition(zb,'viewport').y-q.getElementPosition(ra,'viewport').y;}}function nb(sb,tb){ca=sb;tb=tb||za;var ub=sb?tb+'px':'';m.set(wa,'top',ub);o.conditionClass(wa,'fixed_elem',sb);var vb=p.scry(wa,'div.displayedTickerToggleWrapper')[0];vb&&o.conditionClass(vb,'toggleWrapperWithoutMargin',sb&&!ua);if(ea){var wb=sb?'Ticker/fixed':'Ticker/unfixed';l.inform(wb);}}function ob(){if(!ea||!ua||o.hasClass(document.documentElement,'tinyViewport')){kb();return;}hb();var sb=q.getViewportDimensions().y,tb=61,ub=q.getElementDimensions(wa).y-q.getElementDimensions(ta).y,vb=q.getElementDimensions(ua).y,wb=sb-ub-x-za-tb,xb=w.tickerAbsMinHeight||120,yb=w.tickerMinHeight||225;da=false;if(wb<xb){da=true;nb(false);wb=xb;}else if(wb<yb)if(wb>(yb-tb)){wb=yb;}else wb+=tb;var zb=Math.min(wb,vb,w.tickerMaxHeight||425);m.set(ta,'height',zb+'px');}function pb(){ea=true;eb();var sb=function(){if(eb()){da=false;hb();ob();}};sa&&t.show(sa,sb);}function qb(){ea=false;eb();kb();sa&&t.hide(sa);}var rb={init:function(sb){w=sb;pa=g('contentCol');qa=g('blueBar');ha=0;ga=Infinity;ga=Date.now();oa=i(ib,w.adsRefreshDelay);if(w.adsRefreshOnmove)ma.push(v.listen(window,'mousemove',oa));ma.push(v.listen(window,'scroll',oa));ma.push(v.listen(window,'resize',oa));ma.push(v.listen(window,'resize',j(ob)));xa=q.getElementDimensions(qa).y;ya=q.getElementDimensions(g('pageFooter')).y;eb();cb();r.onLeave(fb);ma.push(v.listen(window,'scroll',j(hb)));if(!o.hasClass(document.documentElement,'sidebarMode')){pb();}else if(w.enableSidebar)qb();bb();}};e.exports=rb;});
__d("AsyncLayout",["AjaxPipeRequest","Arbiter","AsyncRequest","AsyncResponse","CSS","DOM","HTML","NavigationMessage","PageTransitions","URI","$","copyProperties","emptyFunction","ge","goURI"],function(a,b,c,d,e,f){var g=b('AjaxPipeRequest'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('AsyncResponse'),k=b('CSS'),l=b('DOM'),m=b('HTML'),n=b('NavigationMessage'),o=b('PageTransitions'),p=b('URI'),q=b('$'),r=b('copyProperties'),s=b('emptyFunction'),t=b('ge'),u=b('goURI');function v(w){this.canvasID=w;if(t('rightCol'))this.auxiliaryID='rightCol';if(t('headerArea'))this.headerID='headerArea';if(t('toolbarContainer'))this.toolbarID='toolbarContainer';this.waitingForAux=false;o.registerHandler(this.catchPageTransition.bind(this));this.subscription=h.subscribe(n.NAVIGATION_BEGIN,this.onNavigate.bind(this));}r(v.prototype,{catchPageTransition:function(w){this.subscription.unsubscribe();return false;},getCanvasID:function(w){return w.sidecol?'contentCol':'contentArea';},onNavigate:function(w,x){var y=x.useAjaxPipe;x=x.params;if(x.endpoint){if(this.request){this.request.setFinallyHandler(s);this.request.abort();}if(this.sideRequest)this.sideRequest.abort();if(y){this.request=new g().setURI(x.endpoint).setData(x).setCanvasId(this.getCanvasID(x)).setFinallyHandler(this.finallyHandler.bind(this)).setErrorHandler(this.errorHandler.bind(this)).setFirstResponseCallback(this.firstResponseCallback.bind(this)).send();}else{x.handled=true;this.waitingForAux=x.sidecol;var z=!!x.iframe,aa=new i().setOption('useIframeTransport',z).setURI(new p(x.endpoint)).setReadOnly(true).setMethod('GET').setData(x).setHandler(this.onResponse.bind(this)).setErrorHandler(this.errorHandler.bind(this)).setFinallyHandler(this.finallyHandler.bind(this));this.request=aa;aa.send();}}},onSideResponse:function(w){var x=w.getPayload();if(x&&this.auxiliaryID)this.receivedAux(x);},receivedAux:function(w){!this.waitingForAux;this.waitingForAux=false;l.setContent(q(this.auxiliaryID),m(w));},onResponse:function(w){var x=w.getPayload();if(x.redirect){u(x.redirect);}else{var y=x.html||x;l.setContent(q(this.canvasID),m(y));if(x.side_html&&this.auxiliaryID)this.receivedAux(x.side_html);if(this.headerID&&!x.keep_header){var z=q(this.headerID);l.setContent(z,m(x.header_html||''));k.conditionShow(z,x.header_html);}if(x.toolbar_html&&this.toolbarID)l.setContent(q(this.toolbarID),m(x.toolbar_html));if(x.js)(new Function(x.js))();k.conditionClass('contentCol','hasRightCol',this.auxiliaryID&&!x.noRightSide);var aa=t('rightCol');if(aa&&x.noRightSide)l.empty(aa);}var ba=w.getRequest().getData();h.inform(n.NAVIGATION_COMPLETED,ba.key);},errorHandler:function(w){j.verboseErrorHandler(w);h.inform(n.NAVIGATION_FAILED);this.request=null;},firstResponseCallback:function(w){window.scrollTo(0,0);h.inform(n.NAVIGATION_FIRST_RESPONSE);},finallyHandler:function(w){this.request=null;o.transitionComplete(true);h.inform(n.NAVIGATION_COMPLETED);}});e.exports=v;});