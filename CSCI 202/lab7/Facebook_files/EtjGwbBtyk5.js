/*1369426757,173205815*/

if (self.CavalryLogger) { CavalryLogger.start_js(["TCbHh"]); }

__d("FriendBrowserCheckboxController",["AsyncRequest","CSS","DOM","Event","Form","OnVisible","$","bind","copyProperties","ge"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('CSS'),i=b('DOM'),j=b('Event'),k=b('Form'),l=b('OnVisible'),m=b('$'),n=b('bind'),o=b('copyProperties'),p=b('ge');function q(){}o(q,{instances:{},getInstance:function(r){return this.instances[r];}});o(q.prototype,{init:function(r,s,t,u){q.instances[r]=this;this._id=r;this._simplified=t;this._infiniteScroll=u;this._form=s;this._contentGrid=i.find(s,'.friendBrowserCheckboxContentGrid');this._loadingIndicator=i.find(s,'.friendBrowsingCheckboxContentLoadingIndicator');this._checkboxResults=i.find(s,'.friendBrowserCheckboxResults');this._contentPager=i.find(s,'.friendBrowserCheckboxContentPager');this.numGetNewRequests=0;this.queuedRequests={};j.listen(this._form,'submit',this.onFormSubmit.bind(this));},addTypeahead:function(r,s){r.subscribe('select',this.onHubSelect.bind(this,r,s));if(this._simplified)r.subscribe('unselect',this.onHubSelect.bind(this,r,s));},onFormSubmit:function(){this.getNew(true);return false;},addSelector:function(r){r.subscribe('change',this.getNew.bind(this,false));},onHubSelect:function(r,s,event,t){if(this._simplified){this.getNew(true);return;}if(!((event=='select')&&t.selected))return;var u=this.buildNewCheckbox(s,t.selected.text,t.selected.uid),v=i.find(this._form,'.checkboxes_'+s);i.appendContent(v.firstChild,u);var w=i.scry(r.getElement(),'input[type="button"]');if(w&&w[0])w[0].click();this.getNew(true);},buildNewCheckbox:function(r,s,t){var u=r+'_ids_'+t,v=r+'_ids[]',w=i.create('input',{id:u,type:'checkbox',value:t,name:v,checked:true});j.listen(w,'click',n(this,'getNew',false));var x=i.create('td',null,w);h.addClass(x,'vTop');h.addClass(x,'hLeft');var y=i.create('label',null,s),z=i.create('td',null,y);h.addClass(z,'vMid');h.addClass(z,'hLeft');var aa=i.create('tr');aa.appendChild(x);aa.appendChild(z);return aa;},showMore:function(){var r=i.scry(this._contentPager,'.friendBrowserMorePager')[0];if(!r)return false;if(h.hasClass(r,'async_saving'))return false;var s=this.numGetNewRequests,t=k.serialize(this._form);t.show_more=true;var u=new g().setURI('/ajax/growth/friend_browser/checkbox.php').setData(t).setHandler(n(this,function(v){this.showMoreHandler(v,s);})).setStatusElement(r).send();},showMoreHandler:function(r,s){if(s==this.numGetNewRequests){var t=r.payload;i.appendContent(this._contentGrid,t.results);this.updatePagerAndExtraData(t.pager,t.extra_data);}},getNew:function(r){this.numGetNewRequests++;var s=this.numGetNewRequests;h.addClass(this._checkboxResults,'friendBrowserCheckboxContentOnload');if(p('friendBrowserCI'))h.addClass(m('friendBrowserCI'),'friendBrowserCheckboxContentOnload');h.show(this._loadingIndicator);var t=k.serialize(this._form);t.used_typeahead=r;new g().setURI('/ajax/growth/friend_browser/checkbox.php').setData(t).setHandler(n(this,function(u){this.getNewHandler(u,s);})).send();},getNewHandler:function(r,s){if(s==this.numGetNewRequests){var t=r.payload;i.setContent(this._contentGrid,t.results);h.removeClass(this._checkboxResults,'friendBrowserCheckboxContentOnload');if(p('friendBrowserCI'))h.hide(m('friendBrowserCI'));h.hide(this._loadingIndicator);this.updatePagerAndExtraData(t.pager,t.extra_data);}},updatePagerAndExtraData:function(r,s){i.setContent(this._contentPager,r);if(this._infiniteScroll)this.setupOnVisible();i.replace(this._form.elements.extra_data,s);},setupOnVisible:function(){var r=i.scry(this._contentPager,'.friendBrowserMorePager')[0];if(r&&this._id!='jewel'){this._onVisible&&this._onVisible.remove();this._onVisible=new l(r,n(this,'showMore'),false,1000);}}});e.exports=q;});
__d("legacy:friend-browser-checkbox-js",["FriendBrowserCheckboxController"],function(a,b,c,d){a.FriendBrowserCheckboxController=b('FriendBrowserCheckboxController');},3);
__d("ContextualHelpSearchController",["Event","AsyncRequest","DOM","CSS","Focus","Input","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('AsyncRequest'),i=b('DOM'),j=b('CSS'),k=b('Focus'),l=b('Input'),m=b('copyProperties'),n=400;function o(){this._token=null;this._timerID=0;this._lastQuery=null;this.typing_listener=null;this.clear_listener=null;this.async_request=null;}m(o.prototype,{init:function(p,q,r,s,t){this.loader=p;this.search_box=q;this.topics_area=r;this.results_area=s;this.clear_button=t;this.typing_listener=g.listen(this.search_box,'keyup',this.setTimer.bind(this));this.clear_listener=g.listen(this.clear_button,'click',this.clearResults.bind(this));k.set(this.search_box);},source:'contextual_help',clearResults:function(){this.show(this.topics_area);this._lastQuery='';l.reset(this.search_box);k.set(this.search_box);if(this.async_request!==null){this.async_request.abort();this.async_request=null;}j.addClass(this.clear_button,'hidden_elem');},update:function(){var p=l.getValue(this.search_box);if(p===this._lastQuery)return;this._lastQuery=p;if(p===''){this.clearResults();return;}this.show(this.loader);var q={query:p,width:this._width||n,source:this.source};this.async_request=new h('/help/ajax/search/').setData(q).setHandler(function(r){this._update(r);}.bind(this));this.async_request.send();},_update:function(p){this.async_request=null;var q=p.getPayload().results;i.setContent(this.results_area,q);this.show(this.results_area);if(l.getValue(this.search_box)===''){this.clearResults();}else j.removeClass(this.clear_button,'hidden_elem');},setTimer:function(){if(this._timerID!==0)clearTimeout(this._timerID);this._timerID=setTimeout(this.update.bind(this),300);if(this.async_request!=null){this.async_request.abort();this.async_request=null;}},show:function(p){var q=[this.loader,this.topics_area,this.results_area];for(var r=0;r<q.length;r++)j.addClass(q[r],'hidden_elem');j.removeClass(p,'hidden_elem');}});e.exports=o;});
__d("RequestsJewel",["Arbiter","AsyncRequest","AsyncSignal","ChannelConstants","CSS","DOM","Event","FriendBrowserCheckboxController","LinkController","Parent","ScrollableArea","Vector","copyProperties","ge","shield","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('AsyncSignal'),j=b('ChannelConstants'),k=b('CSS'),l=b('DOM'),m=b('Event'),n=b('FriendBrowserCheckboxController'),o=b('LinkController'),p=b('Parent'),q=b('ScrollableArea'),r=b('Vector'),s=b('copyProperties'),t=b('ge'),u=b('shield'),v=b('tx');function w(){}s(w,{instance:null,getInstance:function(){return this.instance;}});s(w.prototype,{init:function(x,y,z){w.instance=this;this.countNew=0;this.jewel=x;this.jewelFlyoutCase=x.getRoot();this.jewelFlyout=t('fbRequestsFlyout');this.newCountSpan=t('newRequestCount');this.folder=y;this.doNewMarkRead=z;this.openTimestamp=0;this._requestList={};this._requestCount=0;var aa=t('requestsMarkReadButton');if(aa)m.listen(aa,'click',u(this._markRead,this));this.jewel.subscribe('marked-seen',u(this._markSeenCallback,this));this.jewel.subscribe('closed',u(this._clearNewItems,this));this.jewel.subscribe('updated',this._updateCount.bind(this));this.jewel.subscribe('opened',this._openHandler.bind(this));o.registerHandler(this._handleLink.bind(this));g.subscribe(j.getArbiterType('jewel_requests_add'),this._addRequest.bind(this));g.subscribe(j.getArbiterType('jewel_requests_remove_old'),this._removeOldRequest.bind(this));g.subscribe(j.getArbiterType('friend_requests_seen'),this._markSeenFromMessage.bind(this));m.listen(this.jewelFlyout,'submit',function(ba){var ca=p.byClass(ba.getTarget(),'objectListItem');if(ca){k.removeClass(ca,'jewelItemNew');k.addClass(ca,'jewelItemResponded');this.pageInCollapsedRequests();}}.bind(this));this.setupScroll();return this;},setupScroll:function(){var x=l.scry(this.jewelFlyout,'.uiScrollableAreaWrap')[0];if(x){this._scrollableWrap=x;this._lastLinkPosition=0;this._scrollListener=m.listen(x,'scroll',this._handleScroll.bind(this),m.Priority._BUBBLE);}},fromDom:function(){l.scry(this.jewelFlyout,'.jewelItemList li.objectListItem').forEach(function(x){var y=x.getAttribute('id');if(y){var z=this._parseIDToInts(y);if(z.requester)this._requestList[z.requester]=y;++this._requestCount;}}.bind(this));this._conditionShowEmptyMessage();},_parseID:function(x){var y=x.match(/^(\d+)_(\d+)/);return (y)?{requester:y[1],type:y[2]}:undefined;},_parseIDToInts:function(x){var y=x?this._parseID(x):undefined,z;if(y&&y.requester){z=parseInt(y.requester,10);if(isNaN(z))z=undefined;}var aa;if(y&&y.type){aa=parseInt(y.type,10);if(isNaN(aa))aa=undefined;}return {requester:z,type:aa};},_handleLink:function(x,event){var y=p.byClass(x,'jewelItemNew');if(y&&p.byClass(y,'fbRequestList')&&p.byClass(y,'beeperEnabled')){var z=this._parseID(y.id);z&&this._markSeenCallback(z.requester,z.type);g.inform('jewel/count-updated',{jewel:'requests',count:--this.countNew});k.removeClass(y,'jewelItemNew');}return true;},_handleScroll:function(){var x=l.scry(this._scrollableWrap,'.uiMorePager');if(!x||(t('fbRequestsJewelManualPager')&&x.length<2))return;var y=x.pop();if(y){var z=r.getElementPosition(y,'viewport').y;if(z>0)k.addClass(p.byClass(this._scrollableWrap,'uiScrollableArea'),'contentAfter');var aa=l.find(y,'a');if(!aa)return;var ba=r.getElementPosition(aa,'viewport').y;if(ba==this._lastLinkPosition)return;var ca=r.getElementPosition(this._scrollableWrap,'viewport').y+r.getElementDimensions(this._scrollableWrap).y;if(ba-300<ca&&ba>0){this._lastLinkPosition=ba;var da=aa.getAttribute('ajaxify');if(da){new h(da).setRelativeTo(aa).setStatusElement(p.byClass(aa,'stat_elem')).send();}else n.getInstance('jewel').showMore();}}},_addRequest:function(x,y){if(!y)return;var z=y.obj.from,aa=y.obj.suggester,ba=this._parseIDToInts(this._requestList[z]).type,ca=ba===19&&!aa;if(!ca&&(ba||this.jewel.isOpen()))return;if(t('fbRequestsJewelLoading')){new h().setURI('/ajax/requests/loader/').send();}else{var da=this._onMarkupCallback.bind(this,z,!!aa),ea={from:z};if(aa)ea.suggester=aa;new h().setURI('/ajax/friends/jewel/request_markup').setData(ea).setHandler(da).send();}},_onMarkupCallback:function(x,y,z){var aa=z.getPayload();if(!aa)return;var ba=this._requestList[x],ca=this._parseIDToInts(ba).type;if(ca===19&&!y){var da=ba&&t(ba);da&&l.replace(da,aa.markup);}else{var ea=l.scry(this.jewelFlyout,'.fbRequestList .uiList')[0];if(!ea)return;l.prependContent(ea,aa.markup);var fa={jewel:'requests',count:++this.countNew};g.inform('jewel/count-updated',fa);++this._requestCount;this._conditionShowEmptyMessage();}this._requestList[x]=aa.item_id;},_removeOldRequest:function(x,y){if(!y||this.jewel.isOpen()||t('fbRequestsJewelLoading')!==null)return;var z=this._requestList[y.obj.from],aa=z&&t(z);if(aa){k.hasClass(aa,'jewelItemNew')&&g.inform('jewel/count-updated',{jewel:'requests',count:--this.countNew});if(!k.hasClass(aa,'jewelItemResponded')){l.remove(aa);delete this._requestList[y.obj.from];--this._requestCount;this._conditionShowEmptyMessage();}}},pageInCollapsedRequests:function(){var x=t('fbRequestsJewelManualPager');if(x){var y=l.scry(x,'.uiMorePagerPrimary')[0];if(y.style&&y.style.display!='none')setTimeout(function(){y.click();},100);}},_markRead:function(){this.jewel.markSeen();this._clearNewItems();},_markSeenCallback:function(x,y){var z=l.scry(this.jewelFlyout,'li');new i('/ajax/gigaboxx/endpoint/UpdateLastSeenTime.php',{folder:this.folder,first_item:z[0].id}).send();var aa=typeof x!='undefined'&&typeof y!='undefined'?{requester:x,type:y}:{};this.doNewMarkRead&&new i('/ajax/requests/mark_read/',aa).send();},_markSeenFromMessage:function(x,y){g.inform('jewel/count-updated',{jewel:'requests',count:0});},_removeRequest:function(x,y){var z=y.obj.item_id;if(z){var aa=t(z),ba=aa&&k.hasClass(aa,'jewelItemNew');aa?l.remove(aa):false;ba&&g.inform('jewel/count-updated',{jewel:'requests',count:--this.countNew});}},_clearNewItems:function(x,y){l.scry(this.jewel.root,'li.jewelItemNew').forEach(function(z){k.removeClass(z,'jewelItemNew');});},_updateCount:function(x,y){this.countNew=y.count;k.conditionClass(this.jewelFlyout,'beeperUnread',this.countNew>0);k.conditionClass(this.jewelFlyoutCase,'showRequests',this.countNew>0);if(this.newCountSpan){var z=this.countNew==1?v._("{num} NEW REQUEST",{num:this.countNew}):v._("{num} NEW REQUESTS",{num:this.countNew});l.setContent(this.newCountSpan,z);}},_conditionShowEmptyMessage:function(){l.scry(this.jewelFlyout,'li.empty').forEach(function(x){k.conditionShow(x,this._requestCount<=0);}.bind(this));},_openHandler:function(){var x=l.scry(this.jewelFlyout,'.uiScrollableArea')[0];if(t('fbRequestsJewelLoading')){var y=Date.now();if(this.openTimestamp+5000<y){this.openTimestamp=y;new h().setURI('/ajax/requests/loader/').setData({log_impressions:true}).send();}}else{var z=Object.keys(this._requestList);if(z.length>0)new h().setURI('/friends/requests/log_impressions').setData({ids:z.join(','),ref:'jewel'}).send();}x&&q.poke(x);}});e.exports=w;});
__d("legacy:RequestsJewel",["RequestsJewel"],function(a,b,c,d){a.RequestsJewel=b('RequestsJewel');},3);
__d("JewelX",["Event","Arbiter","ArbiterMixin","CSS","DOM","HTML","Keys","TabIsolation","Toggler","copyProperties","emptyFunction","reportData"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('ArbiterMixin'),j=b('CSS'),k=b('DOM'),l=b('HTML'),m=b('Keys'),n=b('TabIsolation'),o=b('Toggler'),p=b('copyProperties'),q=b('emptyFunction'),r=b('reportData'),s=function(t,u){t&&u&&this.init(t,u);};p(s,{_instancesByName:{},_resizeListener:null});p(s.prototype,i,{init:function(t,u){this.name=u.name;this.root=t;this.countNew=0;this.initialCount=0;this.escHandler=null;s._instancesByName[this.name]=this;var v=k.find(t,'.jewelFlyout'),w=new n(v);o.listen('show',this.root,function(x){this._logFirstClick();this.hasNew()&&this.markSeen();this.reset();this.inform('opened');h.inform('layer_shown',{type:'Jewel'});w.enable();this.setupEvents();}.bind(this));o.listen('hide',this.root,function(x,y){this.hasNew()&&this.markSeen();this.reset();this.inform('closed');h.inform('layer_hidden',{type:'Jewel'});w.disable();this.removeEvents();}.bind(this));h.subscribe('jewel/count-updated',function(x,y){y.jewel==this.name&&this.update(y);}.bind(this));h.subscribe('jewel/count-initial',function(x,y){y.jewel==this.name&&this.setInitial(y);}.bind(this));h.subscribe('jewel/reset',function(x,y){y.jewel==this.name&&this.reset();}.bind(this));s._resizeListener=s._resizeListener||(function(){var x=null;return g.listen(window,'resize',function(){clearTimeout(x);x=h.inform.bind(h,'jewel/resize').defer(100,false);});})();},getRoot:function(){return this.root;},hasNew:function(){return j.hasClass(this.root,'hasNew');},isOpen:function(){return j.hasClass(this.root,'openToggler');},reset:function(){j.removeClass(this.root,'hasNew');},setContent:function(t){var u=k.find(this.root,'ul.jewelItemList');k.setContent(u,l(t));},update:function(t){this.countNew=t.count;var u=k.find(this.root,'span.jewelCount span');k.setContent(u,this.countNew);var v=isNaN(this.countNew)||this.countNew>0;j.conditionClass(this.root,'hasNew',v);if(v){var w=(''+this.countNew).length;j.conditionClass(this.root,'hasCountSmall',w===1);j.conditionClass(this.root,'hasCountMedium',w===2);j.conditionClass(this.root,'hasCountLarge',w>2);}this.inform('updated',t);},setInitial:function(t){this.initialCount=t;},setupEvents:function(){this.escHandler=g.listen(document.documentElement,'keydown',function(t){if(t.keyCode===m.ESC&&this.isOpen())o.hide(this.root);}.bind(this));},removeEvents:function(){if(this.escHandler)this.escHandler.remove();},markSeen:function(){h.inform('jewel/count-updated',{jewel:this.name,count:0},h.BEHAVIOR_STATE);this.inform('marked-seen');},_logFirstClick:function(){this._logFirstClick=q;r('jewel_click',{gt:{count:this.countNew,initial:this.initialCount,jewel:this.name}});}});e.exports=s;});
__d("MercuryJewelCountControl",["Arbiter","DOM","MercuryThreadlistConstants","copyProperties","shield","tx","MercuryServerRequests","MercuryThreadInformer","MercuryUnseenState"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('DOM'),i=b('MercuryThreadlistConstants'),j=b('copyProperties'),k=b('shield'),l=b('tx'),m=b('MercuryServerRequests').get(),n=b('MercuryThreadInformer').get(),o=b('MercuryUnseenState').get(),p,q,r,s=function(u){if(u||r.isOpen())o.markAsSeen();},t=function(u,v){p=u;q=h.find(p,'#mercurymessagesCountValue');r=v;this.render();m.subscribe('model-update-completed',function(w,x){s(false);});n.subscribe('unseen-updated',this.render.bind(this));r.subscribe('marked-seen',k(s,this,true));};j(t.prototype,{render:function(){var u='';if(o.exceedsMaxCount()){u=l._("{count}+",{count:i.MAX_UNSEEN_COUNT});}else u=o.getUnseenCount().toString();g.inform('jewel/count-updated',{jewel:'mercurymessages',count:u},g.BEHAVIOR_STATE);}});e.exports=t;});
__d("MercuryJewelThreadlistControl",["Arbiter","ArbiterMixin","MercuryChatUtils","MercuryConfig","CSS","DOM","Event","JSLogger","MercuryAPIArgsSource","MercuryThreadlistConstants","MessagingTag","MercuryOrderedThreadlist","Parent","MercuryJewelTemplates","MercuryThreadInformer","MercuryThreadMetadataRenderer","MercuryThreads","MercuryUnreadState","copyProperties","csx","cx","throttle","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('MercuryChatUtils'),j=b('MercuryConfig'),k=b('CSS'),l=b('DOM'),m=b('Event'),n=b('JSLogger'),o=b('MercuryAPIArgsSource'),p=b('MercuryThreadlistConstants'),q=b('MessagingTag'),r=b('MercuryOrderedThreadlist').get(),s=b('Parent'),t=b('MercuryJewelTemplates'),u=b('MercuryThreadInformer').get(),v=b('MercuryThreadMetadataRenderer').get(),w=b('MercuryThreads').get(),x=b('MercuryUnreadState').get(),y=b('copyProperties'),z=b('csx'),aa=b('cx'),ba=b('throttle'),ca=b('tx'),da=n.create('mercury_jewel');function ea(la,ma){this._contentArea=l.scry(la,'.scrollable')[0]||la;this._contentElement=l.find(this._contentArea,'.jewelContent');this._loadingElement=l.find(this._contentArea,'.jewelLoading');this._loadMoreButton=l.find(this._contentArea,"._8y5");this._loadMoreLink=l.find(this._contentArea,"a._8y6");this._currentFolder=q.INBOX;if(j.OtherFolderJewelGK){this._jewelFolderLinks=[];this._jewelFolderLinks[q.INBOX]=l.find(ma,"._1sde");this._jewelFolderLinks[q.OTHER]=l.find(ma,"._1sdf");this._jewelFolderCounts=[];this._jewelFolderCounts[q.INBOX]=l.find(ma,"._1sdg");this._jewelFolderCounts[q.OTHER]=l.find(ma,"._1sdh");ja.bind(this)();m.listen(this._jewelFolderLinks[q.INBOX],'click',ia.bind(this,q.INBOX));m.listen(this._jewelFolderLinks[q.OTHER],'click',ia.bind(this,q.OTHER));}this._curCount=[];this._curCount[q.INBOX]=p.JEWEL_THREAD_COUNT+1;this._curCount[q.OTHER]=p.JEWEL_THREAD_COUNT+1;this._isFolderLoaded=[];this._isFolderLoaded[q.INBOX]=false;this._isFolderLoaded[q.OTHER]=false;this._folderIsLoading=[];this._folderIsLoading[q.INBOX]=false;this._folderIsLoading[q.OTHER]=false;u.subscribe('threadlist-updated',this.render.bind(this));if(j.OtherFolderJewelGK)u.subscribe('unread-updated',ja.bind(this));this.render();da.bump('opened_threadlist_'+this._currentFolder);m.listen(this._contentArea,'scroll',ba(fa,50,this));m.listen(this._loadMoreLink,'click',this.renderMoreThreads.bind(this));}y(ea,{EVENT_THREADS_LOADED:'threads-loaded',EVENT_THREADS_RENDERED:'threads-rendered'});y(ea.prototype,h);y(ea.prototype,{render:function(){l.empty(this._contentElement);k.show(this._loadingElement);k.hide(this._loadMoreButton);var la=l.create('div');l.appendContent(this._contentElement,la);r.getThreadlist(p.RECENT_THREAD_OFFSET,this._curCount[this._currentFolder],this._currentFolder,this.renderThreads.bind(this,la),true);},renderThreads:function(la,ma){this.inform(ea.EVENT_THREADS_LOADED);if(ma.length){ma.forEach(function(na){var oa=t[':fb:mercury:jewel:threadlist-row'].build();w.getThreadMeta(na,function(pa){v.renderCoreThreadlist(pa,oa,this.renderSingleThread.bind(this),{show_unread_count:true});}.bind(this));l.appendContent(la,oa.getRoot());}.bind(this));}else l.setContent(this._contentElement,this.renderEmptyThreadlist());k.hide(this._loadingElement);k.conditionShow(this._loadMoreButton,!this._isFolderLoaded[this._currentFolder]);this.inform(ea.EVENT_THREADS_RENDERED);},renderSingleThread:function(la,ma){if(ma.unread_count>0)k.addClass(la.getRoot(),'jewelItemNew');if(j.MessagesJewelOpenInChat&&i.canOpenChatTab(ma)){m.listen(la.getRoot(),'click',function(event){g.inform('chat/open-tab',{thread_id:ma.thread_id});});}else v.renderTitanLink(ma.thread_id,la.getNode('link'),null,this._currentFolder);m.listen(la.getRoot(),'mouseover',function(event){var na=la.getRoot();if(!s.byClass(na,'notifNegativeBase'))k.addClass(na,'selected');});m.listen(la.getRoot(),'mouseout',function(event){k.removeClass(la.getRoot(),'selected');});},renderMoreThreads:function(){k.addClass(this._loadMoreButton,'async_saving');this._folderIsLoading[this._currentFolder]=true;var la=this._curCount[this._currentFolder]+p.JEWEL_MORE_COUNT;r.getThreadlist(p.RECENT_THREAD_OFFSET,la+1,this._currentFolder,ha.bind(this,la,this._currentFolder),true,o.JEWEL);},renderEmptyThreadlist:function(){return l.create('li',{className:'empty'},"No messages");}});function fa(){if(!this._isFolderLoaded[this._currentFolder]&&!this._folderIsLoading[this._currentFolder]&&ga.bind(this)())this.renderMoreThreads();}function ga(){return this._contentArea.scrollTop+this._contentArea.clientHeight>=this._contentArea.scrollHeight-1;}function ha(la,ma,na){this._curCount[ma]=la;if(!this._isFolderLoaded[ma]&&na.length<this._curCount[ma]+1)this._isFolderLoaded[ma]=true;this._folderIsLoading[ma]=false;k.removeClass(this._loadMoreButton,'async_saving');this.render();}function ia(la){if(this._currentFolder!=la){da.bump('opened_threadlist_'+la);k.addClass(this._jewelFolderLinks[la],"_1sdd");k.removeClass(this._jewelFolderLinks[this._currentFolder],"_1sdd");this._currentFolder=la;this.render();}}function ja(){ka.bind(this)(q.INBOX);ka.bind(this)(q.OTHER);}function ka(la){var ma;if(x.exceedsMaxCount(la)){ma=p.MAX_UNREAD_COUNT;}else ma=x.getUnreadCount(la);var na=this._jewelFolderCounts[la];if(ma>0){if(ma==p.MAX_UNREAD_COUNT)ma+='+';l.setContent(na,ca._("({unread_count})",{unread_count:ma}));}else l.setContent(na,'');}e.exports=ea;});
__d("MercuryJewel",["MercuryChannelHandler","MercuryJewelCountControl","DOM","MercuryJewelThreadlistControl","MercuryServerRequests","userAction"],function(a,b,c,d,e,f){b('MercuryChannelHandler');var g=b('MercuryJewelCountControl'),h=b('DOM'),i=b('MercuryJewelThreadlistControl'),j=b('MercuryServerRequests').get(),k=b('userAction'),l=false;function m(q,r,s,t){j.handleUpdate(t);var u=new g(r,s),v=h.find(q,'#MercuryJewelThreadList');if(s.getRoot()&&s.isOpen()){n.call(this,v,q);}else s.subscribe('opened',n.bind(this,v,q));}e.exports=m;function n(q,r){this._ua=k('messages').uai('click','jewel');this._listenForLoad=this._listenForRender=true;if(!l){var s=new i(q,r);s.subscribe(i.EVENT_THREADS_LOADED,o.bind(this));s.subscribe(i.EVENT_THREADS_RENDERED,p.bind(this));l=true;}}function o(){if(this._listenForLoad){this._ua.add_event('loaded');this._listenForLoad=false;}}function p(){if(this._listenForRender){this._ua.add_event('rendered');this._listenForRender=false;}}});
__d("MessagingEvents",["Arbiter","ChannelConstants","arrayContains","copyProperties","isEmpty"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChannelConstants'),i=b('arrayContains'),j=b('copyProperties'),k=b('isEmpty'),l={},m=new g();function n(o){if(!k(l))return;for(var p in o)m.inform('count/'+p,o[p]);}m.subscribe('mark-as-read',function(o,p){(p.tids||p.chat_ids||[]).forEach(function(q){q=''+q;if(!(q in l)){l[q]=true;var r=function(){m.unsubscribe(s);clearTimeout(t);delete l[q];},s=m.subscribe('read',function(u,v){if(i((v.tids||[]),q)||i((v.chat_ids||[]),q))r();}),t=r.defer(60000);}});});g.subscribe(h.getArbiterType('messaging'),function(o,p){var q=j({},p.obj),event=q.event||'';delete q.type;delete q.event;m.inform(event,q);if('unread_counts' in q){var r=q.unread_counts;n({unread:r.inbox,other_unseen:r.other});}});g.subscribe(h.getArbiterType('inbox'),function(o,p){var q=j(p.obj);delete q.type;n(q);});a.MessagingEvents=e.exports=m;},3);
__d("TitanLeftNav",["CounterDisplay","MessagingEvents"],function(a,b,c,d,e,f){var g=b('CounterDisplay'),h=b('MessagingEvents'),i={initialize:function(){h.subscribe('count/other_unseen',function(j,k){g.setCount('other_unseen',k);});}};e.exports=i;});
__d("AccessibleMenu",["Event","CSS","DOM","Keys","TabbableElements","Toggler"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('DOM'),j=b('Keys'),k=b('TabbableElements'),l=b('Toggler'),m,n,o;function p(){var x=i.scry(m,'a[rel="toggle"]')[0];x&&x.focus();l.getInstance(m).hide();}function q(x){if(!x)return false;h.removeClass(x,'selected');x.setAttribute('aria-selected','false');}function r(x){if(!x)return false;h.addClass(x,'selected');x.setAttribute('aria-selected','true');var y=k.find(x);if(y[0])y[0].focus();}function s(x){var y=i.scry(m,'.selected')[0],z=n.indexOf(y)+x,aa=n[z];if(!aa)return false;q(y);r(aa);}function t(x){if(!l.isShown()||l.getActive()!==m)return true;var y=g.getKeyCode(x);switch(y){case j.TAB:s(x.shiftKey?-1:1);g.prevent(x);break;case j.ESC:p();g.prevent(x);break;case j.UP:case j.DOWN:s(y===j.UP?-1:1);g.prevent(x);break;}}function u(x,y){m=y.getActive();n=i.scry(m,'[role="menuitem"]');if(!o)o=g.listen(document.documentElement,'keydown',t);}function v(){if(l.getActive()==m)q(i.scry(m,'.selected')[0]);}var w={init:function(x){l.listen('show',x,u);l.listen('hide',x,v);}};e.exports=w;});
__d("UserNoOp",["copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('emptyFunction'),i=function(){};g(i.prototype,{add_event:h.thatReturnsThis,add_data:h.thatReturnsThis,uai:h.thatReturnsThis,uai_fallback:h.thatReturnsThis});e.exports=i;});
__d("isEmail",[],function(a,b,c,d,e,f){var g=/^[\w!#\$%&'\*\+\/\=\?\^`\{\|\}~\-]+(:?\.[\w!#\$%&`\*\+\/\=\?\^`\{\|\}~\-]+)*@(?:[a-z0-9](?:[a-z0-9\-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9\-]*[a-z0-9])?$/i;function h(i){return g.test(i);}e.exports=h;});
__d("NegativeNotif",["Animation","AsyncRequest","CSS","DataStore","DOM","Event","Parent","Tooltip","NotifXList","$","clickRefAction","copyProperties","userAction"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('AsyncRequest'),i=b('CSS'),j=b('DataStore'),k=b('DOM'),l=b('Event'),m=b('Parent'),n=b('Tooltip'),o=b('NotifXList'),p=b('$'),q=b('clickRefAction'),r=b('copyProperties'),s=b('userAction');function t(u,v){r(this,v);this.owner=u;this.xLink=k.find(this.obj,'.notif_x');this.confirmingMsg=k.find(this.obj,'.confirmingMsg');this.mainLink=k.find(this.obj,'.notifMainLink');this.userXClicked=false;this.userUnsubscribed=false;l.listen(this.xLink,'click',this.xClick.bind(this));if(i.hasClass(this.obj,'first_receipt')&&i.hasClass(p('jewelContainer'),'notifGentleAppReceipt'))this.gentleFirstReceiptHoverEventHandler=l.listen(this.obj,'mouseover',this.gentleFirstReceiptNotifHover.bind(this));}r(t.prototype,{FADE_AWAY_DURATION:2500,X_OUT_DURATION:100,X_OUT_DURATION_SHORT:2,GENTLE_FRUI_MIN_HOVER_DURATION:500,GENTLE_FRUI_FADE_DURATION_FAST:200,GENTLE_FRUI_FADE_DURATION_SLOW:2500,GENTLE_FRUI_DELAY_FADE_TIME:60000,xClick:function(event){this._activateX();var u=this.xLink.getAttribute('data-gt'),v=u?{gt:JSON.parse(u)}:{};s('xbutton',this.xLink,event).uai('click');q('click',this.xLink,event,null,v);return false;},gentleFirstReceiptNotifHover:function(event){event.stop();var u=k.find(this.obj,'.first_receipt_no_button'),v=j.get(u,'notif_fr_prompt');n.set(u,v,'above','center');n.show(u);this._gentleFirstReceiptTooltipFadeIn();if(!this.gentleFirstReceiptUnhoverEventHandler){this.hoverTime=new Date();this.gentleFirstReceiptUnhoverEventHandler=l.listen(document.documentElement,'mouseover',this.gentleFirstReceiptNotifUnhover.bind(this));}if(!this.gentleFirstReceiptNoClickEventHandler)this.gentleFirstReceiptNoClickEventHandler=l.listen(u,'click',this.gentleFirstReceiptNoClick.bind(this));},gentleFirstReceiptNotifUnhover:function(event){if(m.byClass(event.getTarget(),'uiContextualLayer')||m.byClass(event.getTarget(),'uiScrollableAreaTrack'))return false;var u=new Date();if(this.hoverTime&&u-this.hoverTime<this.GENTLE_FRUI_MIN_HOVER_DURATION){this.gentleFirstReceiptUnhoverEventHandler.remove();this.gentleFirstReceiptUnhoverEventHandler=null;this._gentleFirstReceiptTooltipAlreadyFadedIn=false;return;}this._removeGentleFirstReceiptListeners();this._gentleFirstReceiptTooltipFadeAway();this._gentleFirstReceiptXButtonFadeAway();var v=this;setTimeout(function(){v._gentleFirstReceiptUIFadeAway();},this.GENTLE_FRUI_DELAY_FADE_TIME);this._sendFirstReceiptYesToServer();},gentleFirstReceiptNoClick:function(event){this._removeGentleFirstReceiptListeners();},restore:function(){if(o.newNotifExist(this.id)){o.resumeInsert(this.id);}else o.removeNotif(this.id);this._confirmingMsgFadeAway(this.confirmingMsg);this._notifMainLinkShowUp(this.mainLink);this._buttonShowUp(this.xLink);this._adjustContainer(this.obj);},reset:function(){if(this.userXClicked&&!this.userUnsubscribed){this.userXClicked=false;this.restore();}},onTurnedOff:function(){this.userUnsubscribed=true;i.hide(this.confirmingMsg);this._notifMainLinkShowUp(k.find(this.obj,'.confirmedMsg'));this._adjustContainer(this.obj);},onUndid:function(){this.userXClicked=false;this.userUnsubscribed=false;this.restore();i.show(this.confirmingMsg);this._notifMainLinkFadeAway(k.find(this.obj,'.confirmedMsg'));k.remove(k.find(this.obj,'.confirmedMsg'));},onMarkedSpam:function(){k.remove(k.find(this.obj,'.confirmedMsg'));this._fadeAway(k.find(this.obj,'.spamMsg'));},onFirstReceiptYes:function(){this._hideFirstReceiptDiv();this._fadeAway(k.find(this.obj,'.firstConfirmedMsg'));},onFirstReceiptNo:function(){this._hideFirstReceiptDiv();i.hide(this.confirmingMsg);this._activateX();new h().setURI('/ajax/notifications/negative_req.php').setData({request_type:'turn_off',notification_id:this.id}).send();},_sendFirstReceiptYesToServer:function(){new h().setURI('/ajax/notifications/negative_req.php').setData({request_type:'first_receipt_yes',notification_id:this.id}).send();},_gentleFirstReceiptTooltipFadeIn:function(){if(this._gentleFirstReceiptTooltipAlreadyFadedIn)return;var u=k.find(document.documentElement,'.uiLayer .uiContextualLayer .uiTooltipX');new g(u).from('opacity','0').to('opacity','1').duration(this.GENTLE_FRUI_FADE_DURATION_FAST).go();this._gentleFirstReceiptTooltipAlreadyFadedIn=true;},_gentleFirstReceiptTooltipFadeAway:function(){if(!this._gentleFirstReceiptTooltipAlreadyFadedIn)return;var u=k.find(document.documentElement,'.uiLayer .uiContextualLayer .uiTooltipX'),v=m.byClass(u,'uiLayer'),w=v.cloneNode(true);k.insertAfter(v,w);new g(w).from('opacity','1').to('opacity','0').duration(this.GENTLE_FRUI_FADE_DURATION_FAST).ondone(function(){k.remove(w);}).go();this._gentleFirstReceiptTooltipAlreadyFadedIn=false;},_gentleFirstReceiptXButtonFadeAway:function(){var u=k.find(this.obj,'.first_receipt_no_button');new g(u).from('opacity','1').to('opacity','0').duration(this.GENTLE_FRUI_FADE_DURATION_FAST).hide().go();i.addClass(this.obj,'show_original_x');},_gentleFirstReceiptUIFadeAway:function(){var u=this.obj;this.new_label=k.find(this.obj,'.notif_new_label');new g(this.new_label).to('opacity','0').duration(this.GENTLE_FRUI_FADE_DURATION_SLOW).ondone(function(){i.removeClass(u,'first_receipt');}).go();if(!i.hasClass(this.obj,'jewelItemNew'))new g(this.obj).from('backgroundColor','#ECEFF5').to('backgroundColor','#FFFFFF').duration(this.GENTLE_FRUI_FADE_DURATION_SLOW).go();},_removeGentleFirstReceiptListeners:function(){if(this.gentleFirstReceiptHoverEventHandler)this.gentleFirstReceiptHoverEventHandler.remove();if(this.gentleFirstReceiptUnhoverEventHandler)this.gentleFirstReceiptUnhoverEventHandler.remove();if(this.gentleFirstReceiptNoClickEventHandler)this.gentleFirstReceiptNoClickEventHandler.remove();},_activateX:function(){i.addClass(this.obj,'forPushSafety');this.userXClicked=true;o.userXClick(this.id);this._notifMainLinkFadeAway(this.mainLink);this._buttonFadeAway(this.xLink);if(i.shown(this.confirmingMsg))this._confirmingMsgShowUp(this.confirmingMsg);this._adjustContainer(this.obj);},_hideFirstReceiptDiv:function(){i.removeClass(this.obj,'first_receipt');i.hide(k.find(this.obj,'.first_receipt_div'));},_fadeAway:function(u){new g(u).from('backgroundColor','#FFF9D7').to('backgroundColor','#FFFFFF').duration(this.FADE_AWAY_DURATION).checkpoint().to('opacity','0').blind().duration(this.X_OUT_DURATION).checkpoint().to('height','0px').to('paddingTop','0px').to('paddingBottom','0px').blind().hide().duration(this.X_OUT_DURATION).go();},_adjustContainer:function(u){new g(u).by('height','0px').duration(this.X_OUT_DURATION).checkpoint().by('height','0px').duration(this.X_OUT_DURATION_SHORT).checkpoint().to('height','auto').duration(this.X_OUT_DURATION).go();},_notifMainLinkShowUp:function(u){new g(u).duration(this.X_OUT_DURATION).checkpoint().to('height','auto').to('paddingTop','4px').to('paddingBottom','4px').blind().show().duration(this.X_OUT_DURATION_SHORT).checkpoint().to('opacity','1').blind().duration(this.X_OUT_DURATION).go();},_confirmingMsgShowUp:function(u){new g(u).duration(this.X_OUT_DURATION).checkpoint().to('height','auto').to('paddingTop','10px').to('paddingBottom','10px').blind().show().duration(this.X_OUT_DURATION_SHORT).checkpoint().to('opacity','1').blind().duration(this.X_OUT_DURATION).go();},_notifMainLinkFadeAway:function(u){new g(u).to('opacity','0').blind().duration(this.X_OUT_DURATION).checkpoint().to('height','0px').to('paddingTop','0px').to('paddingBottom','0px').blind().hide().duration(this.X_OUT_DURATION_SHORT).go();},_confirmingMsgFadeAway:function(u){new g(u).to('opacity','0').blind().duration(this.X_OUT_DURATION).checkpoint().to('height','0px').to('paddingTop','0px').to('paddingBottom','0px').blind().duration(this.X_OUT_DURATION_SHORT).go();},_buttonShowUp:function(u){new g(u).duration(this.X_OUT_DURATION).checkpoint().show().duration(this.X_OUT_DURATION_SHORT).checkpoint().to('opacity','1').blind().duration(this.X_OUT_DURATION).go();},_buttonFadeAway:function(u){new g(u).to('opacity','0').blind().duration(this.X_OUT_DURATION).checkpoint().hide().duration(this.X_OUT_DURATION_SHORT).go();}});e.exports=t;});
__d("NotificationCounter",["copyProperties","invariant","Arbiter","Bootloader","DocumentTitle","JSLogger"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('invariant'),i=b('Arbiter'),j=b('Bootloader'),k=b('DocumentTitle'),l=b('JSLogger'),m={messages:0,notifications:0,requests:0},n=null,o=null,p={init:function(q){n=g({updateTitle:true,updateFavicon:false,favicons:{}},q);if(n.updateFavicon)h(n.favicons.many);if(n.updateTitle)i.subscribe('update_title',this._handleUpdateTitle.bind(this));i.subscribe('jewel/count-updated',this._handleCountUpdate.bind(this));if(q&&q.countNewsfeed){j.loadModules(['LitestandNewsfeedCountUpdater'],function(r){r.init();});i.subscribe('LitestandMessages/UpdateHomeCount',function(event,r){var s=r.active?0:r.count;this._handleCountUpdate(event,{count:s,jewel:'newsfeed'});}.bind(this));}},getCount:function(){var q=0;for(var r in m){var s=Number(m[r]);if(typeof m[r]=='string'&&isNaN(s))return m[r];if(isNaN(s)||s<0){l.create('jewels').error('bad_count',{jewel:r,count:m[r]});continue;}q+=s;}return q;},updateTitle:function(){var q=this.getCount(),r=k.get();r=q?'('+q+') '+r:r;k.set(r,true);},_getFaviconNode:function(){if(!o){o=document.createElement('link');o.rel='shortcut icon';document.getElementsByTagName('head')[0].appendChild(o);}return o;},_getFaviconImage:function(){return n.favicons[this.getCount()]||n.favicons.many;},updateFavicon:function(){this._getFaviconNode().href=this._getFaviconImage();},_handleCountUpdate:function(q,r){m[r.jewel]=r.count;if(n.updateFavicon)this.updateFavicon();if(n.updateTitle)this.updateTitle();},_handleUpdateTitle:function(q,r){this.updateTitle();}};e.exports=p;});
__d("NotificationList",["Animation","ArbiterMixin","CSS","DOM","DoublyLinkedListMap","HTML","NotificationURI","Tooltip","Event","$","copyProperties","ge","isEmpty","tx","hasArrayNature"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('ArbiterMixin'),i=b('CSS'),j=b('DOM'),k=b('DoublyLinkedListMap'),l=b('HTML'),m=b('NotificationURI'),n=b('Tooltip'),o=b('Event'),p=b('$'),q=b('copyProperties'),r=b('ge'),s=b('isEmpty'),t=b('tx'),u=b('hasArrayNature'),v="0",w="1",x="2";function y(ba){return ba==w||ba==x;}function z(ba){return ba==w;}function aa(ba,ca){this._list=new k();this._filter_func=null;this.unseenCount=0;this.contentRoot=ba;this.noItemsElement=null;this.ITEM_TAG='li';this.ITEM_CLASS='notification';this.NO_ITEMS_ID='jewelNoNotifications';this.NO_ITEMS_CLASS='empty';this.compare=ca.compare||this.compare;this.shouldBlockAnimation=ca.shouldBlockAnimation||null;this.unseenVsUnread=ca.unseenVsUnread||false;this.markReadSignalServer=ca.markReadSignalServer;this.animations={};}q(aa,{ITEM_UNREAD_CLASS:'jewelItemNew',MARK_READ_TYPE:'mark_read',UNREAD_COUNT_CHANGE_TYPE:'unread_count_change',INSERTION_TYPE:'insert',REMOVAL_TYPE:'remove',getIdFromDom:function(ba){return ba.getAttribute('id').replace('notification_','');},localizeUrls:function(ba){j.scry(ba,'a').forEach(function(ca){ca.href=m.localize(ca.href);});}});q(aa.prototype,h,{FADE_DURATION:250,RESIZE_DURATION:200,_getField:function(ba,ca){var da=this._list.get(ba);return da&&da[ca];},getDomObj:function(ba){return this._getField(ba,'obj');},fromDom:function(){var ba=this.ITEM_TAG+'.'+this.ITEM_CLASS,ca=j.scry(this.contentRoot,ba);for(var da=0;da<ca.length;++da){var ea=ca[da],fa=aa.getIdFromDom(ea);this.insert(fa,ea.getAttribute('data-notiftime'),null);}},compare:function(ba,ca){return ba.time<ca.time||(ba.time===ca.time&&ba.id<ca.id);},insert:function(ba,ca,da,ea,fa,ga){var ha=w,ia=0,ja=this._list.exists(ba),ka=ga&&this._list.exists(ga),la=null,ma;if(ja||ka)if(!(ea&&da)){return false;}else{if(this._filter_func){ma={notif_id:ba,notif_time:ca,notif_markup:da,replace:ea,ignoreUnread:fa,notif_alt_id:ga};if(this._filter_func(ma))return false;}ha=this._getField(ba,'readness');ia=this._getField(ba,'time');if(ia>ca)return false;la=ja?ba:ga;this._remove(la);}var na=(da&&l(da).getRootNode())||p('notification_'+ba),oa=Math.max(ca,ia),pa=na.getAttribute('data-readness');if(!this.unseenVsUnread&&x==pa)pa=v;ma={id:ba,obj:na,time:oa,readness:pa,app_id:na.getAttribute('data-appid')};this._insert(ma);this._setUpReadStateToggle(ba,na);aa.localizeUrls(na);this.noItemsElement&&i.hide(this.noItemsElement);if(z(pa)){fa&&!y(ha)&&this.markRead([ba]);this.unseenCount=this.getUnseenIds().length;this.inform(aa.UNREAD_COUNT_CHANGE_TYPE);}var qa=!la||ia<oa||(pa&&!ha&&!fa);this.inform(aa.INSERTION_TYPE,{id:ba,is_new:qa,obj:na,replaced_id:la,time:oa});return true;},_setReadStateToggleReadness:function(ba,ca){var da;if(ca){da=this.unseenVsUnread?"Mark as Read":"Unread";}else da="Read";i.conditionClass(ba,'active_toggle',ca&&this.unseenVsUnread);n.set(ba,da,'above','center');},_setUpReadStateToggle:function(ba,ca){var da=this.isUnreadId(ba),ea=j.scry(ca,'.read_toggle')[0];if(!ea)return;this._setReadStateToggleReadness(ea,da);var fa=function(event){if(this.unseenVsUnread&&this.isUnreadId(ba))this.markReadSignalServer([ba]);o.kill(event);return false;};o.listen(ea,'click',fa.bind(this));},showNoNotifications:function(){if(null==this.noItemsElement)this.noItemsElement=r(this.NO_ITEMS_ID);if(null==this.noItemsElement){this.noItemsElement=j.create(this.ITEM_TAG,{id:this.NO_ITEMS_ID,className:this.NO_ITEMS_CLASS},"No new notifications");j.appendContent(this.contentRoot,this.noItemsElement);}i.show(this.noItemsElement);},_insert:function(ba){this._list.remove(ba.id);var ca=null;this._list.find(function(ea){var fa=this.compare(ea,ba);!fa&&(ca=ea.id);return fa;}.bind(this));var da=this.getDomObj(ca);if(da){this._list.insertAfter(ba.id,ba,ca);j.insertAfter(da,ba.obj);}else{this._list.prepend(ba.id,ba);j.prependContent(this.contentRoot,ba.obj);}},_remove:function(ba){var ca=this._getField(ba,'obj');if(!ca)return false;this.inform(aa.REMOVAL_TYPE,{id:ba});this._list.remove(ba);j.remove(ca);this.isEmpty()&&this.showNoNotifications();return true;},getUnreadIds:function(){return this._list.reduce(function(ba,ca){y(ba.readness)&&ca.push(ba.id);return ca;},[]);},getUnseenIds:function(){return this._list.reduce(function(ba,ca){z(ba.readness)&&ca.push(ba.id);return ca;},[]);},getIds:function(){return this._list.reduce(function(ba,ca){ca.push(ba.id);return ca;},[]);},isUnreadId:function(ba){var ca=this.getDomObj(ba);return y(this._getField(ba,'readness'))||(ca&&i.hasClass(ca,aa.ITEM_UNREAD_CLASS));},isUnseenId:function(ba){return z(this._getField(ba,'readness'));},markRead:function(ba,ca){ba=ba?ba.filter(this.isUnreadId.bind(this)):this.getUnreadIds();var da=false;for(var ea=0;ea<ba.length;ea++){var fa=this._list.get(ba[ea]);if(fa){if(this._setReadness(ba[ea],v))da=true;if(ca){this._markReadInDom(ba[ea],fa.obj);}else this.animateMarkRead(fa.obj);}}if(da){this.unseenCount=this.getUnseenIds().length;this.inform(aa.UNREAD_COUNT_CHANGE_TYPE);}},markSeen:function(ba){if(!u(ba))return;if(!this.unseenVsUnread){this.markRead(ba);return;}ba=ba.filter(this.isUnseenId.bind(this));var ca=false;for(var da=0;da<ba.length;da++)if(this._setReadness(ba[da],x))ca=true;if(ca){this.unseenCount=this.getUnseenIds().length;this.inform(aa.UNREAD_COUNT_CHANGE_TYPE);}},_setReadness:function(ba,ca){var da=this._list.get(ba);if(!da||da.readness==ca)return false;if(da.readness==v&&ca==x)return false;da.readness=ca;da.obj.setAttribute('data-readness',ca);return true;},_markReadInDom:function(ba,ca){if(!this.isUnreadId(ba))return;var da=p(ca);if(da){this.stopAnimation(ba);i.removeClass(da,aa.ITEM_UNREAD_CLASS);var ea=j.scry(da,'.read_toggle')[0];ea&&this._setReadStateToggleReadness(ea,false);}},animateMarkRead:function(ba){if(!i.hasClass(ba,aa.ITEM_UNREAD_CLASS))return;var ca=aa.getIdFromDom(ba),da=this._markReadInDom.bind(this,ca,ba);if(i.hasClass(ba,'fbJewelBeep')){da();return;}if(this.shouldBlockAnimation&&this.shouldBlockAnimation(ba))return;da.defer(10000);},stopAnimation:function(ba){ba in this.animations&&this.animations[ba].stop();delete this.animations[ba];return true;},insertMany:function(ba,ca){if('object'==typeof ba&&!s(ba)){for(var da in ba){var ea=ba[da];this.insert(da,ea.time,ea.markup,true,ca,ea.alt_id||null);}this.noItemsElement&&i.hide(this.noItemsElement);}else this.isEmpty()&&this.showNoNotifications();},isEmpty:function(){return this._list.isEmpty();},getEarliestNotifTime:function(){return this._list.isEmpty()?0:Math.min.apply(null,this.getIds().map(function(ba){return this._getField(ba,'time');}.bind(this)));},setFilterFn:function(ba){this._filter_func=ba;},toggleNotifsSimilarTo:function(ba,ca,da){var ea=this._getField(ba,'app_id');if(ea){var fa=this.getIds();for(var ga=0;ga<fa.length;++ga)if(ea==this._getField(fa[ga],'app_id')){var ha=this.getDomObj(fa[ga]);if(ba!=fa[ga])ca?this._hideWithAnimation(ha):this._showWithAnimation(ha);var ia=j.scry(ha,'.first_receipt_div');if(ia.length==1)if(da){i.hide(ia[0]);i.removeClass(ha,'first_receipt');}else{i.show(ia[0]);i.addClass(ha,'first_receipt');}}}},_hideWithAnimation:function(ba){new g(ba).to('opacity','0').blind().duration(this.FADE_DURATION).checkpoint().to('height','0px').to('paddingTop','0px').to('paddingBottom','0px').blind().hide().duration(this.RESIZE_DURATION).go();},_showWithAnimation:function(ba){new g(ba).to('height','auto').to('paddingTop','auto').to('paddingBottom','auto').blind().show().duration(this.RESIZE_DURATION).checkpoint().to('opacity','1').blind().duration(this.FADE_DURATION).go();}});e.exports=aa;});
__d("Notifications",["Animation","Arbiter","AsyncRequest","AsyncSignal","Bootloader","ChannelConstants","CSS","DOM","Env","Event","JSLogger","NegativeNotif","NotificationCounter","NotificationList","NotifXList","Parent","Poller","ScrollableArea","Style","SystemEvents","Toggler","URI","UserActivity","UserNoOp","Vector","$","copyProperties","emptyFunction","ge","hasArrayNature","isEmpty","shield","throttle","userAction"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('AsyncSignal'),k=b('Bootloader'),l=b('ChannelConstants'),m=b('CSS'),n=b('DOM'),o=b('Env'),p=b('Event'),q=b('JSLogger'),r=b('NegativeNotif'),s=b('NotificationCounter'),t=b('NotificationList'),u=b('NotifXList'),v=b('Parent'),w=b('Poller'),x=b('ScrollableArea'),y=b('Style'),z=b('SystemEvents'),aa=b('Toggler'),ba=b('URI'),ca=b('UserActivity'),da=b('UserNoOp'),ea=b('Vector'),fa=b('$'),ga=b('copyProperties'),ha=b('emptyFunction'),ia=b('ge'),ja=b('hasArrayNature'),ka=b('isEmpty'),la=b('shield'),ma=b('throttle'),na=b('userAction');function oa(pa){this.updateTime=pa.updateTime||Date.now();this.update_period=pa.updatePeriod||60000;this.latest_notif_time=pa.latestNotif||0;this.latest_read_notif_time=pa.latestReadNotif||0;this.cache_version=pa.cacheVersion||0;this.notifReceivedType=pa.notifReceivedType||'notification';this.wrapperID=pa.wrapperID||'notificationsWrapper';this.contentID=pa.contentID||'jewelNotifs';this.shouldLogImpressions=pa.shouldLogImpressions||false;this.allowDesktopNotifications=pa.allowDesktopNotifications||false;this.logAutoShutOffImpression=true;this.useInfiniteScroll=pa.useInfiniteScroll||false;this.unseenVsUnread=pa.unseenVsUnread||false;this.counterConfig=pa.counterConfig||{};this.scrollableAreaNode=null;this.firstReceiptMap={};this.user=o.user;this.queuedNotifications=[];this.timeElement='small.time';this.ua=new da();this._init();}ga(oa.prototype,{TIME_TRAVEL:'time_travel',ONLINE:'online',SCROLL_OFF_TINY:'scroll_off_tiny',INACTIVE_REFRESH:'inactive_refresh',_init:function(){this.cookieName='notifications_'+this.user;this.updateCheckCount=0;this.fetchListeners=[];this.currentFetchRequest=null;this.wrapper=ia(this.wrapperID);this.content=ia(this.contentID);this.jewelFlyout=ia('fbNotificationsFlyout');this.footer=n.find(this.jewelFlyout,'.jewelFooter');this.loadingIndicator=ia(this.contentID+'_loading_indicator');this.NOTIF_JEWEL_REF='notif_jewel';this.notifLogger=q.create('notifications');s.init(this.counterConfig);this.alertList=new t(this.content,this._getListParams());this._updateCount();a.MinNotifications&&a.MinNotifications.fetchSent()&&(this.fetch=ha);h.subscribe(l.getArbiterType(this.notifReceivedType),this._handleNotificationMsg.bind(this));h.subscribe(l.getArbiterType('notifications_read'),this._handleNotificationsReadMsg.bind(this));h.subscribe(l.getArbiterType('notifications_seen'),this._handleNotificationsSeenMsg.bind(this));h.subscribe('jewel/resize',la(this._hideOverflow,this));this.alertList.subscribe(t.UNREAD_COUNT_CHANGE_TYPE,this._updateCount.bind(this));this._poller=new w({interval:this.update_period,setupRequest:this._update.bind(this),clearOnQuicklingEvents:false,dontStart:true});this._poller.start.bind(this._poller).defer(this.update_period,false);if(this.wrapper)this.countSpan=n.find(this.wrapper,'span.jewelCount span');this.initializeEvents();this.fromDom();if(this.useInfiniteScroll){this._autoLoadNotifIndex=1;this._truncate=false;this.alertList.subscribe(t.INSERTION_TYPE,this._handleInsert.bind(this));}},_getListParams:function(){return {shouldBlockAnimation:function(pa){return this.isNotifJewelOpen();}.bind(this),unseenVsUnread:this.unseenVsUnread,markReadSignalServer:this.markRead.bind(this).curry(true)};},fromDom:function(){this.alertList.fromDom();a.MinNotifications&&a.MinNotifications.fetched()&&this.alertList.isEmpty()&&this.alertList.showNoNotifications();},initializeEvents:function(){var pa=this.alertList.ITEM_TAG,qa=null;p.listen(this.content,{mouseover:function(event){var ta=event.getTarget();qa=v.byTag(ta,pa);if(qa&&ta!=qa)if(v.byClass(qa,'notifNegativeBase')){m.addClass(qa,'notifHover');}else m.addClass(qa,'selected');},mouseout:function(event){qa&&m.removeClass(qa,'selected');qa&&m.removeClass(qa,'notifHover');qa=null;},mousedown:this.onContentMouseDown.bind(this)});p.listen(this.wrapper,'mouseover',this.onMouseOver.bind(this));aa.listen('show',this.wrapper,this.onClick.bind(this));aa.listen('hide',this.wrapper,this.onHide.bind(this));this.shouldLogImpressions&&aa.listen('show',this.wrapper,this._logImpression.bind(this));var ra=function(ta){this._poller.request();this.notifLogger.bump(ta);}.bind(this);z.subscribe(z.TIME_TRAVEL,ra.curry(this.TIME_TRAVEL));z.subscribe(z.ONLINE,function(ta,ua){ua&&ra(this.ONLINE);});var sa=1000*60*60;ca.subscribe(function(ta,ua){(ua.idleness>sa)&&ra(this.INACTIVE_REFRESH);}.bind(this));this.negativeNotifs={};this._initNotifNegativeFeedback();if(this.useInfiniteScroll){this._setupScroll();this._initializeScrollEvents();this._updateScrollDataStructures.bind(this).defer();this._hideOverflow();}},_setupScroll:function(){this._scrollArea=n.scry(this.jewelFlyout,'div.uiScrollableAreaWrap')[0];this._morePagerLink=n.find(this.jewelFlyout,'.notifMorePager a');this._morePager=v.byClass(this._morePagerLink,'notifMorePager')||this._morePagerLink;this._infiniteScrollNotif=null;this.afterFirstFetch=false;this.animate=false;if(a.MinNotifications&&a.MinNotifications.fetched()){this.afterFirstFetch=true;m.show(this._morePager);}},_initializeScrollEvents:function(){p.listen(this._scrollArea,'scroll',ma(this._handleScroll.bind(this)));p.listen(this._morePagerLink,'success',function(pa){this.fetchHandler(pa.getData().response);}.bind(this));},_updateScrollDataStructures:function(){var pa=this.alertList.getIds(),qa=Math.max(0,pa.length-this._autoLoadNotifIndex);this._infiniteScrollNotif=this.alertList.getDomObj(pa[qa]);this._annotateMorePagerURI();},_annotateMorePagerURI:function(){this._morePagerLink.setAttribute('ajaxify',new ba(this._morePagerLink.getAttribute('ajaxify')).addQueryData({earliest_time:this.alertList.getEarliestNotifTime()}));},onContentMouseDown:function(event){var pa=v.byTag(event.getTarget(),this.alertList.ITEM_TAG),qa=pa&&t.getIdFromDom(pa);if(qa&&this.alertList.isUnreadId(qa))this.markRead(true,[qa]);},onMouseOver:function(event){if(m.hasClass(event.getTarget(),"jewelButton"))this.ua=na('notifs',event.target,event,{mode:'DEDUP'}).uai('mouseover','jewel').add_event('hover');this.fetch();},onClick:function(){a.ArbiterMonitor&&this.fetch!=ha&&h.registerCallback(ha,['notifs/fetched']);this.ua.add_event('show');this.fetch();this.markRead(true);this._hideOverflow();if(this.scrollableAreaNode){var pa=x.getInstance(this.scrollableAreaNode);pa&&pa.poke();}},onHide:function(){this.animate=false;this.animation&&this.animation.stop();this.ua.add_event('hide');this.markRead(true);this._dequeueNotifications();},_dequeueNotifications:function(){this.queuedNotifications.forEach(function(pa){this._displayNotification(pa.type,pa.data);},this);this.queuedNotifications.length=0;},_handleScroll:function(){if(this._checkInfiniteScroll()){this._autoLoadNotifIndex=5;this._sendFetchRequest(this._morePager);}},_handleInsert:function(pa,qa){if(qa.is_new)this._newDataFromInsert=true;this._updateScrollDataStructures();},_checkInfiniteScroll:function(){if(this._infiniteScrollNotif&&this._scrollArea){var pa=ea.getElementPosition(this._infiniteScrollNotif).y,qa=ea.getElementPosition(this._scrollArea).y+ea.getElementDimensions(this._scrollArea).y;return pa<qa;}return false;},_initNotifNegativeFeedback:function(){u.init(this);this.alertList.setFilterFn(u.filterStoreClicked);aa.listen('hide',fa(this.wrapperID),function(){for(var pa in this.negativeNotifs)if(pa)this.negativeNotifs[pa] instanceof r&&this.negativeNotifs[pa].reset();}.bind(this));h.subscribe('notif/negativeCancel',function(pa,qa){this.negativeNotifs[qa.id]&&this.negativeNotifs[qa.id].restore();}.bind(this));h.subscribe('notif/negativeConfirmed',function(pa,qa){this.negativeNotifs[qa.id]&&this.negativeNotifs[qa.id].onTurnedOff();this.alertList.toggleNotifsSimilarTo(qa.id,true,true);this._hideOverflow();this._handleScroll();}.bind(this));h.subscribe('notif/negativeUndid',function(pa,qa){this.negativeNotifs[qa.id]&&this.negativeNotifs[qa.id].onUndid();this.alertList.toggleNotifsSimilarTo(qa.id,false,true);this._hideOverflow();}.bind(this));h.subscribe('notif/negativeMarkedSpam',function(pa,qa){this.negativeNotifs[qa.id]&&this.negativeNotifs[qa.id].onMarkedSpam();}.bind(this));h.subscribe('notif/negativeFirstReceiptYes',function(pa,qa){this.negativeNotifs[qa.id]&&this.negativeNotifs[qa.id].onFirstReceiptYes();this.alertList.toggleNotifsSimilarTo(qa.id,false,true);}.bind(this));h.subscribe('notif/negativeFirstReceiptNo',function(pa,qa){this.negativeNotifs[qa.id]&&this.negativeNotifs[qa.id].onFirstReceiptNo();this.alertList.toggleNotifsSimilarTo(qa.id,false,true);}.bind(this));this.alertList.subscribe(t.INSERTION_TYPE,function(pa,qa){this._updateFirstReceipt(qa);var ra=n.scry(qa.obj,'.notif_x');if(ra.length==1)this.negativeNotifs[qa.id]=new r(this,qa);}.bind(this));},_sendIDs:function(pa,qa,ra){var sa=ra||{};for(var ta=0;ta<pa.length;++ta)sa['alert_ids['+ta+']']=pa[ta];new j(ba(qa).getQualifiedURI().toString(),sa).send();},_waitForFetch:function(pa){return this.currentFetchRequest&&this.fetchListeners.push(pa.bind(this));},_logImpression:function(){var pa=this.alertList.getIds();if(pa.length===0&&this._waitForFetch(this._logImpression))return;this.logImpressionIds(pa,this.NOTIF_JEWEL_REF);},logImpressionIds:function(pa,qa){this.shouldLogImpressions&&this._sendIDs(pa,'/ajax/notifications/impression.php',{ref:qa});},markRead:function(pa,qa){var ra=!ja(qa);qa=ra?this.alertList.getUnseenIds():qa.filter(this.alertList.isUnreadId.bind(this.alertList));if(qa.length){pa&&this._sendIDs(qa,'/ajax/notifications/mark_read.php',{seen:ra?1:0});if(ia('jewelNoticeMessage')&&this.logAutoShutOffImpression){new j('/ajax/notifications/auto_shutoff_seen.php').send();this.logAutoShutOffImpression=false;}var sa=pa;ra?this.alertList.markSeen(qa):this.alertList.markRead(qa,sa);}ra&&this._waitForFetch(this.markRead.bind(this,pa));},markAllRead:function(){var pa=this.alertList.getUnreadIds();this.markRead(true,pa);},_updateErrorHandler:function(pa){},_updateURI:'/ajax/presence/update.php',_update:function(pa){pa.setHandler(this._handleUpdate.bind(this)).setOption('suppressErrorAlerts',true).setErrorHandler(this._updateErrorHandler.bind(this)).setData({notif_latest:this.latest_notif_time,notif_latest_read:this.latest_read_notif_time}).setURI(this._updateURI).setAllowCrossPageTransition(true);},_handleUpdate:function(pa){var qa=pa.payload.notifications;if(!qa.no_change){this.updateTime=pa.payload.time;this.latest_notif_time=qa.latest_notif;this.latest_read_notif_time=qa.latest_read_notif;this._updateDisplay();this.alertList.insertMany(qa.notifications);}},_updateDisplay:function(){if(!this.content)return;this._updateCount();},_updateCount:function(){h.inform('jewel/count-updated',{jewel:'notifications',count:this.alertList.unseenCount},h.BEHAVIOR_STATE);this._hideOverflow();},fetch:function(pa){this._sendFetchRequest(pa);},_getFetchQueryData:function(){var pa={time:this.latest_notif_time,user:this.user,version:this.cache_version,locale:o.locale};if(this.useInfiniteScroll)pa.earliest_time=this.alertList.getEarliestNotifTime();return pa;},_sendFetchRequest:function(pa){if(this.useInfiniteScroll){this._infiniteScrollNotif=null;this._newDataFromInsert=false;this._truncate=true;}var qa=ba('/ajax/notifications/get.php'),ra=pa||this.loadingIndicator;if(this.currentFetchRequest)return true;this.ua.add_event('fetch');qa.setQueryData(this._getFetchQueryData());this.currentFetchRequest=new i().setURI(qa).setStatusElement(ra).setMethod('GET').setReadOnly(true).setTimeoutHandler(30000,this.fetchErrorHandler.bind(this)).setHandler(this.fetchHandler.bind(this)).setErrorHandler(this.fetchErrorHandler.bind(this)).setAllowCrossPageTransition(true);!this.currentFetchRequest.send()&&this.fetchErrorHandler();return true;},fetchErrorHandler:function(pa){this.currentFetchRequest=null;this.ua.add_event('fetch_error');this.loadingIndicator&&m.hide(this.loadingIndicator);this.useInfiniteScroll&&this._updateScrollDataStructures();},fetchHandler:function(pa){this.ua.add_event('fetch_success');var qa=pa.getPayload();this.alertList.insertMany(qa.notifications,true);this.loadingIndicator&&m.hide(this.loadingIndicator);this.loadingIndicator=null;this.currentFetchRequest=null;this.fetch=ha;if(this.fetchListeners){for(var ra=0;ra<this.fetchListeners.length;ra++)this.fetchListeners[ra]();this.fetchListeners=[];}a.ArbiterMonitor&&h.inform('notifs/fetched','',h.BEHAVIOR_STATE);var sa=qa.generated,ta=Math.round(Date.now()/1000);if(ta-sa>15)sa=ta;k.loadModules(['LiveTimer'],function(ua){ua.restart(sa);ua.startLoop(0);});if(this.useInfiniteScroll){if(ka(qa.notifications)||!this._newDataFromInsert){this._noMoreNotifications();}else m.show(this._morePager);this._updateScrollDataStructures();if(this.isNotifJewelOpen()&&this.afterFirstFetch)this.animate=true;this.afterFirstFetch=true;}this._hideOverflow();},_noMoreNotifications:function(){m.hide(this._morePager);this.useInfiniteScroll=false;},_mergeNotification:function(pa,qa,ra,sa){var ta=!this.alertList.isUnreadId(pa);this.alertList.insert(pa,qa,ra,true,null,sa||null);this.latest_notif_time=0;if(ta)this._updateCount();var ua=this.alertList.getDomObj(pa);if(ua)k.loadModules(['LiveTimer'],function(va){va.addTimeStamps(ua);});},_handleNotificationMsg:function(pa,qa){if(this.isNotifJewelOpen()){var ra={type:pa,data:qa};this.queuedNotifications.push(ra);}else this._displayNotification(pa,qa);},_displayNotification:function(pa,qa){var ra=qa.obj;if(typeof this.useDesktopNotifications=='undefined')this.useDesktopNotifications=this.allowDesktopNotifications&&window.webkitNotifications&&window.webkitNotifications.checkPermission()===0;if(this.useDesktopNotifications)k.loadModules(['DesktopNotifications'],function(sa){sa.addNotification(ra.alert_id);});if(ra.markup){this._mergeNotification(ra.alert_id,ra.time,ra.markup,ra.alt_id||null);}else this._poller.request();},_handleNotificationsReadMsg:function(pa,qa){var ra=qa.obj;this.markRead(false,ra.alert_ids);},_handleNotificationsSeenMsg:function(pa,qa){if(!this.unseenVsUnread){this._handleNotificationsReadMsg(pa,qa);return;}var ra=qa.obj;this.alertList.markSeen(ra.alert_ids);},_hideOverflow:function(){if(!this.isNotifJewelOpen())return;var pa=n.scry(fa('fbNotificationsList'),'.notification');this.scrollableAreaNode=this.scrollableAreaNode||n.scry(this.jewelFlyout,'.uiScrollableArea')[0];var qa=20,ra=m.hasClass(document.documentElement,'tinyViewport')&&!m.hasClass(document.body,'fixedBody');if(!pa.length||ra){y.set(this.scrollableAreaNode,'height','100%');this.notifLogger.rate(this.SCROLL_OFF_TINY,ra);return;}var sa=this.scrollableAreaNode||pa[0],ta=ea.getViewportDimensions().y-ea.getElementPosition(sa,'viewport').y-ea.getElementDimensions(this.footer).y-5,ua=ta,va=0;for(;va<pa.length&&ua>0;++va)if(m.shown(pa[va]))ua-=ea.getElementDimensions(pa[va]).y;var wa=530,xa=Math.min(wa,ta-Math.max(ua,0));if(ua>=0&&xa<wa){if(!this.useInfiniteScroll){xa='100%';}else{if(this._truncate&&pa.length>=5)xa-=qa;xa+='px';}}else xa+='px';if(this.useInfiniteScroll&&this.animate&&xa!='100%'){this.animation&&this.animation.stop();this.animation=new g(this.scrollableAreaNode).to('height',xa).duration(200).go();}else{var ya=x.getInstance(this.scrollableAreaNode);ya&&ya.showScrollbar.bind(ya).defer();y.set(this.scrollableAreaNode,'height',xa);}},_updateFirstReceipt:function(pa){var qa=pa.obj.getAttribute('data-appid'),ra=n.scry(pa.obj,'.first_receipt_div');if(qa&&ra.length==1){if(this.firstReceiptMap[qa]){if(pa.id!=this.firstReceiptMap[qa].id&&this.firstReceiptMap[qa].time>pa.time)return;m.removeClass(this.firstReceiptMap[qa].obj,'first_receipt');}this.firstReceiptMap[qa]=pa;m.addClass(pa.obj,'first_receipt');}},isNotifJewelOpen:function(){var pa=aa.getInstance(this.wrapper).getActive();return (pa===this.wrapper&&m.hasClass(pa,'openToggler'));}});e.exports=oa;});
__d("legacy:original-notifications-jewel",["Notifications"],function(a,b,c,d){a.Notifications=b('Notifications');},3);
__d("legacy:onvisible",["OnVisible"],function(a,b,c,d){a.OnVisible=b('OnVisible');},3);
__d("PagesVoiceBar",["$","Arbiter","AsyncRequest","CSS","ChannelConstants","DOM","PageTransitions"],function(a,b,c,d,e,f){var g=b('$'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('CSS'),k=b('ChannelConstants'),l=b('DOM'),m=b('PageTransitions'),n='PagesVoiceBar/toggle',o='PagesVoiceBar/initialized',p='PagesVoiceBar/switchVoice',q='page_transition',r='pages_voice_bar_sync',s=null,t=null,u=false,v=false;function w(){v=!v;j.conditionClass(document.body,'hasVoiceBar',v);}function x(da,ea){new i('/ajax/pages/switch_voice.php').setData(ea).setHandler(function(fa){ba();}).send();}function y(){s=null;}function z(da,ea){if(ea.obj.profile_id&&ea.obj.profile_id==s)ba();}function aa(da){h.subscribe(o,da);}function ba(){m.getNextURI().go();}var ca={initVoiceBar:function(){if(u)return;t=g('pagesVoiceBarContent');v=j.hasClass(document.body,'hasVoiceBar');h.subscribe(n,w);h.subscribe(p,x);h.subscribe(q,y);h.subscribe(k.getArbiterType(r),z);u=true;h.inform(o,null,h.BEHAVIOR_STATE);},update:function(da,ea){aa(function(){s=ea;l.setContent(t,da);});}};e.exports=ca;});
__d("PrivacyLiteFlyout",["Event","function-extensions","Animation","Arbiter","ArbiterMixin","AsyncRequest","CSS","DOM","Ease","Parent","SelectorDeprecated","Style","Toggler","copyProperties","cx","csx","ge"],function(a,b,c,d,e,f){var g=b('Event');b('function-extensions');var h=b('Animation'),i=b('Arbiter'),j=b('ArbiterMixin'),k=b('AsyncRequest'),l=b('CSS'),m=b('DOM'),n=b('Ease'),o=b('Parent'),p=b('SelectorDeprecated'),q=b('Style'),r=b('Toggler'),s=b('copyProperties'),t=b('cx'),u=b('csx'),v=b('ge'),w='PrivacyLiteFlyout/expandingSection',x={},y={};function z(ha,ia,ja){var ka=ia?0:ha.offsetHeight;q.set(ha,'height',ka+'px');q.set(ha,'overflow','hidden');l.show(ha);var la=ia?ha.scrollHeight:0,ma=m.getID(ha);x[ma]&&x[ma].stop();x[ma]=new h(ha).to('height',la).ondone(function(){x[ma]=null;q.set(ha,'height','');q.set(ha,'overflow','');la||l.hide(ha);ja();}).duration(Math.abs(la-ka)*1.5).ease(n.sineOut).go();}function aa(ha){return new k().setURI(ha).send();}function ba(){return aa('/ajax/privacy/privacy_lite/increment_masher_tip_count');}function ca(){return aa('/ajax/privacy/privacy_lite/dismiss_masher_tip');}var da=null,ea=false,fa=false,ga=s({loadBody:function(ha){if(!ea&&v('fbPrivacyLiteFlyoutLoading')){ea=true;if(!ha)ha=false;new k('/ajax/privacy/privacy_lite/loader').setData({from_megaphone:ha}).send();}},renderBody:function(ha){var ia=v('fbPrivacyLiteFlyoutLoading');if(ia){m.replace(ia,ha);ga.inform('load',null,i.BEHAVIOR_STATE);}},hideCleanup:function(ha){i.inform(w);var ia=m.scry(ha,"._2va0").forEach(function(ja){l.removeClass(ja,"_2va0");});},registerFlyoutToggler:function(ha,ia){da=ia;var ja=r.createInstance(ha);ja.setSticky(false);r.listen(['show','hide'],ia,function(ka){ga.inform(ka);fa=ka==='show';if(!fa){ga.hideCleanup(ha);ja.hide();i.inform('layer_hidden',{type:'PrivacyShortcutsFlyout'});}else i.inform('layer_shown',{type:'PrivacyShortcutsFlyout'});});},registerFinalReminderFlyout:function(ha){if(fa)return;var ia=m.find(ha.getRoot(),"._57bk"),ja=ha.getContext();ha.setOffsetY(o.byClass(ja,'hasSmurfbar')&&o.byClass(ja,"._6nw")?15:-5);ga.subscribe('show',function(){ha.hide();});var ka=g.listen(ia,'click',function(){ha.hide();aa('/ajax/privacy/privacy_lite/dismiss_rollout_reminder');ka.remove();});aa('/ajax/privacy/privacy_lite/increment_rollout_reminder');ha.show();},isFlyoutVisible:function(){return da&&r.getActive()===da;},exists:function(){return !!m.scry(document.body,"._91j")[0];},setFlyoutVisible:function(ha){ha?r.show(da):r.hide(da);},showSection:function(ha){var ia=y[ha],ja=ia.chevron,ka=ia.sublist_container;i.inform(w,ja);if(ga.inform('expand',ha)!==false){l.removeClass(ja,"_9or");l.addClass(ja,"_9os");z(ka,true,function(){ga.inform('expanded',ha);});}},hideSection:function(ha,ia,ja){var ka=y[ha],la=ka.chevron,ma=ka.sublist_container;if(ja===la)return;if(ga.inform('collapse',ha)!==false){l.addClass(la,"_9or");l.removeClass(la,"_9os");z(ma,false,function(){ga.inform('collapsed',ha);});}},toggleSection:function(ha){var ia=y[ha].chevron;r.getInstance(ia).hide();if(l.hasClass(ia,"_9or")){ga.showSection(ha);new k('/ajax/privacy/privacy_lite/log_section_expand').setData({section:ha}).send();}else ga.hideSection(ha);},registerSection:function(ha,ia){y[ha]=ia;i.subscribe(w,ga.hideSection.curry(ha));g.listen(ia.section_block,'click',ga.toggleSection.curry(ha));},registerInlineHelpOnAudienceChange:function(ha,ia,ja){p.subscribe('select',function(ka,la){if(la.selector!=ha)return;l.addClass(ia,"_2va0");if(ja)new k('/ajax/privacy/privacy_lite/kill_intro').send();});},registerInlineHelpXOutOnClick:function(ha,ia){g.listen(ha,'click',l.addClass.curry(ia,"_9p0"));},registerBlockUnhideOnFocus:function(ha,ia){g.listen(ha,'focus',l.show.curry(ia));},registerMessageFilterSettingOnClick:function(ha,ia){var ja=m.find(ha,"._fv0");g.listen(ha,'click',function(){if(ja.checked)new k('/ajax/mercury/change_filtering_type.php').setData({filtering_type:ia,source:'privacy_lite'}).send();});},registerGraphSearchPrivacyReminder:function(ha,ia){g.listen(ia,'click',function(){m.remove(ha);aa('/ajax/privacy/privacy_lite/dismiss_gs_privacy_reminder');});},registerMasher:function(ha,ia){var ja=false;i.subscribe(w,function(ka,la){var ma=m.scry(o.byTag(la,'li'),"._571t").length;if(ja||!ma)return;ja=Boolean(ba());});g.listen(ia,'click',function(){m.remove(ha);ca();});}},j);e.exports=ga;});
__d("PrivacyLiteFlyoutHelp",["Event","Arbiter","AsyncRequest","ContextualHelpSearchController","CSS","DOM","Parent","copyProperties","csx","cx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('ContextualHelpSearchController'),k=b('CSS'),l=b('DOM'),m=b('Parent'),n=b('copyProperties'),o=b('csx'),p=b('cx'),q,r;function s(t,u,v,w,x){this._width=315;r=l.find(u,'input');var y=l.create('div');this.init(t,r,y,v,w);q=m.byClass(u,"_8-a");g.listen(x,'click',this._hideSearch.bind(this));h.subscribe('PrivacyLiteFlyout/expandingSection',this._hideSearch.bind(this));var z=l.scry(q,"._d1r")[0];z&&g.listen(z,'click',function(){k.addClass(q,"_aw6");r.focus();if(!this.suggestedResults)new i('/ajax/privacy/privacy_lite/help_suggestions').setHandler(function(aa){var ba=aa.getPayload().searchSuggestions,ca=l.find(q,"._4_8m");l.setContent(ca,ba);k.addClass(q,"_4_8l");}.bind(this)).send();}.bind(this));}n(s.prototype,new j(),{source:'privacy_shortcuts',_hideSearch:function(){this.clearResults();k.removeClass(q,"_aw6");},show:function(t){if(t===this.topics_area){k.removeClass(q,"_aw7");return;}else if(t===this.loader){k.addClass(q,"_aw7");k.hide(this.results_area);}else k.hide(this.loader);k.show(t);}});e.exports=s;});
__d("LayerSlowlyFadeOnShow",["Class","LayerFadeOnShow","emptyFunction"],function(a,b,c,d,e,f){var g=b('Class'),h=b('LayerFadeOnShow'),i=b('emptyFunction');function j(k){this.parent.construct(this,k);}g.extend(j,h);j.prototype._getDuration=i.thatReturns(500);e.exports=j;});
__d("PrivacyLiteNUXController",["AsyncRequest","CSS","Event","LayerSlowlyFadeOnShow","Locale","ModalMask","PageTransitions","Parent","PrivacyLiteFlyout","Toggler","$","copyProperties","cx"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('CSS'),i=b('Event'),j=b('LayerSlowlyFadeOnShow'),k=b('Locale'),l=b('ModalMask'),m=b('PageTransitions'),n=b('Parent'),o=b('PrivacyLiteFlyout'),p=b('Toggler'),q=b('$'),r=b('copyProperties'),s=b('cx'),t="_3oye",u="_1luv",v=[],w={bootload:function(){},init:function(y){if(!w.initialized)r(this,{dialog:y.dialog,sectionID:y.sectionID,subsectionID:y.subsectionID,initialized:true,tourStarted:false});if(y.showOnExpand){w._attachFlyoutListener();}else w._detachFlyoutListener();},startTourFromAnywhere:function(){w._startTour(false);},startTourFromMegaphone:function(){w._startTour(true);},_startTour:function(y){if(w.tourStarted)return;w.tourStarted=true;w._detachFlyoutListener();new g('/ajax/privacy/privacy_lite/log_nux_imp').setData({from_megaphone:y}).send();l.show();h.conditionClass(w.dialog.getRoot(),t,y);if(!y)w._maskListener=i.listen(q('modalMaskOverlay'),'click',w._cleanup);p.setSticky(true);setTimeout(w._showFlyout);m.registerHandler(function(){w._cleanup();o.setFlyoutVisible(false);},10);},_showFlyout:function(){o.loadBody(true);o.setFlyoutVisible(true);w._initDialog();x('load',w._showTour);},_showTour:function(){o.showSection(w.sectionID);x('expanded',function(y,z){if(z===w.sectionID)w.dialog.setContext(q(w.subsectionID)).setOffsetY(20).show();});x(['collapse','hide'],w._cleanup);},_initDialog:function(){var y=w.dialog.getRoot(),z=w.dialog.getContent();h.addClass(y,"_1luy");h.conditionClass(y,"_3qz8",k.isRTL());h.addClass(z,"_1luz");w.dialog.enableBehavior(j);i.listen(y,'click',function(event){if(n.byClass(event.getTarget(),u))w._cleanup();});},_attachFlyoutListener:function(){if(!w.flyoutSubscription)if(o.isFlyoutVisible()){w.startTourFromAnywhere();}else w.flyoutSubscription=o.subscribe('show',w.startTourFromAnywhere);},_detachFlyoutListener:function(){if(w.flyoutSubscription){w.flyoutSubscription.unsubscribe();w.flyoutSubscription=null;}},_cleanup:function(){if(!w.tourStarted)return;w.tourStarted=false;p.setSticky(false);l.hide();w.dialog.hide();while(v.length)v.pop().unsubscribe();if(w._maskListener){w._maskListener.remove();w._maskListener=null;}}};function x(y,z){v.push(o.subscribe(y,z));}e.exports=w;});
__d("ViewasChromeBar",["Event","Arbiter","AsyncRequest","CSS","DOM","Focus","ModalMask","PageTransitions","Parent","cx","csx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('CSS'),k=b('DOM'),l=b('Focus'),m=b('ModalMask'),n=b('PageTransitions'),o=b('Parent'),p=b('cx'),q=b('csx'),r='ViewasChromeBar/initialized',s=null,t=false;function u(x){h.subscribe(r,x);}function v(x){j.addClass(x,"_7g7");var y=k.find(x,"._7g0");l.set(k.find(y,'.textInput'));}var w={initChromeBar:function(x){if(t)return;s=x;t=true;h.inform(r,null,h.BEHAVIOR_STATE);},update:function(x,y){u(function(){k.setContent(s,x);if(y)new i('/ajax/privacy/glasgow/viewas_bar_flyout_open').send();});},registerSpecificModeOnClick:function(x){g.listen(x,'click',v.curry(o.byClass(x,"_7f-")));},registerFlyoutModalMask:function(){m.show();n.registerHandler(m.hide,10);}};e.exports=w;});
__d("BingScalingCommon",["startsWith","URI"],function(a,b,c,d,e,f){var g=b('startsWith'),h=b('URI'),i={integrateWebsuggestions:function(j,k,l,m,n){var o=j.filter(function(y){return y.type&&y.type!=='websuggestion'&&!g(y.type,'browse_type');}).map(function(y){return y.uid;}),p={typeaheadResults:JSON.stringify(o)},q=[],r=k?q:[],s=[],t=0,u=0,v=l;m=Math.floor(l*m);for(var w=0;w<j.length;w++){var x=j[w];if(x.type==='websuggestion'&&!x.isSeeMore){if((v>0&&t<m)||(t>0&&t<n)){r.push(x);t++;v--;x.path=h(x.path).addQueryData(p).toString();}else if(v>0)s.push(x);}else{if(v<=0&&!k)continue;q.push(x);u++;v--;}}if(v>0&&s.length>0)r=r.concat(s.slice(0,v));if(!k)return q.concat(r);return r;}};e.exports=i;});
__d("TypeaheadSearchSponsoredUtils",[],function(a,b,c,d,e,f){function g(o){return o.selected_target_id!=o.s_target;}function h(o,p){return Math.min(p.maxNumberAds,p.maxNumberRemovedResults+p.maxNumberResultsAndAds-o);}function i(o,p){var q={};for(var r=o.length-1;r>=0;--r){var s=o[r];q[s]=s;if(p.hasOwnProperty(s))p[s].forEach(function(t){q[t]=s;});}return q;}function j(o,p,q){for(var r=p;r<o.length;r++)o[r].setDebugString&&o[r].setDebugString(q);}function k(o,p){return p.indexOf(String(o))!=-1;}function l(o,p,q,r){if(n.isSelfPromoted(o))return false;if(q+p.length<r.maxNumberResultsAndAds)return false;return true;}function m(o,p,q,r){var s=o[o.length-1];if(p.hasOwnProperty(s))return false;if(s==q)return false;if(s==r)return false;return true;}var n={isSelfPromoted:function(o){return o.uid==o.s_target;},prepareAndSortAds:function(o,p,q){if(!p)return [];var r=[],s=o.length,t={};for(var u=0;u<s;u++){var v=o[u];t[v.uid]=true;if(v.s_categories)v.s_categories.forEach(function(z){t[z]=true;});}for(var w in t)if(p[w])for(var x in p[w]){var y=p[w][x];if(q&&q.hasOwnProperty(y.uid))continue;r.push(y);}r.sort(function(z,aa){return aa.s_value-z.s_value;});return r;},selectAds:function(o,p,q,r,s){var t=[],u={},v={},w={},x=0,y=h(o.length,r),z=i(o,p);for(var aa=0;aa<q.length;aa++){if(t.length>=y){j(q,aa,'filtered: '+y+' ads already selected');break;}var ba=q[aa],ca=z[ba.s_target]||ba.s_target;ba.selected_target_id=ca;if(!k(ca,o)){ba.setDebugString&&ba.setDebugString('filtered: targeted organic '+ca+' does not exist. '+'promoted id '+ba.uid);continue;}if(l(ba,o,x,r)&&!m(o,v,ca,s)){ba.setDebugString&&ba.setDebugString('filtered: last organic need but cannot be removed');continue;}if(!n.isSelfPromoted(ba)&&o.indexOf(String(ba.uid))!=-1){ba.setDebugString&&ba.setDebugString('filtered: organic '+ba.uid+' targets another organic '+ca);continue;}if(u.hasOwnProperty(ba.s_account)){ba.setDebugString&&ba.setDebugString('filtered: ad account '+ba.s_account+' already selected');continue;}if(w.hasOwnProperty(ba.uid)){ba.setDebugString&&ba.setDebugString('filtered: ad promoted id '+ba.uid+' already selected');continue;}ba.setDebugString&&ba.setDebugString('selected');t.push(ba);u[ba.s_account]=true;v[ca]=true;w[ba.uid]=true;if(!n.isSelfPromoted(ba)){++x;if(x+o.length>r.maxNumberResultsAndAds)o.pop();}}return t;},hasTopResult:function(o,p,q){if(o==null)return false;if(o.type=='user')return false;if(o.type=='grammar')return false;if(o.score>q.v0)return true;if(o.s_value>q.v3)return true;if(o.s_value>p.s_value)return true;var r=g(p)?q.v4:(o.bootstrapped?q.v1:q.v2);if(r<p.s_value)return false;return true;},setOrganicECPM:function(o,p){if(o==null)return;for(var q=0;q<p.length;q++)if(o.hasOwnProperty(p[q].uid))p[q].s_value=o[p[q].uid];return;},buildResultIndices:function(o){var p={},q=o.length;for(var r=0;r<q;r++)p[o[r].uid]=r;return p;},getTopAdPosition:function(o,p,q){if(o.length<1)return null;if(p.length<1)return null;if((o[0].type=='user')||(o[0].type=='grammar')){for(var r=1;r<o.length;++r)if(o[r].type!=o[0].type)return r;return o.length;}if(n.hasTopResult(o[0],p[0],q))return 1;return 0;}};e.exports=n;});
__d("TypeaheadSearchSponsored",["Event","Arbiter","CSS","DOM","URI","copyProperties","TypeaheadSearchSponsoredUtils","tx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('CSS'),j=b('DOM'),k=b('URI'),l=b('copyProperties'),m=b('TypeaheadSearchSponsoredUtils'),n=b('tx');function o(p){this._typeahead=p;}o.auctionOptions={};o.query=null;o.getOriginalOrganics=function(p){return p.map(function(q){return {uid:q.uid,text:q.text,type:o.getRealType(q),source:q.bootstrapped?1:0,index:q.index,s_value:q.s_value||0,s_categories:q.s_categories||[],score:q.score};});};o.setTopResult=function(p){p[0].renderTypeOverride=true;p[0].orig_render_type=p[0].render_type;p[0].render_type='tophit';};o.finalizeAd=function(p,q,r){var s="Sponsored";p.rankType=p.rankType||p.render_type||p.type;if(m.isSelfPromoted(p)){q.s_token=p.s_token;q.message=p.s_message;if(r.rerankingStrategy===0)q.subtextOverride=q.subtext?q.subtext+' \xB7 '+s:s;if(p.path){q.pathOverride=true;q.orig_path=q.path;q.path=p.path;}q.is_self=true;}else{p.message=p.s_message;p.subtextOverride=null;if(r.rerankingStrategy===0)p.subtextOverride=p.subtext?p.subtext+' \xB7 '+s:s;if(r.debug){if(!p.subtextOverride&&p.subtext)p.subtextOverride=p.subtext;if(p.subtextOverride){p.subtextOverride+=' \xB7 (Debug: '+q.text+')';}else p.subtextOverride='(Debug: '+q.text+')';}p.type=q.type;p.render_type=q.render_type;p.is_self=false;}};o.promoteSelfPromotedResultToTop=function(p,q,r,s){var t=p[q];if(q<r){var u="Sponsored";t.subtextOverride=t.subtext?t.subtext+' \xB7 '+u:u;return;}if(q>r)p.splice(r,0,p.splice(q,1)[0]);t=p[r];t.renderTypeOverride=true;t.orig_render_type=t.render_type;t.render_type='ownsection';};o.insertAdToTop=function(p,q,r,s){p.splice(r,0,q);q.render_type='ownsection';};o.rerankMethod5=function(p,q,r){if(r.rerankingStrategy!=5)return;var s=m.getTopAdPosition(p,q,r),t=m.buildResultIndices(p);for(var u=q.length-1;u>=0;u--){var v=q[u],w=t[v.selected_target_id],x=p[w];o.finalizeAd(v,x,r);if(m.isSelfPromoted(v)){o.promoteSelfPromotedResultToTop(p,w,s,r);}else o.insertAdToTop(p,v,s,r);t=m.buildResultIndices(p);}};o.rerankAds=function(p,q,r){switch(r.rerankingStrategy){case 5:o.rerankMethod5(p,q,r);break;default:break;}p.length=Math.min(p.length,r.maxNumberResultsAndAds);return p;};o.initResults=function(p){var q=p.length;for(var r=0;r<q;r++){var s=p[r];s.is_self=null;s.s_token=null;s.message=null;s.subtextOverride=null;if(s.pathOverride){s.path=s.orig_path;s.pathOverride=false;}if(s.renderTypeOverride){s.render_type=s.orig_render_type;s.renderTypeOverride=false;}s.rankType=s.rankType||s.render_type||s.type;}return p;};o.setAuctionOptions=function(p){l(o.auctionOptions,p);};o.getRealType=function(p){if(p.renderTypeOverride)return p.orig_render_type||p.type;return p.render_type||p.type;};o.hideAdResult=function(p,q){h.inform('TypeaheadSearchSponsored/hideAdResult',{uid:p,reason_dialog:q});};o.undoHideAdResult=function(p){h.inform('TypeaheadSearchSponsored/undoHideAdResult',{uid:p});};o.Ad=function(){};l(o.prototype,{_dataSubscriptions:null,_viewSubscriptions:null,_globalSubscriptions:null,_data:null,_view:null,_sponsoredEntries:null,_hiddenSponsoredEntities:null,_hideReasonDialog:null,_sBootstrapID:null,_organicECPM:null,enable:function(){this._data=this._typeahead.getData();this._dataSubscriptions=[this._data.subscribe('beginFetchHandler',function(p,q){var r=q.response.getPayload();if(r.s_entries){this._sponsoredEntries=this._sponsoredEntries||{};var s=r.s_entries.length;for(var t=0;t<s;t++){var u=new o.Ad();l(u,r.s_entries[t]);var v=u.s_target;if(!this._sponsoredEntries[v])this._sponsoredEntries[v]={};this._sponsoredEntries[v][u.uid]=u;}if(r.s_bootstrap_id)this._sBootstrapID=r.s_bootstrap_id;if(r.organic_s_value)this._organicECPM=l(this._organicECPM,r.organic_s_value);}}.bind(this))];if(o.auctionOptions.bootstrap)this._dataSubscriptions.push(this._data.subscribe('onload',function(p,q){var r=l(this.bootstrapData,{no_cache:1,options:['sponsored']});this.fetch(this.bootstrapEndpoint,r,{type:'sponsored'});}.bind(this._data)));this._view=this._typeahead.getView();this._viewSubscriptions=[this._view.subscribe('finalResultsReordering',function(p,q){o.query=q.value;m.setOrganicECPM(this._organicECPM,q.results);var r=o.getOriginalOrganics(q.results);o.setAuctionOptions({maxNumberResultsAndAds:Math.max(q.results.length,(this._data&&this._data._maxResults)||o.auctionOptions.maxNumberResultsAndAds)});var s=this.runAuction(q.results,this._sponsoredEntries,this._hiddenSponsoredEntities,o.auctionOptions),t=m.prepareAndSortAds(q.results,this._sponsoredEntries,this._hiddenSponsoredEntities),u=t.map(function(y){return y.s_token;}),v=[];for(var w=0;w<s.length;w++){var x=s[w];if(x.s_token)v.push({position:w,is_self:x.is_self});}this._view.inform('recordAfterReorder',{organic:r,tokens:u,position_data:v,s_bootstrap_id:this._sBootstrapID,options:o.auctionOptions,variant:o.auctionOptions.rerankingStrategy});q.results=s;this._data.inform('recordAuctionState',{organic:r,auctionOptions:o.auctionOptions,event_data:q});}.bind(this)),this._view.subscribe('highlight',function(p,q){if(this._view.content)j.scry(this._view.content,'a.report').forEach(i.hide);if(!q.element||!q.selected||!q.selected.s_token)return;var r=j.scry(q.element,'a.report');if(r.length){i.show(r[0]);}else j.appendContent(q.element,this._createHideAdLink(q.selected));}.bind(this))];this._globalSubscriptions=[h.subscribe('TypeaheadSearchSponsored/hideAdResult',function(p,q){this._hiddenSponsoredEntities=this._hiddenSponsoredEntities||{};this._hiddenSponsoredEntities[q.uid]=true;this._hideReasonDialog=q.reason_dialog;this._forceRefreshResults();}.bind(this)),h.subscribe('TypeaheadSearchSponsored/undoHideAdResult',function(p,q){if(this._hiddenSponsoredEntities)delete this._hiddenSponsoredEntities[q.uid];if(this._hideReasonDialog){this._hideReasonDialog.hide();this._hideReasonDialog=null;}this._forceRefreshResults();}.bind(this))];},disable:function(){this._dataSubscriptions.forEach(this._data.unsubscribe.bind(this._data));this._dataSubscriptions=null;this._viewSubscriptions.forEach(this._view.unsubscribe.bind(this._view));this._viewSubscriptions=null;this._globalSubscriptions.forEach(h.unsubscribe.bind(h));this._globalSubscriptions=null;this._data=null;this._view=null;this._sponsoredEntries=null;},runAuction:function(p,q,r,s){if(p.length===0)return p;p=o.initResults(p);if(!q)return p;var t=m.prepareAndSortAds(p,q,r);if(this._typeahead){var u=this._typeahead.getData();u.inform('recordAuctionState',{sorted_ads:t});}var v={},w=p.map(function(ba){if(ba.s_categories)v[ba.uid]=ba.s_categories;return String(ba.uid);}),x=m.selectAds(w,v,t,s);if(x.length===0)return p;if(m.hasTopResult(p[0],x[0],s))o.setTopResult(p);var y=0;for(var z=0;z<x.length;++z)if(!m.isSelfPromoted(x[z]))y++;p.length=Math.min(p.length,s.maxNumberResultsAndAds-y);var aa=o.rerankAds(p,x,s);return aa;},_forceRefreshResults:function(){if(this._data&&this._data.value)this._data.respond(this._data.value,this._data.buildUids(this._data.value));},_createHideAdLink:function(p){var q=new k('/ajax/emu/end.php').addQueryData({eid:p.s_token,f:0,ui:'typeahead_'+p.s_token.replace('.','_'),en:'fad_hide',ed:'true',a:1}).toString(),r={className:'report',rel:'dialog-post',href:'#',ajaxify:q,title:"Hide the ad"},s=j.create('a',r);g.listen(s,'mouseover',function(event){this._view.index=-1;this._view.highlight(-1,false);event.kill();}.bind(this));return s;}});e.exports=o;});
__d("legacy:SearchSponsoredTypeaheadBehavior",["TypeaheadSearchSponsored"],function(a,b,c,d){var e=b('TypeaheadSearchSponsored');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.searchSponsored=function(f){f.enableBehavior(e);};},3);
__d("legacy:TypeaheadSearchSponsored",["TypeaheadSearchSponsored"],function(a,b,c,d){a.TypeaheadSearchSponsored=b('TypeaheadSearchSponsored');},3);
__d("SearchDataSource",["Event","Arbiter","AsyncResponse","Class","DataSource","copyProperties","createArrayFrom","BingScalingCommon"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('AsyncResponse'),j=b('Class'),k=b('DataSource'),l=b('copyProperties'),m=b('createArrayFrom'),n=b('BingScalingCommon');function o(p){this._token=p.token||'';this._lazyonload=p.lazyonload===false?false:true;this._extraTypes=p.extraTypes;this._buckets=p.buckets;this._noMultiFetch=p.noMultiFetch||false;this._maxWebSuggToCountFetchMore=p.maxWebSuggToCountFetchMore||0;var q=p.maxResults||8;this.parent.construct(this,p);this._numResults={min:3,max:q};this.recordingRoute=p.recordingRoute||'non_banzai';this._minWebSugg=p.minWebSugg||2;this._queryToWebSuggState={};this._genTime=p.genTime;}j.extend(o,k);l(o.prototype,{init:function(){this.parent.init();this._leanPayload=null;this._bootstrapRequestsPending=0;this._criticalOnly=true;this._updateMaxResults();g.listen(window,'resize',this._updateMaxResults.bind(this));},dirty:function(){this.parent.dirty();this._fetchOnUseRequests=[];},asyncErrorHandler:function(p){if(window.Dialog&&window.Dialog.getCurrent()==null&&p.getError()==1400003)i.verboseErrorHandler(p);},fetch:function(p,q,r){r=r||{};r.fetch_start=Date.now();this.parent.fetch(p,q,r);},fetchHandler:function(p,q){var r=p.getPayload(),s=l({fetch_end:Date.now()},q),t=s.value?h.BEHAVIOR_EVENT:h.BEHAVIOR_PERSISTENT;this.inform('beginFetchHandler',{response:p});if(q.type=='lean'){this._leanPayload=r;this._processLean();}else{if(r.coeff2_ts)s.coeff2_ts=r.coeff2_ts;var u={limit:typeof r.webSuggLimit!=='undefined'?r.webSuggLimit:6,showOnTop:typeof r.webSuggOnTop!=='undefined'?r.webSuggOnTop:false};this._queryToWebSuggState[q.value]=u;this.parent.fetchHandler(p,q);if(q.bootstrap&&!p.getRequest().getData().no_cache)s.browserCacheHit=(r.timestamp<this._genTime);if(q.bootstrap&&!r.no_data&&this._bootstrapRequestsPending>0){q.bootstrap=false;--this._bootstrapRequestsPending;!this._bootstrapRequestsPending&&this._bootstrapPostProcess();}if(r.no_data||r.stale||r.token!==this._token){var v=l({},p.getRequest().getData());if(v.lazy){delete v.lazy;v.token=this._token;this._fetchOnUse(v,q);}}}this.inform('endpointStats',s,t);},respond:function(p,q,r){this.inform('respondValidUids',q);this.inform('reorderResults',q);var s=this.buildData(q,p);s.forEach(function(t,u){t.origIndex=u;});this.inform('respond',{value:p,results:s,isAsync:!!r});return s;},buildData:function(p,q){if(!p||p.length===0)return [];var r=this.getWebSuggState(q),s=r.showOnTop,t=n.integrateWebsuggestions(p.map(this.getEntry.bind(this)),Boolean(s),this._maxResults,r.limit);t.length=Math.min(t.length,this._maxResults);return t;},getWebSuggState:function(p){while(p){var q=this._queryToWebSuggState[p];if(typeof q!=='undefined')return q;p=p.slice(0,p.length-1);}return {limit:0,showOnTop:false};},shouldFetchMoreResults:function(p){var q=0,r=0;p.forEach(function(s){if(s.type!=='websuggestion'||r++<this._maxWebSuggToCountFetchMore)q++;}.bind(this));return q<this._maxResults;},_bootstrapPostProcess:function(){var p={time:Date.now()};this.inform('bootstrapped',p,h.BEHAVIOR_PERSISTENT);this._processLean();},_processLean:function(){if(this._leanPayload){var p,q=this._leanPayload.entries;for(var r in q){p=this.getEntry(r);p&&(p.index=q[r]);}this.setExclusions(this._leanPayload.blocked);this._leanPayload=null;}},_updateMaxResults:function(){var p=window.innerHeight||document.documentElement.clientHeight;this.setMaxResults(Math.max(this._numResults.min,Math.min(this._numResults.max,Math.ceil(2+((p-370)/56)))));},_bootstrapFetch:function(p,q){var r=l(q,this.bootstrapData);if(this._criticalOnly&&this._lazyonload)r.lazy=1;this.fetch(this.bootstrapEndpoint,r,{bootstrap:true,type:p});++this._bootstrapRequestsPending;},_fetchOnUse:function(p,q){for(var r in this.bootstrapData)!p.hasOwnProperty(r)&&(p[r]=this.bootstrapData[r]);if(this._criticalOnly){this._fetchOnUseRequests.push({args:p,ctx:q});}else this.fetch(this.bootstrapEndpoint,p,q);},_fetchLean:function(){var p={no_cache:1};p.options=m(p.options);p.options.push('lean');this._fetchOnUse(p,{type:'lean'});},bootstrap:function(p){if(!p){this._criticalOnly=false;this._flushFetchOnUseRequests();}if(this._bootstrapped)return;var q={filter:['event'],no_cache:1};this._fetchOnUse(q,{type:'event'});var r=['app','page','group','friendlist'];r=r.concat(this._extraTypes||[]);if(this._noMultiFetch){r.push('user');this._bootstrapFetch('user',{filter:r});}else{this._bootstrapFetch('other',{filter:r});if(this._buckets){for(var s=0;s<this._buckets.length;++s){var t={filter:['user'],buckets:this._buckets[s]};this._bootstrapFetch('user',t);}}else this._bootstrapFetch('user',{filter:['user']});}this._fetchLean();this._bootstrapped=true;},_flushFetchOnUseRequests:function(){var p=this._fetchOnUseRequests.length;for(var q=0;q<p;++q){var r=this._fetchOnUseRequests[q];this.fetch(this.bootstrapEndpoint,r.args,r.ctx);}if(p>0)this.inform('extra_bootstrap',{time:Date.now()},h.BEHAVIOR_PERSISTENT);this._fetchOnUseRequests=[];},onLoad:function(p,q){this.inform('onload',{time:Date.now()},h.BEHAVIOR_PERSISTENT);if(p)this.bootstrap.bind(this,q).defer();},mergeUids:function(p,q,r,s){var t=r[0]?this.getEntry(r[0]):null,u=q[0]?this.getEntry(q[0]):null,v=(t&&t.replace_results)?t:null;v=(!v&&u&&u.replace_results)?u:v;var w=this.parent.mergeUids(p,q,r,s);if(v){this.inform('backend_topreplace',{});return this.deduplicateByKey([v.uid].concat(w));}return w;}});e.exports=o;});
__d("legacy:SearchDataSource",["SearchDataSource"],function(a,b,c,d){a.SearchDataSource=b('SearchDataSource');},3);
__d("SearchTypeaheadCore",["Event","function-extensions","Arbiter","Class","DOM","Input","Parent","TypeaheadCore","copyProperties"],function(a,b,c,d,e,f){var g=b('Event');b('function-extensions');var h=b('Arbiter'),i=b('Class'),j=b('DOM'),k=b('Input'),l=b('Parent'),m=b('TypeaheadCore'),n=b('copyProperties');function o(p){this.parent.construct(this,p);}i.extend(o,m);n(o.prototype,{init:function(p,q,r){this.parent.init(p,q,r);var s=l.byTag(r,'form'),t=this.reset.bind(this);h.subscribe('pre_page_transition',function(event,v){var w=/^\/search/,x=w.test(v.from.path),y=w.test(v.to.path);if(x&&!y)t.defer();});if(s){var u=j.find(s,'input.search_sid_input');g.listen(s,'submit',function(){if(this.data&&this.data.queryData)u.value=this.data.queryData.sid;t.defer();}.bind(this),g.Priority.URGENT);}},select:function(){this.reset();this.element.focus();(function(){this.element.blur();}).bind(this).defer();},handleTab:function(event){var p=this.view.getQuerySuggestion(this.value);if(p){k.setValue(this.element,p);this.checkValue();event.kill();}else this.parent.handleTab(event);},getSearchType:function(){return 'regular';}});e.exports=o;});
__d("legacy:SearchTypeaheadCore",["SearchTypeaheadCore"],function(a,b,c,d){a.SearchTypeaheadCore=b('SearchTypeaheadCore');},3);
__d("SearchTypeaheadView",["Arbiter","ContextualTypeaheadView","Class","ContextualLayerUpdateOnScroll","copyProperties","DOM","goURI","MusicConstants","MusicEvents","tx","URI","isEmail","fbt"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ContextualTypeaheadView'),i=b('Class'),j=b('ContextualLayerUpdateOnScroll'),k=b('copyProperties'),l=b('DOM'),m=b('goURI'),n=b('MusicConstants'),o=b('MusicEvents'),p=b('tx'),q=b('URI'),r=b('isEmail'),s=b('fbt');function t(v,w){this.parent.construct(this,v,w);}i.extend(t,h);function u(v){var w,x,y,z,aa=[],ba={};x=v.length;for(w=0;w<x;w++){y=v[w];z=y.render_type||y.type;if(!ba.hasOwnProperty(z)){ba[z]=aa.length;aa.push([]);}aa[ba[z]].push(y);}var ca=[];x=aa.length;for(w=0;w<x;++w){y=aa[w][0];z=y.render_type||y.type;ca=ca.concat(aa[w]);}return ca;}k(t.prototype,{initializeLayer:function(){this.parent.initializeLayer();this.layer.setOffsetY(-1);this.layer.enableBehavior(j);},ignoreClick:function(event){event.prevent();},_shouldShowSeeMore:true,_bucketize:true,queryData:{init:'quick'},render:function(v,w,x){if(this._bucketize)w=u(w);var y={results:w,value:v};this.inform('finalResultsReordering',y);return this.parent.render(v,y.results,x);},disableBucketization:function(){this._bucketize=false;},buildBuckets:function(v,w){var x=w.length,y=0,z;for(z=0;z<x;++z)if(w[z].type=='user')y++;this.setWebSuggLoggingParams(v,w);if(this._bucketize)w=this.parent.buildBuckets(v,w);if(v&&this._shouldShowSeeMore){w.push(this.buildSeeMore(v,x));if(r(v)&&(y<1))w.push(this.buildInvite(v));}return w;},buildSeeMore:function(v,w){var x;if(this.showKeywordResultsPage){x=s._("Search for {query}",[s.param('query',v)]);}else x=w>0?p._("See more results for {query}",{query:v}):p._("See results for {query}",{query:v});var y=w==1?"Displaying top result":p._("Displaying top {number} results",{number:w}),z=l.create('li',{className:'calltoaction'},[l.create('a',{href:this.getSeeMoreEndpoint(v),rel:'ignore'},[l.create('span',{className:'text'},[l.create('span',{className:'seeMore'},[x,l.create('span',{className:'arrow'})]),l.create('span',{className:'subtext'},[y])])])]);z.setAttribute('aria-label',x);return {uid:'search',node:z,search:true};},buildInvite:function(v){var w=p._("Invite {query} to Facebook",{query:v}),x=l.create('li',{className:'calltoaction'},[l.create('a',{href:this.getInviteEndpoint(v),rel:'ignore'},[l.create('span',{className:'text'},[l.create('span',{className:'invite'},[w])])])]);x.setAttribute('aria-label',w);return {uid:'invite',node:x,search:true};},searchPageQueryData:function(v){var w=this.results.filter(function(y){return y.type&&y.type!=='websuggestion'&&y.type!=='header';}).map(function(y){return y.uid;}),x={q:v,typeaheadResults:JSON.stringify(w)};return k(x,this.queryData||{});},select:function(v){var w=this.index,x=this.results[w];if(!x||x.type=='header')return;var y=this.items[w],z=l.scry(y,'a')[0];if(x.song){if(z)o.inform(n.MUSIC_BUTTON.ACTIVATE,z);v&&this.inform('highlight',{index:w,selected:x});}else{this.parent.select(v);if(z&&z.href)if(z.target=='_blank'){window.open(z.href);}else m(z.href);}},setSid:function(v){this.queryData.tas=v;},getSeeMoreEndpoint:function(v){return q(this.seeMoreEndpoint).addQueryData(this.searchPageQueryData(v)).toString();},getInviteEndpoint:function(v){return q('/invite.php').addQueryData({email_list:v});},show:function(){if(!this.isVisible()){g.inform('layer_shown',{type:'SearchTypeahead'});this.parent.show();}},hide:function(){if(this.isVisible()){g.inform('layer_hidden',{type:'SearchTypeahead'});this.parent.hide();}},getQuerySuggestion:function(v){var w=this.results[this.index],x=w&&w.type!='header'?w.text.toLowerCase():'';return x==v.toLowerCase()?'':x;},setWebSuggLoggingParams:function(v,w){var x=0,y=0;for(var z=0;z<w.length;z++)if(w[z].type==='websuggestion'){if(y===0)y=z+1;var aa='FR'+(z-x)+'AS'+x,ba=z+1;w[z].path+='&wssk='+aa+'&wssp='+ba+'&wspq='+encodeURIComponent(v);w[z].path+='&wssrc='+w[z].websuggestion_source;x++;}var ca='&wssc='+w.length+'-'+v.length+'&wsbp='+x+'-'+y;for(z=0;z<w.length;z++)if(w[z].type==='websuggestion')w[z].path+=ca;}});e.exports=t;});
__d("legacy:SearchTypeaheadView",["SearchTypeaheadView"],function(a,b,c,d){a.SearchTypeaheadView=b('SearchTypeaheadView');},3);
__d("legacy:Typeahead",["Typeahead"],function(a,b,c,d){a.Typeahead=b('Typeahead');},3);
__d("SearchTypeaheadRecorder",["Event","AsyncRequest","Banzai","Keys","TypeaheadUtil","ge","clickRefAction","copyProperties","userAction"],function(a,b,c,d,e,f){var g=b('Event'),h=b('AsyncRequest'),i=b('Banzai'),j=b('Keys'),k=b('TypeaheadUtil'),l=b('ge'),m=b('clickRefAction'),n=b('copyProperties'),o=b('userAction');function p(r){this.init(r);this.initEvents();}var q=function(r,s){var t=k.parse(s);if(t.flatValue[t.flatValue.length-1]===' ')return t.flatValue;var u=t.tokens[t.tokens.length-1],v={};r.forEach(function(aa){v[aa]=(v[aa]||0)+1;});var w={},x=t.tokens.slice(0,t.tokens.length-1);x.forEach(function(aa){w[aa]=(w[aa]||0)+1;});for(var y=0;y<r.length;++y){var z=r[y];if(z.indexOf(u)===0&&(v[z]-(w[z]||0)>0)){x.push(z);return x.join(' ');}}return undefined;};n(p.prototype,{_endPoint:'/ajax/typeahead/record_metrics.php',_banzaiRoute:'search',init:function(r){this.core=r.getCore();this.data=r.getData();this.view=r.getView();this.element=this.core.getElement();this.initTime=Date.now();this._onloadTime=0;this._extraRecorder=[];var s=l('search_first_focus');this.initStartTime=s&&s.value;this.bootstrapStats={bootstrapped:0};this._reset();},_reset:function(){this.stats={};this.avgStats={};this.appendStats={};this._backspacing=false;this._topreplace=false;this._inflightRequests={};this._reorderInfo=null;var r=Math.random().toString();this.data.setQueryData({sid:r});this.view.setSid(r);this.recordStat('sid',r);},initEvents:function(){this.core.subscribe('focus',function(event){if(!this.stats.session_start_time)this.recordStat('session_start_time',Date.now());}.bind(this));this.core.subscribe('blur',function(event){var r=Date.now();for(var s in this._inflightRequests){var t=this._inflightRequests[s],u=r-t;this.recordAvgStat('search_endpoint_ms_from_js',u);}this.recordStat('session_end_time',r);this.submit();}.bind(this));this.view.subscribe('select',function(r,s){this.recordSelectInfo(s);}.bind(this));this.view.subscribe('render',function(r,s){this.recordRender(s);}.bind(this));this.view.subscribe('recordAfterReorder',function(r,s){this._reorderInfo=n(this._reorderInfo,s);}.bind(this));this.data.subscribe('activity',function(r,s){this.recordStat('pending_request',s.activity);}.bind(this));this.data.subscribe('respondValidUids',function(r,s){this.validUids=s.slice(0);}.bind(this));this.data.subscribe('beforeQuery',function(r,s){if(!s.value){this.query='';this.results=[];return;}if(!this.stats.first_query_time)this.recordStat('first_query_time',Date.now());this.query=s.value;this.recordCountStat('num_queries');}.bind(this));this.data.subscribe('queryEndpoint',function(r,s){this.recordCountStat('num_search_ajax_requests');this.recordAvgStat('endpoint_query_length',s.value.length);this._inflightRequests[s.value]=Date.now();}.bind(this));this.data.subscribe('onload',function(r,s){this._onloadTime=s.time;}.bind(this));this.data.subscribe('bootstrapped',function(r,s){this.bootstrapStats.endTime=s.time;this.bootstrapStats.bootstrapped=1;}.bind(this));this.core.subscribe('recordFunction',function(r,s){this._extraRecorder.push(s);}.bind(this));this.data.subscribe('endpointStats',function(r,s){var t=s.fetch_end-s.fetch_start;if(s.value){this.recordAvgStat('search_endpoint_ms_from_js',t);}else this.bootstrapStats[s.type]=t;if(s.coeff2_ts)this.bootstrapStats.coeff2_ts=s.coeff2_ts;if(typeof s.browserCacheHit!='undefined')this.recordCountStat(s.browserCacheHit?'bootstrap_cachehits':'bootstrap_cachemisses');if(this._inflightRequests[s.value])delete this._inflightRequests[s.value];}.bind(this));this.data.subscribe('query',function(r,s){this.recordAvgStat('num_results_from_cache',s.results.length);}.bind(this));this.data.subscribe('backend_topreplace',function(r,s){if(false===this._topreplace){this.recordStat("backend_topreplace",1);this._topreplace=true;}}.bind(this));g.listen(this.element,'keydown',function(event){if(g.getKeyCode(event)==j.BACKSPACE){if(!this._backspacing&&this.query){this._backspacing=true;this.recordAppendStat('before_backspace_queries',this.query);}}else this._backspacing=false;}.bind(this));},recordStat:function(r,s){this.stats[r]=s;},recordCountStat:function(r){var s=this.stats[r];this.stats[r]=s?s+1:1;},recordAvgStat:function(r,s){if(this.avgStats[r]){this.avgStats[r][0]+=s;++this.avgStats[r][1];}else this.avgStats[r]=[s,1];},recordAppendStat:function(r,s){if(!this.appendStats.hasOwnProperty(r))this.appendStats[r]=[];this.appendStats[r].push(s);},recordRender:function(r){this.results=r.filter(function(s){return s.uid!='search'&&s.type!='disabled_result'&&s.type!='header';});if(this.results.length>0&&!this.stats.first_result_time)this.recordStat('first_result_time',Date.now());},recordSelectInfo:function(r){var s=r.selected,t=r.index;if(s.groupIndex!==undefined)t=r.index-s.groupIndex-1;var u={href:s.path},v=s.dataGT?{gt:JSON.parse(s.dataGT)}:{};m('click',u,null,null,v);o('search').uai('click');if(s.uid=='search'){this.recordStat('selected_search',1);}else if(s.uid=='invite'){this.recordStat('selected_invite',1);}else{var w=s.rankType||s.render_type||s.type,x=(w=='friend'?'user':w);this.recordStat('selected_'+x,1);this.recordStat('selected_position',t);this.recordStat('selected_type',w);this.recordStat('selected_name_length',s.text.length);this.recordStat('selected_id',s.uid);this.recordStat('selected_degree',s.bootstrapped?1:2);var y=k.parse(this.data.getTextToIndex(s)).tokens,z=q(y,this.query);if(z)this.recordStat('matched_terms',z);}var aa={};this._extraRecorder.forEach(function(ba){ba(r,this.results,aa);}.bind(this));this.recordStat('extra_select_info',JSON.stringify(aa));if(s.type==='websuggestion'){this.recordStat('selected_memcached_websuggestion',s.fromMemcache);this.recordStat('selected_websuggestion_source',s.websuggestion_source);}this.recordStat('selected_with_mouse',r.clicked?1:0);},_dataToSubmit:function(){this.recordStat('candidate_results',this.buildResults());this.recordStat('query',this.query);this.recordStat('init_time',this.initTime);if(this.initStartTime){this.recordStat('init_start_time',this.initStartTime);this.recordStat('onload_time',this._onloadTime);this.initStartTime=0;}this.recordStat('bootstrapped',this.bootstrapStats.bootstrapped);if(this.bootstrapStats.endTime){this.recordStat('bootstrapped_time',this.bootstrapStats.endTime);this.recordStat('user_bootstrap_ms',this.bootstrapStats.user);this.recordStat('other_bootstrap_ms',this.bootstrapStats.other);this.bootstrapStats.endTime=0;}this.recordStat('coeff2_ts',this.bootstrapStats.coeff2_ts);this.recordStat('max_results',this.data._maxResults);if(this._reorderInfo){var r=this._reorderInfo;r.organic.forEach(function(v){delete v.text;});this.recordStat('s_count',r.position_data.length);this.recordStat('s_bootstrap_id',r.s_bootstrap_id);this.recordStat('s_organic_results',JSON.stringify(r.organic));this.recordStat('s_candidate_tokens',JSON.stringify(r.tokens));this.recordStat('s_positions',JSON.stringify(r.position_data));this.recordStat('s_options',JSON.stringify(r.options));this.recordStat('s_variant',JSON.stringify(r.variant));}var s=this.stats;for(var t in this.avgStats){var r=this.avgStats[t];s[t]=r[0]/r[1];}for(var u in this.appendStats)s[u]=JSON.stringify(this.appendStats[u]);return s;},buildResults:function(){var r=(this.results||[]).map(function(s,t){var u=k.parse(this.data.getTextToIndex(s)).tokens,v=s.rankType||s.render_type||s.type,w=s.bootstrapped?1:0,x=s.s_token||'',y=q(u,this.query)||this.query,z=s.index_rank;if(typeof s.groupIndex=='number')return [s.groupIndex,s.indexInGroup,s.uid,v,w,x,y,z,s.origIndex];return [0,t,s.uid,v,w,x,y,z,s.origIndex];}.bind(this));return JSON.stringify(r);},submit:function(){var r=this._dataToSubmit();switch(this.data.recordingRoute){case 'double_recording':if(Math.random()>.5){r.recorded_first='legacy';setTimeout(this.submitThroughAsyncRequest.bind(this,r),0);i.post(this._banzaiRoute,r,{delay:0,retry:true});}else{r.recorded_first='banzai';i.post(this._banzaiRoute,r,{delay:0,retry:true});setTimeout(this.submitThroughAsyncRequest.bind(this,r),0);}break;case 'random_recording':if(Math.random()>.5){this.submitThroughAsyncRequest(r);}else i.post(this._banzaiRoute,r,{delay:0,retry:true});break;case 'banzai_basic':i.post(this._banzaiRoute,r);break;case 'banzai_vital':i.post(this._banzaiRoute,r,{delay:0,retry:true});break;default:this.submitThroughAsyncRequest(r);}this._reset();},submitThroughAsyncRequest:function(r){if(Object.keys(r).length>0)new h().setURI(this._endPoint).setMethod('POST').setData({stats:r}).setOption('handleErrorAfterUnload',true).setErrorHandler(function(s){r.retry=true;new h().setURI(this._endPoint).setMethod('POST').setData({stats:r}).setOption('asynchronous',false).send();}.bind(this)).send();}});e.exports=p;});
__d("TypeaheadSearchRecorderBasic",["SearchTypeaheadRecorder","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('SearchTypeaheadRecorder'),h=b('copyProperties'),i=b('emptyFunction');function j(k){this._typeahead=k;}h(j.prototype,{enable:function(){new g(this._typeahead);},disable:i});e.exports=j;});
__d("legacy:SearchRecorderBasicTypeaheadBehavior",["TypeaheadSearchRecorderBasic"],function(a,b,c,d){var e=b('TypeaheadSearchRecorderBasic');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.searchRecorderBasic=function(f){f.enableBehavior(e);};},3);
__d("SearchTypeaheadRenderer",["Badge","DOM","Env","MusicButtonManager","TypeaheadFacepile","TypeaheadUtil"],function(a,b,c,d,e,f){var g=b('Badge'),h=b('DOM'),i=b('Env'),j=b('MusicButtonManager'),k=b('TypeaheadFacepile'),l=b('TypeaheadUtil');function m(n,o){var p=[],q=n.photos||n.photo;if(q){if(q instanceof Array){q=k.render(q);}else q=h.create('img',{alt:'',src:q});p.push(q);if(n.song){p.push(h.create('span',{className:'playButton'}));p.push(h.create('span',{className:'playLoader'}));}}var r;if(n.text){var s=n.alias,t=this.value,u=n.text;r=[u];if(n.text_extra)r.push(n.text_extra);if(s&&l.isQueryMatch(t,s)&&!l.isQueryMatch(t,u))r.push(h.create('span',{className:'alias'},[' \xB7 '+s]));if(n.verified)r.push(g('xsmall'));p.push(h.create('span',{className:'text'},r));}if(n.category){var v=[n.category];if(n.is_external)v.push(h.create('span',{className:'arrow'}));var w=n.message?'preCategory':'category';p.push(h.create('span',{className:w},v));}if(n.message)p.push(h.create('span',{className:'category'},[n.message]));var x=n.subtextOverride||n.subtext;if(x)p.push(h.create('span',{className:'subtext'},[x]));var y=n.classNames||n.type||'',z=n.is_external?'_blank':'',aa=!n.song&&n.path||'';if(aa){if(!(/^https?\:\/\//).test(aa))aa=i.www_base+aa.substr(1);aa+=(aa.indexOf('?')>0?'&':'?')+'ref=ts&fref=ts';}var ba=h.create('a',{href:aa,rel:'ignore',target:z},p);if(n.song){ba.id='mb_'+(Math.random()*1e+06|0);j.addButton.curry(n.song.provider,ba.id,n.song.url,n.song.context,n.song.media_type).defer();ba.onclick=this.ignoreClick;}var ca=h.create('li',{className:y},[ba]);if(n.text)ca.setAttribute('aria-label',n.text);return ca;}m.className='search';e.exports=m;});
__d("legacy:SearchTypeaheadRenderer",["SearchTypeaheadRenderer"],function(a,b,c,d){if(!a.TypeaheadRenderers)a.TypeaheadRenderers={};a.TypeaheadRenderers.search=b('SearchTypeaheadRenderer');},3);
void(0);
__d("TypeaheadSearchFilter",["Arbiter","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties');function i(j){this._typeahead=j;}h(i.prototype,{_subscription:null,enable:function(){var j=this._typeahead,k=j.getView().seeMoreEndpoint;this._subscriptions=[g.subscribe('search/typeahead/updateFilter',function(l,m){if(m.filter_type=='web')j.getView().queryData.form='FBKBFR';j.getView().queryData.type=m.filter_type;}),g.subscribe('search/typeahead/updateSeeMoreEndpoint',function(l,m){j.getView().seeMoreEndpoint=m;}),g.subscribe('page_transition',function(l,m){if(j.getView().queryData.form)delete j.getView().queryData.form;delete j.getView().queryData.type;j.getView().seeMoreEndpoint=k;},g.SUBSCRIBE_NEW)];},disable:function(){this._subscriptions.forEach(function(j){j.unsubscribe();});this._subscriptions=null;}});e.exports=i;});
__d("legacy:SearchFilterTypeaheadBehavior",["TypeaheadSearchFilter"],function(a,b,c,d){var e=b('TypeaheadSearchFilter');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.initFilters=function(f){f.enableBehavior(e);};},3);
__d("TypeaheadDetectQueryLocale",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(i){this._typeahead=i;this._data=i.getData();this._queryCache={'':this._data.queryCache,ja_JP:{},zh_TW:{}};}g(h.prototype,{enable:function(){this._previousLocale='';this._reset=this._typeahead.subscribe('reset',this._swapQueryCache.bind(this,''));this._beforeQuery=this._data.subscribe('beforeQuery',function(i,j){var k=j.value;if(k===''){this._swapQueryCache('');return;}var l=null,m=k.charCodeAt(k.length-1);if(12352<=m&&m<=12543){l='ja_JP';}else if(12544<=m&&m<=12735)l='zh_TW';this._swapQueryCache(l);}.bind(this));},disable:function(){this._swapQueryCache('');this._data.unsubscribe(this._beforeQuery);this._typeahead.ubsubscribe(this._reset);},_swapQueryCache:function(i){if(i===null||i===this._previousLocale)return;this._data.queryCache=this._queryCache[i];this._data.setQueryData({query_locale:i});this._previousLocale=i;}});e.exports=h;});
__d("TypeaheadDisableBucketization",["copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('emptyFunction');function i(j){this._typeahead=j;}g(i.prototype,{enable:function(){this._typeahead.getView().disableBucketization();this._typeahead.getData().inform('recordFunction',function(j,k,l){l.bucketization_disabled=1;});},disable:h.thatReturns});e.exports=i;});
__d("TypeaheadExcludeBootstrapFromQueryCache",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(i){this._data=i.getData();}g(h.prototype,{enable:function(){this._buildingQueryCache=false;this._buildQueryCache=this._data.subscribe('buildQueryCache',function(){this._buildingQueryCache=true;}.bind(this));this._mergeUids=this._data.subscribe('mergeUids',function(i,j){if(this._buildingQueryCache)j.local_uids.splice(0,j.local_uids.length);}.bind(this));this._fetchComplete=this._data.subscribe('fetchComplete',function(){this._buildingQueryCache=false;}.bind(this));},disable:function(){this._data.unsubscribe(this._buildQueryCache);this._data.unsubscribe(this._mergeUids);this._data.unsubscribe(this._fetchComplete);}});e.exports=h;});
__d("TypeaheadSearchBrowseUpsell",["Arbiter","CSS","DOM","Event","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('Event'),k=b('copyProperties'),l=b('emptyFunction'),m='TypeaheadSearchBrowseUpsell/form';function n(o){this._typeahead=o;this._form=null;g.subscribe(m,this._registerForm.bind(this));}k(n,{registerForm:function(o){g.inform(m,o,g.BEHAVIOR_STATE);}});k(n.prototype,{_registerForm:function(o,p){this._form=p.cloneNode(true);i.scry(this._form,'button').forEach(function(q){h.removeClass(q,'selected');});j.listen(this._form,'success',function(){this._typeahead.view.hide();h.addClass(this._form,'browseSuccess');}.bind(this));},addUpsell:function(o){if(this._form){var p=i.create('li',{className:'browseUpsell'},this._form);o.push({type:'disabled_result',uid:'upsell',node:p});}},decorateSeeMore:function(o){var p=o[o.length-1];if(p&&p.uid==='search')h.addClass(p.node,'browseMore');},showUpsell:function(){var o=this._typeahead.view;return o._shouldShowSeeMore&&!h.hasClass(o,'typeaheadViewLoading');},enable:function(){this._typeahead.subscribe('beforeRender',function(o,p){var q=p.results.length;if(q&&this.showUpsell()){this.decorateSeeMore(p.results);this.addUpsell(p.results);}}.bind(this));},disable:l});e.exports=n;});
__d("TypeaheadRegulateMemorializedUsers",["copyProperties","TypeaheadUtil"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('TypeaheadUtil');function i(j){this._typeahead=j;}g(i.prototype,{_filterRegistry:null,_filter:function(j,k){if(j.type!=='user'||!j.memorialized)return true;var l=h.parse(j.text).tokens;if(l.length===1&&h.isExactMatch(k,j.text))return true;var m=this._typeahead.getData().getTextToIndex(j),n=h.parse(k).tokens;return (n.length>1&&h.isQueryMatch(k,m));},enable:function(){this._filterRegistry=this._typeahead.getData().addFilter(this._filter.bind(this));},disable:function(){this._filterRegistry.remove();this._filterRegistry=null;}});e.exports=i;});
__d("legacy:RegulateMemorializedUsersTypeaheadBehavior",["TypeaheadRegulateMemorializedUsers"],function(a,b,c,d){var e=b('TypeaheadRegulateMemorializedUsers');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.regulateMemorializedUsers=function(f){f.enableBehavior(e);};},3);