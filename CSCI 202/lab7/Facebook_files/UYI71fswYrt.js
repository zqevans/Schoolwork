/*1369296433,173224227*/

if (self.CavalryLogger) { CavalryLogger.start_js(["ewJoi"]); }

__d("BrowseLogger",["Banzai","copyProperties","Run","BrowseLogExpOptions"],function(a,b,c,d,e,f){var g=b('Banzai'),h=b('copyProperties'),i=b('Run'),j='browse',k='browse_aggr',l=b('BrowseLogExpOptions'),m=null,n={},o={};function p(){m=null;n={};o={};}function q(x){h(x,{clientSessionID:m});return x;}function r(x){return l.actionWithRetry&&x in l.actionWithRetry;}function s(x){var y={};if(l.actionWithNoDelay&&x.action in l.actionWithNoDelay)y.delay=0;y.retry=r(x.action);g.post(j,q(x),y);}function t(){if(m===null)return;o.aggregated=n;var x={};if(l.actionWithNoDelay&&'summedStats' in l.actionWithNoDelay)x.delay=0;x.retry=r('summedStats');g.post(k,q(o),x);p();}function u(x){n[x]=(n[x]||0)+1;}function v(x){h(o,x);}i.onUnload(t);var w={newSession:function(){t();m=Math.random().toString();if(!o.start_time)o.start_time=Math.round(Date.now()/1000);},logResultClick:function(x,y,z,aa,ba,ca,da,ea,fa,ga){var ha={action:'result_click',click_type:y,id:z,path:x,rank:ba,referrer:da,result_type:aa,session_id:ca,abtest_version:ea,abtest_params:fa,typeahead_sid:ga};u('result_click_'+y);v({path:x,referrer:da,result_type:aa,session_id:ca,abtest_version:ea,abtest_params:fa,typeahead_sid:ga});s(ha);},logControlsClick:function(x,y,z,aa,ba,ca){var da={action:'controls_click',click_type:y,path:x,referrer:ca,session_id:aa,filter_name:z,typeahead_sid:ba};u('controls_click_'+y);v({path:x,referrer:ca,session_id:aa,typeahead_sid:ba});s(da);},logResultHover:function(x,y,z,aa,ba,ca){var da={action:'result_hover',id:y,path:x,rank:z,session_id:ba,time_elapsed:aa,typeahead_sid:ca};u('result_hover');v({path:x,session_id:ba,typeahead_sid:ca});s(da);},logNUXStep:function(x){var y={action:'nux_step',step:x};s(y);},logDisambiguationImpression:function(x,y,z,aa,ba){var ca={action:'disambiguation_imp',ids:aa,name:x,path:z,type:y,typeahead_sid:ba};s(ca);},logDisambiguationClick:function(x,y,z,aa,ba,ca){var da={action:'disambiguation_clk',id:ba,index:aa,name:x,path:z,type:y,typeahead_sid:ca};s(da);}};e.exports=w;});
__d("BrowseMouseSpeedTracker",["Event","removeFromArray"],function(a,b,c,d,e,f){var g=b('Event'),h=b('removeFromArray'),i=50,j=null,k=null,l=[],m={x:0,y:0},n=0,o=[{x:0,y:0},{x:0,y:0}];function p(){o[n].x=m.x;o[n].y=m.y;n=(n+1)%2;}function q(){var w=o[0].x-o[1].x,x=o[0].y-o[1].y;return Math.sqrt(w*w+x*x)*(1000/i);}function r(){if(j)return;k=g.listen(document.body,'mousemove',function(event){m.x=event.pageX||event.screenX;m.y=event.pageY||event.screenY;});j=window.setInterval(function(){p();t(q());},i);}function s(){if(j){window.clearInterval(j);k.remove();j=null;}}function t(w){l.forEach(function(x){if(w<x.velocity){x.callback(w);u(x);}});}function u(w){h(l,w);l.length||s();}var v={addTrigger:function(w,x){var y={velocity:w,callback:x};r();l.push(y);return {remove:u.curry(y)};}};e.exports=v;});
__d("BrowseMouse",["Event","BrowseMouseSpeedTracker","CSS","DOM","DataStore","Parent","Run","Toggler","cx","removeFromArray"],function(a,b,c,d,e,f){var g=b('Event'),h=b('BrowseMouseSpeedTracker'),i=b('CSS'),j=b('DOM'),k=b('DataStore'),l=b('Parent'),m=b('Run'),n=b('Toggler'),o=b('cx'),p=b('removeFromArray'),q=500,r="_3u0",s="_3u1",t=null,u=[];function v(da){return l.byClass(da,s);}function w(da){return 'browse-'+(da?'over':'out');}function x(da){return i.addClass(da,s);}function y(da,ea,fa,ga){var ha=v(ea);if(!ga)u.push({element:ea,callback:fa});if(ha){var ia=w(da),ja=k.get(ha,ia,[]);k.set(ha,ia,ja.concat(fa));return ha;}}function z(da,ea){if(da){i.conditionClass(da,r,ea);var fa=k.get(da,w(ea));fa&&fa.forEach(function(ga){ga();});}}function aa(da){var ea=da.element;['browse-over','browse-out'].forEach(function(fa){var ga=k.get(ea,fa);if(ga){p(ga,da.callback);ga.length||k.remove(ea,fa);}});}function ba(){var da=null;if(t)return;t=g.listen(document.body,'mouseover',function(ea){var fa=v(ea.getTarget());if(!fa||fa==da)return;var ga=null,ha=null,ia=false;da=fa;var ja=h.addTrigger(q,function(){z(fa,true);ia=true;}),ka=function(){ja.remove();ma.remove();ga&&ga.remove();ha&&ha.unsubscribe();},la=function(){ka();ia&&z(fa,false);da=null;},ma=g.listen(fa,'mouseleave',function(){var na=n.getActive();if(na&&j.contains(fa,na)){ha=n.subscribe('hide',la);ga=g.listen(fa,'mouseover',ka);}else la();});});m.onLeave(function(){while(u.length)aa(u.pop());});}var ca={init:ba,makeTarget:x,onMouseOver:y.curry(true),onMouseOut:y.curry(false),removeListeners:aa};e.exports=ca;});
__d("BrowseNUXBootstrap",["Arbiter","AsyncRequest","invariant","Run"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('invariant'),j=b('Run'),k=null,l=null,m={registerFacebar:function(n){i(!k);k=n;j.onLoad(function(){new h('/ajax/browse/nux.php').setAllowCrossPageTransition(true).send();});},registerMegaphone:function(n){l=n;g.inform('BrowseNUX/megaphone',{},g.BEHAVIOR_STATE);},getFacebarData:function(){return k;},getMegaphoneData:function(){return l;}};e.exports=m;});
__d("BrowseNUXCheckpoint",["AsyncRequest","emptyFunction"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('emptyFunction');function i(l,m){new g('/ajax/browse/nux_checkpoint.php').setData(l).setFinallyHandler(m||h).send();}var j=null,k={SHOW_MEGAPHONE:0,RESULTS_VIEW:1,COMPLETED:2,init:function(l){j=l;},getStep:function(){return j;},setStep:function(l,m){j=l;i({nextStep:l},m);},setFinished:function(l){j=k.COMPLETED;i({finished:true},l);}};e.exports=k;});
__d("BrowseNUXMegaphone",["Event","function-extensions","Animation","CSS","cx","DOM","Ease","Style","Vector","$","copyProperties","csx"],function(a,b,c,d,e,f){var g=b('Event');b('function-extensions');var h=b('Animation'),i=b('CSS'),j=b('cx'),k=b('DOM'),l=b('Ease'),m=b('Style'),n=b('Vector'),o=b('$'),p=b('copyProperties'),q=b('csx');function r(s){this.megaphone=s;this.startButton=k.find(this.megaphone,"a._a06");this.hideLink=k.find(this.megaphone,"a._53o0");}p(r.prototype,{_attachListener:function(){var s=1,t=function(){var u=this._getScrollOpacity();if(u!==s){m.set(this.megaphone,'opacity',u===1?'':u);i.conditionShow(this.megaphone,u>0);s=u;}}.bind(this);this.listener=g.listen(window,'scroll',t);t();},_removeListener:function(){if(this.listener){this.listener.remove();this.listener=null;}},_getScrollOpacity:function(){var s=n.getElementPosition(o('globalContainer'),'viewport'),t=Math.max(0,Math.min(1,(s.y+70)/40));return l.circOut(t);},isShown:function(){return this.shown;},show:function(s){if(this.shown)return;this.shown=true;var t=5,u=o('blueBarHolder').offsetHeight-t;m.set(this.megaphone,'top',u+'px');m.set(this.megaphone,'opacity',0);k.appendContent(o('pageHead'),this.megaphone);i.show(this.megaphone);var v=(this.megaphone.offsetHeight||90)-t;if(i.hasClass(document.body,"_561r"))v=0;new h(s).to('marginTop',v).duration(500).ease(l.sineOut).go();var w=this._getScrollOpacity();if(w){new h(this.megaphone).duration(250).checkpoint().to('opacity',w).duration(250).ease(l.makePowerIn(2)).ondone(function(){if(w===1)m.set(this.megaphone,'opacity','');this._attachListener();}.bind(this)).go();}else{this._attachListener();i.hide(this.megaphone);}},hide:function(s){if(!this.shown)return;this.shown=false;this._removeListener();new h(this.megaphone).to('opacity',0).duration(250).ease(l.makePowerOut(2)).go();new h(s).to('marginTop',0).duration(500).ease(l.sineIn).ondone(k.remove.curry(this.megaphone)).go();},setStartHandler:function(s){return g.listen(this.startButton,'click',s);},setHideHandler:function(s){return g.listen(this.hideLink,'click',s);}});e.exports=r;});
__d("TextSelection",[],function(a,b,c,d,e,f){var g=window.getSelection,h=document.selection,i={getSelection:function(){if(g){return g()+'';}else if(h)return h.createRange().text;return null;},clearSelection:function(){if(g){g().removeAllRanges();}else if(h)h.empty();},selectAllInNode:function(j){var k=document.body.createTextRange;if(k){var l=k();l.moveToElementText(j);l.select();}else if(g){var m=g(),n=document.createRange();n.selectNodeContents(j);m.removeAllRanges();m.addRange(n);}}};e.exports=i;});
__d("BrowseNUXTourDialog",["Event","Animation","CSS","DOMQuery","LayerSlowlyFadeOnShow","TextSelection","UserAgent","copyProperties","csx","cx","emptyFunction"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Animation'),i=b('CSS'),j=b('DOMQuery'),k=b('LayerSlowlyFadeOnShow'),l=b('TextSelection'),m=b('UserAgent'),n=b('copyProperties'),o=b('csx'),p=b('cx'),q=b('emptyFunction');function r(s,t){this.dialog=s;this.typeahead=t;this.dialog.enableBehavior(k);this._closeButtonHandler=null;i.addClass(this.dialog.getRoot(),"_a5c");i.addClass(this.dialog.getContent(),"_a5d");this.subscription=this.dialog.subscribe('beforehide',q.thatReturnsFalse);if(this.typeahead){i.conditionClass(this.dialog.getRoot(),"_4-r4",!m.ie()||m.ie()>8);this.listener=g.listen(this.typeahead.getView().getElement(),{mouseover:this.checkHiddenResult.bind(this),mouseleave:this.setTranslucent.bind(this,false)});}}n(r.prototype,{showWithContext:function(s,t){this.resultIndex=t;this.dialog.setContext(s).show();l.clearSelection();},checkHiddenResult:function(event){var s=event.getTarget();if(isNaN(this.resultIndex)||!s)return;var t=this.typeahead.getView().getItems()[this.resultIndex];t&&this.setTranslucent(j.contains(t,s));},setTranslucent:function(s){i.conditionClass(this.dialog.getRoot(),"_c2o",s);},getButton:function(){return j.find(this.dialog.getRoot(),"a._a08");},getCloseButton:function(){return j.find(this.dialog.getRoot(),"a._5234");},activateCloseButton:function(s){var t=this.getCloseButton();this._closeButtonHandler=g.listen(t,'click',function(event){this.reset();s(event);}.bind(this));i.show(t);},showButton:function(){var s=this.getButton();i.removeClass(s,'invisible_elem');new h(s).to('opacity',1).go();},setNextHandler:function(s){var t=g.listen(this.getButton(),'click',function(event){t.remove();this.reset();s(event);}.bind(this));},reset:function(){this.subscription.unsubscribe();this._closeButtonHandler&&this._closeButtonHandler.remove();if(this.listener){this.listener.mouseover.remove();this.listener.mouseleave.remove();}this.dialog.hide();}});e.exports=r;});
__d("Typewriter",[],function(a,b,c,d,e,f){var g=[null,null],h={request:function(i,j,k){k=k||200;var l=false,m=1,n=g.length;(function o(){if(l)return;var p=j.substr(0,m);if(p===j){i(p,true);g[n]=null;}else{i(p,false);m++;setTimeout(o,k);}})();g[n]=function(){l=true;};return n;},cancel:function(i){if(!g[i])return false;g[i]();g[i]=null;return true;}};e.exports=h;});
__d("BrowseNUXTypewriter",["Typewriter","Arbiter","copyProperties"],function(a,b,c,d,e,f){var g=b('Typewriter'),h=b('Arbiter'),i=b('copyProperties');function j(k){this.structuredInput=k;}i(j.prototype,{setValue:function(k,l){this._type(k,function(m,n){h.inform("BrowseNUX/typing");this.structuredInput.setText(m);this.structuredInput.togglePlaceholder();this.structuredInput.moveSelectionToEnd();}.bind(this),l);},prependFragment:function(k,l){var m=this.structuredInput,n=m.getStructure();this._type(k.text,function(o){h.inform("BrowseNUX/typing");k.text=o;m.setStructure([k].concat(n));m.setSelection({offset:o.length,length:0});},l);},abort:function(){if(this._token){g.cancel(this._token);this._cleanup();}},_type:function(k,l,m){this.abort();var n=this.structuredInput;this._wasEnabled=n.getEnabled();n.setEnabled(true);n.focus();this._token=g.request(function(o,p){l(o);if(p){this._cleanup();m&&m();}}.bind(this),k,100);},_cleanup:function(){this.structuredInput.setEnabled(this._wasEnabled);delete this._token;delete this._wasEnabled;}});e.exports=j;});
__d("FacebarSemanticQuery",["URI","copyProperties","Env"],function(a,b,c,d,e,f){var g=b('URI'),h=b('copyProperties'),i=b('Env'),j='str';function k(t){var u={me:i.user};return h(u,t.semantic_map);}function l(t,u){var v=k(t);if(typeof v[u]!=='undefined')return String(v[u]);return u;}function m(t){return new g("/profile.php").addQueryData({id:t});}function n(t,u){var v,w=q(u),x={};for(var y=0;y<w.length;++y)if(w[y].indexOf('path(')===0){v=g(q(w[y])[0]);}else{var z=w[y].substring(6,w[y].indexOf('(')).split('_'),aa=q(w[y]);for(var ba=0;ba<z.length;++ba)x[z[ba]]=l(t,aa[ba]);}v.addQueryData(x);return v;}function o(t,u){var v=[u],w=[],x=t.browse_functions,y=t.search_path;while(v.length>0){var z=v.pop();if(!p(z)){w.push(z);continue;}var aa=z.substring(0,z.indexOf('(')),ba=aa,ca=q(z);if(!x[aa]){w=[];break;}var da=x[aa].minNumParams,ea=x[aa].maxNumParams;if(v.length>0)if(x[aa].numParamsUnbounded){if(w.length>0)aa+='-'+ca.length;}else if((ca.length!=1&&ca.length>da)||(ca.length===0&&da!=ea))aa+='-'+ca.length;v.push(aa);for(var fa=0;fa<ca.length;fa++){if(ca[fa].length===0)continue;if(x[ba].allowsFreeText){v.push(j+'/'+encodeURIComponent(ca[fa]));}else v.push(ca[fa]);}}return g(y+w.join('/'));}function p(t){return (/^[a-z\-]+\(.*\)$/).test(t);}function q(t){if(!p(t)&&t.indexOf('param_')!==0)return [t];var u=t.substring(t.indexOf('(')+1,t.length-1);if(u.length===0)return [];return r(u);}function r(t){var u=[],v=0,w=0;for(var x=0;x<t.length;++x)if(t[x]==','&&w===0){u.push(t.substring(v,x));v=x+1;}else if(t[x]=='('){w++;}else if(t[x]==')')w--;u.push(t.substring(v,t.length));return u;}function s(t,u){this.facebarConfig=t;this.unmapped=(u||"").trim();this.mapped=l(t,this.unmapped);this.position=null;}h(s.prototype,{isEntity:function(){return (/^\d+$/).test(this.mapped);},isURI:function(){return this.mapped.indexOf('uri(')===0;},isImplemented:function(){return this.mapped&&this.mapped.indexOf('*')==-1;},getUnimplemented:function(){return (this.mapped.match(/\*[\w\-]+\(/g)||[]).map(function(t){return t.substr(1,t.length-2);});},getURI:function(){if(this.isEntity()){return m(this.mapped);}else if(this.isURI()){return n(this.facebarConfig,this.mapped);}else return o(this.facebarConfig,this.unmapped);}});e.exports=s;});
__d("FacebarURI",["URI","Env","FacebarSemanticQuery"],function(a,b,c,d,e,f){var g=b('URI'),h=b('Env'),i=b('FacebarSemanticQuery'),j={getSearchRawPrefix:function(){return 'search';},getSearchPath:function(){return '/'+this.getSearchRawPrefix()+'/';},getURI:function(k,l){var m=null,n=!l.song&&l.path;if(n){m=new g(n);if(l.type=='user')m.addQueryData({fref:'ts'});}else{var o=new i(k,l.semantic);if(o&&o.isImplemented())m=o.getURI();}return m&&j.getQualifiedURI(m);},getQualifiedURI:function(k){var l=new g(k);if(!l.getDomain()){var m=g(h.www_base);l.setProtocol(m.getProtocol()).setDomain(m.getDomain()).setPort(m.getPort());}return l;}};e.exports=j;});
__d("BrowseNUXController",["Event","function-extensions","Arbiter","BrowseLogger","BrowseNUXBootstrap","BrowseNUXCheckpoint","BrowseNUXMegaphone","BrowseNUXTourDialog","BrowseNUXTypewriter","CSS","DOM","DOMScroll","FacebarStructuredText","FacebarURI","KeyEventController","LayerSlowlyFadeOnShow","MegaphoneHelper","ModalMask","PageTransitions","Parent","Run","SubscriptionsHandler","URI","Vector","copyProperties","csx","cx","emptyFunction","ge","startsWith"],function(a,b,c,d,e,f){var g=b('Event');b('function-extensions');var h=b('Arbiter'),i=b('BrowseLogger'),j=b('BrowseNUXBootstrap'),k=b('BrowseNUXCheckpoint'),l=b('BrowseNUXMegaphone'),m=b('BrowseNUXTourDialog'),n=b('BrowseNUXTypewriter'),o=b('CSS'),p=b('DOM'),q=b('DOMScroll'),r=b('FacebarStructuredText'),s=b('FacebarURI'),t=b('KeyEventController'),u=b('LayerSlowlyFadeOnShow'),v=b('MegaphoneHelper'),w=b('ModalMask'),x=b('PageTransitions'),y=b('Parent'),z=b('Run'),aa=b('SubscriptionsHandler'),ba=b('URI'),ca=b('Vector'),da=b('copyProperties'),ea=b('csx'),fa=b('cx'),ga=b('emptyFunction'),ha=b('ge'),ia=b('startsWith'),ja={init:function(na){da(ja,{bootstrap:j.getFacebarData(),megaphone:new l(na.megaphone),fragments:na.fragments,resultURI:na.resultURI,buttons:na.buttons,dialogs:na.dialogs,endDialog:na.endDialog});k.init(na.nextStep);h.inform('BrowseNUX/initialized');ja.initMegaphoneHandler();},initMegaphoneHandler:function(){function na(){if(k.getStep()!==k.SHOW_MEGAPHONE)return;ja.showMegaphone();h.inform('BrowseNUX/starting');}h.subscribe('BrowseNUX/megaphone',na);},startAtNextStep:function(){var na=x.getNextURI().getPath();switch(k.getStep()){case k.SHOW_MEGAPHONE:break;case k.RESULTS_VIEW:if(ia(na,s.getSearchPath())){setTimeout(function(){ja.showEndDialog();h.inform('BrowseNUX/starting');},2000);}else i.logNUXStep('abandon');break;default:return;}z.onAfterLoad(function(){x.setCompletionCallback(ja.startAtNextStep);});},toggleSponsoredResults:function(na){var oa=ja.bootstrap,pa=oa.typeahead,qa=oa.FacebarTypeaheadSponsoredResults;if(qa)if(na){pa.enableBehavior(qa);}else pa.disableBehavior(qa);},showMegaphone:function(){var na=ha('contentArea')||ha('content');if(na){var oa=ja.megaphone,pa=j.getMegaphoneData(),qa=function(ta){ra.remove();sa.remove();if(oa.isShown()){oa.hide(na);ta&&i.logNUXStep(ta);}},ra=oa.setStartHandler(function(){qa();ja.showSearchBarTour();}.bind(this)),sa=oa.setHideHandler(function(){v.hideStory(pa.id,pa.location);qa('hide');});o.addClass(oa.megaphone,pa.className);oa.show(na);i.logNUXStep('show_megaphone');ja.prefetchResults();la(qa.curry('ignore'));}},prefetchResults:function(){var na=ja.bootstrap.typeahead.getData(),oa=ja.fragments;na.query(r.fromStruct([oa.page]));na.query(r.fromStruct([oa.edge,oa.page]));},showSearchBarTour:function(na){var oa=ja.dialogs;i.logNUXStep('start');var pa=ja.bootstrap.input,qa=ja.bootstrap.typeahead,ra=ma(qa);ja.toggleSponsoredResults(false);t.registerKey('BACKSPACE',ga.thatReturnsFalse);pa.setEnabled(false);w.show();var sa=new m(oa.search,qa),ta=new n(pa),ua=ja.fragments.page,va=ua.text.toLowerCase(),wa=function(){sa.showWithContext(pa.getRoot(),0);},xa=function(){pa.focus();ta.setValue(va,function(){setTimeout(function(){pa.setStructure([ua]);pa.moveSelectionToEnd();ka(qa,function(){sa.showButton();});},1000);});};setTimeout(wa,0);setTimeout(xa,2000);var ya=new m(oa.phrase,qa),za=ja.fragments.edge;oa.phrase.setOffsetY(-10);sa.setNextHandler(function(){i.logNUXStep('phrase');ta.prependFragment(za,function(){ka(qa,function(){var bb=qa.getView().getItems()[0];if(bb){var cb=p.find(bb,"span._7gk");ya.showWithContext(cb,1);}else ya.showWithContext(pa.getRoot(),0);setTimeout(ya.showButton.bind(ya),2000);});});});ya.setNextHandler(function(){i.logNUXStep('personalized');k.setStep(k.RESULTS_VIEW,function(){ra.release();x.go(ba(ja.resultURI).addQueryData({view:'list'}));});});o.addClass(document.body,"_474s");function ab(){ja.toggleSponsoredResults(true);ta.abort();ra.release();sa.reset();ya.reset();w.hide();pa.setEnabled(true);o.removeClass(document.body,"_474s");}if(na){sa.activateCloseButton(ab);ya.activateCloseButton(ab);}la(ab);},showEndDialog:function(){var na=ja.bootstrap.input,oa=ja.bootstrap.typeahead,pa=ja.endDialog;pa.enableBehavior(u);pa.show();i.logNUXStep('end_dialog');k.setFinished();h.inform('BrowseNUX/finished');var qa=function(ta){na.setStructure([]);na.togglePlaceholder();na.focus();if(o.hasClass(document.documentElement,'tinyViewport')){var ua=new ca(0,0,'document');q.scrollTo(ua,true,false,false,ta);}else if(ta)ta();},ra=pa.subscribe('button',function(ta,ua){pa.hide();switch(ua.getAttribute('data-action')){case 'replay':ja.showSearchBarTour(true);i.logNUXStep('replay');break;case 'search':qa();i.logNUXStep('search');break;case 'cancel':i.logNUXStep('cancel');break;}}),sa=g.listen(pa.getRoot(),'click',function(event){var ta=event.getTarget();if(ta){var ua;if(ta.getAttribute('data-action')){ua=ta.getAttribute('data-action');}else ua=ta.parentNode.getAttribute('data-action');if(ua)i.logNUXStep(ua);}var va=y.byClass(ta,"_a0z");if(!va||event.isDefaultRequested())return;pa.hide();qa(function(){var wa=va.getAttribute('data-query')+' ',xa=new n(na);setTimeout(function(){xa.setValue(wa,function(){ka(oa,function(){x.go(va.getAttribute('href'));});});},1000);});return false;});la(function(){sa.remove();ra.unsubscribe();});}};function ka(na,oa){var pa=new h();pa.registerCallback(oa,['timeout','render']);setTimeout(pa.inform.bind(pa,'timeout'),2000);var qa=setTimeout(sa,6000),ra=na.subscribe('render',sa);function sa(){ra.unsubscribe();clearTimeout(qa);pa.inform('render');}la(ra.unsubscribe.bind(ra));}function la(na){x.registerHandler(na,10);}function ma(na){var oa=new aa('FacebarTypeaheadLock');oa.addSubscriptions(g.listen(ja.bootstrap.input.getRichInput(),'keydown',ga.thatReturnsFalse),na.getCore().subscribe('close',ga.thatReturnsFalse),na.getView().subscribe(['beforeHighlight','beforeSelect'],ga.thatReturnsFalse));return oa;}e.exports=ja;});
__d("concatMap",[],function(a,b,c,d,e,f){function g(h,i){var j=-1,k=i.length,l=[],m;while(++j<k){m=h(i[j],j,i);Array.isArray(m)?Array.prototype.push.apply(l,m):Array.prototype.push.call(l,m);}return l;}e.exports=g;});
__d("FacebarResultStoreUtils",[],function(a,b,c,d,e,f){var g={processEntityResult:function(h,i,j,k){var l={semantic:i.toString(),structure:[{type:'ent:'+h,text:j,uid:i}],type:'{'+h+'}',cost:k,cache_id_length:0,bolding:[]};l.tuid=JSON.stringify({semantic:l.semantic,structure:l.structure});return l;}};e.exports=g;});
__d("FacebarResultStore",["copyProperties","concatMap","FacebarResultStoreUtils","TypeaheadUtil"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('concatMap'),i=b('FacebarResultStoreUtils'),j=b('TypeaheadUtil'),k='unimplemented';function l(m,n,o){this.facebarConfig=m;this.facebarConfig.grammar_stop_words_penalty=this.facebarConfig.grammar_stop_words_penalty||2;this.facebarConfig.grammar_stop_words=this.facebarConfig.grammar_stop_words||{};this.tokenize=n;this.getEntry=o;this.typeaheadTypeMap=this.facebarConfig.mapped_types;this.facebarConfig.typeahead_types.forEach(function(p){this.typeaheadTypeMap[p]=p;}.bind(this));this.resetCaches();this.cacheEnabled(true);}l.EPSILON=1e-05;g(l.prototype,{transformStructured:function(m){var n=[],o=[],p='',q='';m.forEach(function(t,u){if(t.isType('text')){p+=t.getText();q=(q==null)?null:q+t.getText();}else{var v=p.match(/\"/g);if(v&&v.length%2)p=p.replace(/\s+$/,'')+'"';if(p.length){Array.prototype.push.apply(n,this.tokenize(p));o.push(p);p='';}n.push(t.toStruct());o.push({uid:String(t.getUID()),type:this._getFBObjectType(t.getTypePart(1)),text:t.getText()});q=null;}}.bind(this));if(p.length){if(p[p.length-1]=='\'')p=p.substr(0,p.length-1);Array.prototype.push.apply(n,this.tokenize(p));o.push(p);if(p[p.length-1]==' ')n.push('');}var r=JSON.stringify(o),s=r.replace(/\]$/,'').replace(/\"$/,'');s=s.replace(/\s{2,}/g,' ');return {tokens:n,text_form:r,is_empty:!!r.match(/^\[(\"\s*\")?\]$/),raw_text:q,cache_id:s};},resetCaches:function(){this.bootstrapCache={};this.queryCache={'':{tokens:[],results:[]}};},setNullState:function(m){this.facebarConfig.null_state=m.map(this._extractStructure.bind(this));},addEntryToNullState:function(m){if(this.facebarConfig.null_state){var n=this.facebarConfig.entity_cost+m.grammar_costs['{'+m.type+'}'],o=i.processEntityResult(m.type,m.uid,m.text,n);this.facebarConfig.null_state.unshift(o);}},setSortFunction:function(m){this._sortFunction=m;},addBootstrap:function(m){var n=this.bootstrapCache;m.forEach(function(o){var p=this.getEntry(o);p.bootstrapped=true;var q=this.tokenize(p.textToIndex,true);if(p.tokens)Array.prototype.push.apply(q,p.tokens.split(' '));q.forEach(function(r){if(!n.hasOwnProperty(r))n[r]={};n[r][o]=true;});},this);},addNullStateToQueryCache:function(m){this.saveResults(this.facebarConfig.null_state,m,true);},getResults:function(m){if(m.tokens.length===0||(m.tokens.length==1&&m.tokens[0]===''))return {results:this.facebarConfig.null_state||[],null_state:true};var n=this._getBestQueryCache(m.cache_id),o=n.results,p=this._getBootstrapMatchByType(m.tokens),q=this._addMatchingBootstrapResults(m.tokens,p[0]||{});Array.prototype.push.apply(q,h(this._getResultsFromCache.bind(this,p,m.tokens),o));var r={},s=[],t=false;q.sort(this._sortFunction).forEach(function(u){var v=l.getUniqueSemantic(u.semantic);if(!v||r[v])return;if(t&&u.blankFilled)return;t=t||!!u.blankFilled;r[v]=u.semantic;s.push(u);}.bind(this));return {results:s,webSuggOnTop:n.webSuggOnTop,webSuggLimit:n.webSuggLimit,webSuggLimitSeeMore:n.webSuggLimitSeeMore};},cacheEnabled:function(m){this._enableCache=m;},saveResults:function(m,n,o,p){m=m.map(this._processBackendResult.bind(this));var q=[];if(this._enableCache){var r={},s={};m.forEach(function(u){s[u.semantic]=true;u.parse&&u.parse.disambiguation&&u.parse.disambiguation.forEach(function(v){r[v]=true;});});var t=this._getBestQueryCache(n.cache_id);t.results.forEach(function(u){if(u.type==='websuggestion')return;if(u.semanticForest in r)return;var v=this._getDifferenceArrayTokens(u.tokens,n.tokens),w=this._getNumTokensMatching(v,u);w=this._tryMatchingFinalInsertedEntity(v,w,u);if(w>0&&w==v.length){u.cacheOnlyResult=!s[u.semantic];q.push(u);}}.bind(this));}m.forEach(function(u){u.tokens=n.tokens;u.cache_id_length=n.cache_id.length;q.push(u);});if(this.queryCache[n.cache_id]===undefined)this.queryCache[n.cache_id]={};g(this.queryCache[n.cache_id],{tokens:n.tokens,results:q,incomplete:o});g(this.queryCache[n.cache_id],p);},alreadyKnown:function(m){return !!this.queryCache[m]&&!this.queryCache[m].incomplete;},stripBrackets:function(m){return m.replace(/^[\[\{]/,'').replace(/[\]\}]$/,'');},_extractStructure:function(m){function n(q,r,s){return {type:q,text:r,uid:s||null};}function o(q,r){q.split(' ').forEach(function(s){if(s!==''){if(r)m.chunks.push(m.structure.length);m.structure.push(n('text',s));}m.structure.push(n('text',' '));});m.structure.pop();}function p(q){var r=(m.structure.length===0&&m.type!='websuggestion')?q.charAt(0).toUpperCase()+q.substr(1):q;return r;}m.structure=[];m.chunks=[];m.parse.display.forEach(function(q){if(typeof q==='string'){o(p(q),true);}else if(q.uid){var r=this.getEntry(q.uid,q.fetchType);m.chunks.push(m.structure.length);if(r.grammar_like){o(p(r.text),false);}else{var s=q.type;if(q.fetchType)s+=':'+q.fetchType;m.structure.push(n(s,r.text,q.uid));}}else{m.chunks.push(m.structure.length);m.blankType=q.type.replace(/^blank:/,'');m.structure.push(n(q.type,''));}}.bind(this));return m;},_getDifferenceArrayTokens:function(m,n){if(!m.length)return [''].concat(n);var o=m.length-1,p=m[o];if(p==='')p=m[--o];return [typeof(p)=='string'?n[o].substr(p.length):''].concat(n.slice(o+1));},_processBackendResult:function(m){m.semantic=m.semantic.toString();this._extractStructure(m);if(m.type.match(/^\{.*\}$/))m.useExtendedIndex=true;if(m.semantic.match(/\[.*\]/)){var n=m.parse,o=n.pos;if(o===undefined){m.semantic=m.semantic.replace(/\[(.*)\]/g,'$1');}else{var p=n.remTokens[n.remTokens.length-1];if(n.remTokens.length&&m.structure[m.chunks[p]].uid){o=n.remTokens[n.remTokens.length-1];m.completed=true;}var q=m.structure[m.chunks[o]].uid;if(q===null){m.semantic=m.semantic.replace(/\[(\d*)\]/g,'$1');}else{var r=new RegExp('\\['+q+'\\]','g');m.unsubstituted_semantic=m.semantic;m.semantic=m.semantic.replace(r,q);if(n&&n.disambiguation&&n.disambiguation.length>0){n.disambiguation=n.disambiguation.filter(function(s){return s.indexOf('['+q+']')!==-1;});n.unsubstituted_disambiguation=n.disambiguation.splice(0);n.disambiguation=n.disambiguation.map(function(s){return s.replace(r,q);});}}}}m.semantic=m.semantic.replace(/\[(.*)\]/g,'$1');m.tuid=JSON.stringify({semantic:m.semantic,structure:m.structure});return m;},_sortFunction:function(m,n){return (m.cost||0)-(n.cost||0);},_getResultsFromCache:function(m,n,o){var p=this._getDifferenceArrayTokens(o.tokens,n),q=[],r=this._getNumTokensMatching(p,o),s=this._tryMatchingFinalInsertedEntity(p,r,o);if(s>0&&s==p.length)q.push(o);o.bolding=this._computeBolding(o,p,0);Array.prototype.push.apply(q,this._trySubstitutingBootstrapResult(m[n.length-p.length],o,p));if(r<=0)return q;var t=p.slice(r);r+=n.length-p.length;var u={};if(r==n.length){--r;if(r<0)return q;if(n[r]!=='')u=this._computeBolding(o,p,1);}if(r==n.length-1&&n[r]===''){--r;if(r<0)return q;u=this._computeBolding(o,p,1);}var v=function(w,x){x.bolding=w;return x;}.bind(null,u);Array.prototype.push.apply(q,this._tryMatchingFinalBootstrapResult(m[r],t,o).map(v));return q;},_addMatchingBootstrapResults:function(m,n){return h(function(o){var p=n[o];if(p===undefined)return [];var q=[];p.forEach(function(r){var s=this.getEntry(r,o);if(!this._isTitleTermMatch(m,s))return;var t=this._isExactNameMatch(m,s)?0:this.facebarConfig.non_title_term_match_penalty,u=this._isNonGrammarTermMatch(m,s),v=s.grammar_costs['{'+o+'}']+t+this.facebarConfig.entity_cost+this.facebarConfig.grammar_stop_words_penalty*!u;q.push(i.processEntityResult(o,r,s.text,v));}.bind(this));return q;}.bind(this),this.facebarConfig.bootstrap_types);},_isTitleTermMatch:function(m,n){var o=m[0]||{};if(typeof(o)=='object')return false;var p=n.titleToIndex;return m.length===1?j.isPrefixMatch(o,p):j.isExactMatch(o,p);},_isExactNameMatch:function(m,n){var o=m[0]||{};if(typeof(o)=='object')return 0;var p=n.text;if(m.length===1?j.isPrefixMatch(o,p):j.isExactMatch(o,p))return true;return m.length==1&&n.alias!==undefined&&j.isExactMatch(o,n.alias);},_isNonGrammarTermMatch:function(m,n){var o=j.parse(n.titleToIndex.toLowerCase()),p=o.tokens.filter(function(s){return s!==''&&!this.facebarConfig.grammar_stop_words[s];}.bind(this));for(var q=0;q<m.length;++q){if(typeof(m[q])=='object')return true;var r=q===m.length-1?j.isPrefixMatch(m[q],p):j.isQueryMatch(m[q],p);if(r)return true;}return false;},_getBootstrapMatchByType:function(m){if(m.length===0)return [];var n=m.map(function(){return {};}),o=(m[m.length-1]===''),p={},q,r=(o?m.length-1:m.length);if(r&&m[r-1].uid){this._pushBootstrapEntryAtPosition(n,r-1,m[r-1].uid);return n;}for(var s in this.bootstrapCache)if(r&&s.indexOf(m[r-1])===0&&(!o||s===m[r-1]))for(q in this.bootstrapCache[s])if(!p[q]){p[q]=1;this._pushBootstrapEntryAtPosition(n,r-1,q);}for(var t=r-2;t>=0;t--){if(typeof(m[t])=='object')break;if(m[t].length&&m[t][0]=='"')break;for(q in this.bootstrapCache[m[t]]){if(!p[q])p[q]=0;if(p[q]+t==r-1){++p[q];this._pushBootstrapEntryAtPosition(n,t,q);}}}return n;},_pushBootstrapEntryAtPosition:function(m,n,o){var p=this.getEntry(o);if(!p)return;for(var q in p.grammar_costs){var r=this.stripBrackets(q);if(m[n][r]===undefined)m[n][r]=[];m[n][r].push(o);}},_getNumTokensMatching:function(m,n){var o=0,p=n.parse,q=m.length,r=null,s=null;if(p.pos!==undefined){var t=n.structure[n.chunks[p.pos]];r=t.uid;s=t.type.split(':')[2];}n.outputTokensUsed=[];if(r){o=this._prefixMatchEntity(m,p,r,n.outputTokensUsed,s,!!n.useExtendedIndex);if(o===0||o===q)return o;}else if(p.suffix&&q==1&&p.suffix.indexOf(m[0])===0){return q;}else if(p.suffix==m[0]){++o;}else return 0;var u=[];for(var v=0;v<p.remTokens.length;v++){if(typeof(m[o])!='string'||n.chunks.length<p.remTokens[v]||n.structure[n.chunks[p.remTokens[v]]].uid)break;var w=n.structure[n.chunks[p.remTokens[v]]].text;u.push(w.toLowerCase());}o=this._greedyMatchText(u,m,o,p.remTokens,n.outputTokensUsed);if(o==q-1&&m[o]==='')return q;return o;},_prefixMatchEntity:function(m,n,o,p,q,r){if(n.entTokens.length===0){if(m[0]!=='')return 0;if(n.possessive&&m.length>1&&m[1]=='\'s'){p.push([n.pos+1]);return 2;}else return 1;}var s=false,t=this.getEntry(o,q);if(typeof(q)!=='undefined'&&q!==t.fetchType)return 0;var u=this.tokenize(r?t.textToIndex:t.text,true),v=[];for(var w=0;w<m.length+n.entTokens.length-1;w++)if(w<n.entTokens.length-1){v.push(n.entTokens[w]);}else if(w==n.entTokens.length-1){v.push(n.entTokens[w]+m[0]);}else v.push(m[w-n.entTokens.length+1]);var x=-n.entTokens.length+1;for(var y=0;y<v.length;++y){var z=v[y];if(typeof(z)!='string')break;if(z===''){x++;continue;}var aa=false;for(var ba=0;ba<u.length;ba++)if(u[ba]==z||(y===v.length-1&&u[ba].indexOf(z)===0)){u[ba]='';aa=true;++x;break;}if(aa)continue;if(!n.possessive||z.length<=2||z.substr(z.length-2)!='\'s')break;var ca=z.substr(0,z.length-2);for(ba=0;ba<u.length;ba++)if(u[ba]==ca){++x;if(p)s=true;break;}break;}if(x>0){if(s)p.push([n.pos+1]);return x;}if(p===undefined)return 0;var da=m[0],ea=da;if(n.possessive&&da.length>=2&&da.substr(da.length-2)=='\'s')ea=da.substr(0,da.length-2);if((m.length==1&&n.suffix.indexOf(da)===0)||n.suffix==ea||n.suffix==da){if(ea!=da&&n.suffix==ea)p.push([n.pos+1]);return 1;}return 0;},_tryMatchingFinalInsertedEntity:function(m,n,o){if(!o.completed||n<0)return n;var p=o.parse,q=p.remTokens[p.remTokens.length-1],r=o.structure[o.chunks[q]],s=this.getEntry(r.uid,r.type),t=this.tokenize(s.text,true);n=this._greedyMatchText(t,m,n);if(n==m.length-1&&m[n]==='')return m.length;return n;},_greedyMatchText:function(m,n,o,p,q){for(var r=0;r<m.length;r++){var s=m[r];if(s==n[o]){if(q!==undefined)q.push(p[r]);++o;continue;}if(o===n.length-1&&s.indexOf(n[o])===0){if(q!==undefined)if(s==n[o]){q.push([p[r]]);}else q.push([p[r],n[o].length]);return n.length;}}return o;},_createMapOverFinalBootstrapUids:function(m,n,o,p,q,r){return function(s){var t=this.getEntry(s,q);if(t===undefined||r(s,t)===false)return;var u={};g(u,m);if(!u.iconClass)u.photo=t.photo;u.cost=m.cost+l.EPSILON+t.grammar_costs['{'+q+'}']-o.grammar_costs['{'+q+'}'];u.cache_id_length=Infinity;u.structure=m.structure.slice(0);u.structure[m.chunks[p]]={type:n.type,text:t.text,uid:s};u.blankFilled=true;var v=new RegExp('\\['+n.uid+'\\]','g');u.semantic=m.unsubstituted_semantic.replace(v,s);if(u.parse&&u.parse.disambiguation&&u.parse.disambiguation.length>0)u.parse.disambiguation=u.parse.unsubstituted_disambiguation.map(function(w){return w.replace(v,s);});u.tuid=JSON.stringify({semantic:u.semantic,structure:u.structure});return u;}.bind(this);},_tryMatchingFinalBootstrapResult:function(m,n,o){if(!o.completed)return [];var p=o.parse,q=p.remTokens[p.remTokens.length-1],r=o.structure[o.chunks[q]],s=r.type.substr(4).replace(':blank',''),t=this.getEntry(r.uid,s),u=m[s];if(u===undefined||t===undefined||t.grammar_costs===undefined)return [];return u.map(this._createMapOverFinalBootstrapUids(o,r,t,q,s,function(v,w){return n.length==this._greedyMatchText(this.tokenize(w.text),n,0);}.bind(this))).filter(function(v){return !!v;});},_trySubstitutingBootstrapResult:function(m,n,o){if(n.unsubstituted_semantic===undefined||n.completed||n.type===k)return [];var p=n.parse.pos,q=n.structure[n.chunks[n.parse.pos]],r=q.type.substr(4),s=m[r];if(s===undefined)return [];var t=this.getEntry(q.uid);if(!t||t.grammar_costs===undefined)return [];return s.map(this._createMapOverFinalBootstrapUids(n,q,t,p,r,function(u){return this._prefixMatchEntity(o,n.parse,u)===o.length;}.bind(this))).filter(function(u){return !!u;});},_computeBolding:function(m,n,o){var p={};if(m.parse.pos!==undefined){var q=m.structure[m.chunks[m.parse.pos]];if(!q.uid)p[m.chunks[m.parse.pos]]=q.text.length-m.parse.suffix.length+n[0].length;}m.parse.unmatch.forEach(function(t){if(typeof(t)=='object'){p[m.chunks[t[0]]]=m.structure[m.chunks[t[0]]].text.length-t[1].length;}else p[m.chunks[t]]=0;});m.parse.remTokens.forEach(function(t){p[m.chunks[t]]=0;});for(var r=0;r<m.outputTokensUsed.length-o;r++){var s=m.outputTokensUsed[r];if(s.length==1){delete p[m.chunks[s[0]]];}else p[m.chunks[s[0]]]=s[1];}return p;},_getBestQueryCache:function(m){for(var n=m.length;n>=0;n--){var o=this.queryCache[m.slice(0,n)];if(o)return o;}},_getFBObjectType:function(m){if(this.typeaheadTypeMap[m]){return this.typeaheadTypeMap[m];}else return 'page';}});l.getUniqueSemantic=function(m){var n=[],o=[],p=[];m='('+m+')';var q=m,r=false;m.replace(/[\(\),]/g,function(s,t){var u;switch(s){case ',':var v=p.length-1;u=q.substr(p[v],t-p[v]);n[v].push(u);p[v]=t+1;break;case '(':p.push(t+1);n.push([]);o.push(t+1);break;case ')':if(p.length===0)throw m+' is not a valid semantic string';var w=p.pop();u=q.substr(w,t-w);var x=n.pop();x.push(u);var y=x.sort();for(var z=1;z<y.length;z++)if(y[z]==y[z-1])r=true;var aa=y.join(',');q=q.substr(0,o.pop())+aa+q.substr(t);break;}return s;});if(r)return '';return q.replace(/\((.*)\)/,'$1');};e.exports=l;});
__d("FacebarTokenizer",["TypeaheadUtil"],function(a,b,c,d,e,f){var g=b('TypeaheadUtil'),h="[^\"]",i=["\\s's","'s","\""+h+"*\"?"],j=[[/\s+$/,''],[/\"\s+/,'"'],[/\s+\"/,'"'],[/\"\"/,''],[/^\"$/,''],[/\s+/,' ']],k={tokenize:function(l,m){var n=[],o=0;l=l.replace(/\s/g,' ').toLowerCase();l.replace(new RegExp(i.join('|'),'g'),function(q,r){if(r>o){var s=l.substr(o,r-o);Array.prototype.push.apply(n,g.parse(s).tokens.slice(0));}var t=q;for(var u=0;u<j.length;u++){var v=j[u];t=t.replace(v[0],v[1]);}if(n.length&&t=='\'s'){n[n.length-1]+=t;}else if(t!=='')n.push(t);if(m)Array.prototype.push.apply(n,g.parse(q).tokens);o=r+q.length;});if(o<l.length){var p=l.substr(o,l.length-o);Array.prototype.push.apply(n,g.parse(p).tokens.slice(0));}return n;}};e.exports=k;});
__d("FacebarDataSource",["Arbiter","AsyncRequest","Class","FacebarResultStore","FacebarStructuredText","FacebarTokenizer","FacebarURI","SearchDataSource","Vector","ViewportBounds","copyProperties","throttle","FacebarBrowseSnippetOptions","BingScalingCommon"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('Class'),j=b('FacebarResultStore'),k=b('FacebarStructuredText'),l=b('FacebarTokenizer'),m=b('FacebarURI'),n=b('SearchDataSource'),o=b('Vector'),p=b('ViewportBounds'),q=b('copyProperties'),r=b('throttle'),s=b('FacebarBrowseSnippetOptions'),t=b('BingScalingCommon'),u=100,v=250;function w(x){this.parent.construct(this,x);this.filterOutWebSuggestion=true;this.bootstrap_saved=[];this.null_state=null;this._initialQueryData=null;this._curQueryId=-1;this._seeMore=false;this._waitingQueries=0;this.mixGrammarAndEntity=x.mixGrammarAndEntity!==undefined?x.mixGrammarAndEntity:true;this.recordingRoute=x.recordingRoute||'banzai_vital';this.oldSeeMore=!!x.oldSeeMore;this.grammarVersion=x.grammarVersion||'';this._allowGrammar=x.allowGrammar!==false;this._webSearchLockedInMode=x.webSearchLockedInMode!==false;this.cacheNullState=(x.cacheNullState===true);this.nullStateEndpoint=x.nullStateEndpoint||'/ajax/browse/null_state.php';this.setNullStateData(x.nullStateData||{},true);this._minWebSugg=x.minWebSugg||1;this._minQueryLength=x.minQueryLength||-1;this.allowWebSuggOnTop=x.allowWebSuggOnTop||false;this._maxWebSuggToCountFetchMore=x.maxWebSuggToCountFetchMore||0;this.executeQueryThrottled=r(this.executeQuery,u,this);this.sendRemoteQueryThrottled=r(this.sendRemoteQuery,v,this);var y=new h().setURI('/ajax/typeahead/search/facebar/config.php').setData({version:this.grammarVersion}).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true).setHandler(function(z){this.facebarConfig=z.payload;this.createResultStore();if(this.null_state){this.setNullState(this.null_state);this.null_state=null;}this.inform('ready',true);}.bind(this)).setFinallyHandler(this.activityEnd.bind(this));this.activityStart();y.send();this.fetchNullState();}i.extend(w,n);q(w.prototype,{events:['query','respond','bootstrapped','activity','ready'],createResultStore:function(){this.resultStore=new j(this.facebarConfig,l.tokenize,this.getEntry.bind(this));this.addEntries(this.bootstrap_saved);this.bootstrap_saved=[];this.subscribe('enableCache',function(x,y){this.resultStore.cacheEnabled(y);}.bind(this));this.subscribe('setSortFunction',function(x,y){this.resultStore.setSortFunction(y);}.bind(this));},dirty:function(){this.bootstrap_saved=[];this._nullStateFetched=false;if(this.resultStore)this.resultStore.resetCaches();this.parent.dirty();},addEntries:function(x){if(this.resultStore){this.resultStore.addBootstrap(this.processEntries(x));}else Array.prototype.push.apply(this.bootstrap_saved,x);},setNullStateData:function(x,y){if(y)this.nullStateData={grammar_version:this.grammarVersion};q(this.nullStateData,x);return this;},setNullState:function(x){if(this.resultStore){this.processEntries(x.entities);this.resultStore.setNullState(x.queries,this.cacheNullState);if(this.cacheNullState)this.resultStore.addNullStateToQueryCache(this.getRawStructure(k.fromString('')));this.inform('ready',true);}},refetchNullState:function(){this._nullStateFetched=false;this.fetchNullState();},allowGrammar:function(){return this._allowGrammar;},isWebSearchLockedInModeEnabled:function(){return this._webSearchLockedInMode;},fetchNullState:function(){if(this._nullStateFetched||!this._allowGrammar)return;var x=new h().setURI(this.nullStateEndpoint).setData(this.nullStateData).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true).setHandler(function(y){if(this.resultStore){this.setNullState(y.payload);}else this.null_state=y.payload;this._nullStateFetched=true;}.bind(this)).setFinallyHandler(this.activityEnd.bind(this));this.activityStart();x.send();},toTypeaheadEntryUid:function(x){var y,z=k.fromStruct(x.structure),aa=z.getFragment(0);if(z.getCount()==1&&aa.isType('ent')){var ba=aa.getType().split(':')[2];y=this.getEntry(aa.getUID(),ba);y.type=this.resultStore.stripBrackets(x.type);}else{y=this.getEntry(x.tuid);if(!y){var ba,ca,da;if(x.type==='websuggestion'||x.type==='somethingnew_mystery'||x.type==='somethingnew_grammar'){ba=x.type;da=x.iconClass;}else{ba='grammar';ca=x.type;da=x.iconClass;}y={dynamic_cost:x.dynamic_cost,error_info:x.errorInfo,extra_uri_params:x.extra_uri_params,icon_class:da,memcache:x.fromMemcache,photo:x.photo,results_set_type:ca,tuid:x.tuid,type:ba,uid:x.tuid,websuggestion_source:x.websuggestion_source};this.processEntries([y]);y=this.getEntry(x.tuid);}}if(y.type==='websuggestion')y.path=x.path;y.logInfo=x.logInfo;y.structure=z;y.text=y.structure.toString();y.queryTypeText=x.queryTypeText;y.semantic=x.semantic;y.tree=x.tree;y.cost=x.cost;y.isSeeMore=!!x.isSeeMore;y.isNullState=!!x.isNullState;y.unusedEntity=x.unusedEntity;y.cacheOnlyResult=x.cacheOnlyResult||false;y.uri=y.uri||m.getURI(this.facebarConfig,y);y.semanticForest=x.semanticForest;y.entityTypes=x.entityTypes;y.parse=x.parse;y.removable=true;if(x.parse&&x.parse.disambiguation&&x.parse.disambiguation.length>0){y.disambiguation_paths=[];for(var ea=0;ea<x.parse.disambiguation.length;ea++){var fa={};fa.semantic=x.parse.disambiguation[ea];var ga=m.getURI(this.facebarConfig,fa);if(ga){ga.path=ga.path.replace('/^\/'+m.getSearchRawPrefix()+'\//','');y.disambiguation_paths.push(ga.path);}}}return y.tuid;},getRawStructure:function(x){if(typeof x=='string')x=k.fromString(x);if(this.resultStore)return this.resultStore.transformStructured(x.toArray());},isSeeMore:function(){return this._seeMore;},saveResult:function(x){this._initialQueryData=x.uid;},buildUids:function(x,y,z){if(!x||!this.resultStore)return [];if(typeof x=='string')x=k.fromString(x);var aa=this.getRawStructure(x),ba=this.resultStore.getResults(aa),ca=ba.results;if(typeof ca==='undefined')return [];var da=ba.webSuggOnTop;if(typeof da==='undefined')da=false;var ea=(this._seeMore&&this.oldSeeMore?ba.webSuggLimitSeeMore:ba.webSuggLimit)||0,fa=ba.null_state===true,ga=this.filterOutWebSuggestion&&!fa,ha=0;ca=ca.filter(function(ka,la){if(!this._allowGrammar&&ka.type=='grammar')return false;if(ka.type!='websuggestion'){return ka.semantic!='<blank>'&&(ka.type!='unimplemented'||ha++===0);}else return !ga;});var ia=[],ja=[];ca.forEach(function(ka){if(ka.isSeeMore){ia.push(ka);}else ja.push(ka);});if(fa){ca=this.orderNullState(ca,this.getMaxResults());}else{ca=t.integrateWebsuggestions(ja,Boolean(da),this.getMaxResults(),ea,this._minWebSugg);if(!this.oldSeeMore)ca.length=Math.min(ca.length,this.getMaxResults());}if(ia.length>0)ca.push.apply(ca,ia);return ca.map(this.toTypeaheadEntryUid.bind(this));},getUnusedEntities:function(x,y){var z={"{user}":true,"{page}":true,"{place}":true,"{group}":true,"{app}":true},aa={};y.forEach(function(ca){if(ca.type&&z[ca.type]===true)aa[ca.semantic]=true;ca.unusedEntity=false;});var ba=x.filter(function(ca){return (ca.type&&z[ca.type]===true&&aa[ca.semantic]!==true);});ba=ba.map(function(ca){ca.unusedEntity=true;return ca;});return ba;},orderNullState:function(x,y){var z={top:[],bottom:[],middle:[]},aa=function(da){var ea=da.null_state_position;return z.hasOwnProperty(ea)?ea:'middle';},ba=function(da,ea){return da.original_cost-ea.original_cost;};x&&x.forEach(function(da){z[aa(da)].push(da);}.bind(this));for(var ca in z){z[ca]=z[ca].sort(ba).slice(0,y);y-=z[ca].length;}return [].concat(z.top,z.middle,z.bottom);},handleResponse:function(x,y){if(!(x.payload.errors)){this.processEntries(x.payload.entities);this.filterOutWebSuggestion=true;for(var z=0;z<x.payload.results.length;z++)if(x.payload.results[z].type=='websuggestion'){this.filterOutWebSuggestion=false;break;}var aa={};['webSuggOnTop','webSuggLimit','webSuggLimitSeeMore'].forEach(function(ba){if(x.payload.hasOwnProperty(ba))aa[ba]=x.payload[ba];});this.resultStore.saveResults(x.payload.results,y,x.payload.incomplete,aa);}},processEntries:function(x){return x.map(function(y,z){var aa=(y.uid=y.uid+'');y.textToIndex=this.getTextToIndex(y);y.titleToIndex=this.getTitleTerms(y);aa=this.getUID(aa,y.fetchType);var ba=this.getEntry(aa);if(!ba){this.setEntry(aa,{});ba=this.getEntry(aa);}q(ba,y);ba.tuid=aa;ba.index===undefined&&(ba.index=z);return aa;}.bind(this));},getUID:function(x,y){x=x+'';if(y!==undefined){y=/([^:]+:)?([^:]+)(:.*)?/.exec(y)[2];return JSON.stringify([x,y]);}return x;},getEntry:function(x,y){if(y!==undefined){var z=this.parent.getEntry(this.getUID(x,y));if(z)return z;}return this.parent.getEntry(x);},getEntryForFragment:function(x){return this.getEntry(x.getUID(),x.getTypePart(2));},getMaxResults:function(){return ((this.oldSeeMore&&this._seeMore)?3:1)*this._numResults.max;},query:function(x,y,z,aa){this.executeQueryThrottled(x,aa,this._initialQueryData);this._initialQueryData=null;},executeQuery:function(x,y,z){this._seeMore=y===true;this._curQueryId++;this.setQueryData({qid:this._curQueryId,see_more:this._seeMore,max_results:(this.getMaxResults()+s.additionalResultsToFetch),num_entities:((this._seeMore&&this.oldSeeMore)?this._numResults.max:0)});this.inform('beforeQuery',{value:x,queryId:this.curQueryId});var aa=this.buildUids(x,[]);if(z){aa=aa.filter(function(ca){return ca!==z;});aa.unshift(z);}this.value=x;this.inform('query',{value:x,results:aa,see_more:this._seeMore,queryId:this._curQueryId});if(this.resultStore){var ba=this.getRawStructure(x);if(this.shouldFetchMore(ba,aa))this.sendRemoteQueryThrottled(ba,x);this.respond(x,aa,false);}},shouldFetchMore:function(x,y){if(x.is_empty)return false;if(this._seeMore)return true;if(this.resultStore.alreadyKnown(x.cache_id))return false;if(x.raw_text&&x.raw_text.length<this._minQueryLength)return false;if(y.length<this.getMaxResults())return true;return this.countValidResults(y)<this.getMaxResults();},countValidResults:function(x){var y=0,z=0;x.forEach(function(aa){var ba=this.getEntry(aa);if(ba&&!ba.isNullState)if(ba.type==='websuggestion'){y++;}else z++;}.bind(this));return z+Math.min(this._maxWebSuggToCountFetchMore,y);},sendRemoteQuery:function(x,y){var z=new h().setURI(this.queryEndpoint).setData(this.getQueryData(x.text_form)).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true).setHandler(function(aa,ba){ba.queryId=aa;this.inform('response_received',ba);this.handleResponse(ba,x);this.respond(y,this.buildUids(y),true,ba.payload&&(!ba.payload.results||ba.payload.results.length===0));this.inform('backend_response',ba);}.bind(this,this._curQueryId)).setFinallyHandler(this.activityEnd.bind(this));this.inform('sending_request',z);this.activityStart();z.send();},activityStart:function(){if(!this._waitingQueries)this.inform('activity',{activity:true,seeMore:this._seeMore},g.BEHAVIOR_STATE);this._waitingQueries++;},activityEnd:function(){this._waitingQueries--;if(!this._waitingQueries)this.inform('activity',{activity:false,seeMore:this._seeMore},g.BEHAVIOR_STATE);},respond:function(x,y,z,aa){this.inform('reorderResults',y);this.inform('respondValidUids',y);var ba=y.map(this.getEntry.bind(this));this.inform('respond',{value:x,results:ba,isAsync:!!z,isEmptyResults:aa,isScrollable:this.isSeeMore()});return ba;},_updateMaxResults:function(){var x=o.getViewportDimensions().y,y=p.getTop()||42,z=56,aa=48;this.setMaxResults(Math.max(this._numResults.min,Math.min(this._numResults.max,Math.floor((x-y-aa-25)/z)-1)));},getCurQueryId:function(){return this._curQueryId;}});e.exports=w;});
__d("FacebarFragmentRenderer",["Badge","DOM"],function(a,b,c,d,e,f){var g=b('Badge'),h=b('DOM');function i(m,n,o){var p=m.structure.getFragment(n),q=null,r=m.bolding&&m.bolding[n];if(typeof r=="number"){q=[r,p.getLength()-r];}else if(r)q=r;var s=[p.getText()];if(m.verified)s.push(g('medium'));if(q&&q.length){return h.create('span',{},j(p.getText(),q,o));}else return h.create('span',{className:m.bolding&&o.unchanged||''},s);}function j(m,n,o){var p=[],q=false,r=0;n.forEach(function(s){var t=m.substr(r,s),u=q?o.changed:o.unchanged;if(s&&u){p.push(h.create('span',{className:u},t));}else p.push(t);r+=s;q=!q;});return p;}function k(m,n){var o={};m.forEach(function(p,q){if(p.type.lastIndexOf('ent:',0)===0)o[q]=l(n,p);});return o;}function l(m,n){var o=false,p=[];m.tokens.forEach(function(t){if(typeof t=='object'){if(t.uid==n.getUID())o=true;}else{p.push(t);if(t.length>2&&t.substr(t.length-2)=='\'s')p.push(t.substr(0,t.length-2));}});if(o)return;var q=n.getText().split(' '),r='',s=[];q.forEach(function(t,u){var v=0;p.forEach(function(w){if(w.length>v&&t.toLowerCase().indexOf(w)===0)v=w.length;});r+=t.substr(0,v);if(v!=t.length){s.push(r.length);s.push(t.length-v);r='';}if(u<q.length-1)r+=' ';});s.push(r.length);return s;}e.exports={renderFragment:i,computeEntBolding:k};});
__d("FacebarTypeaheadItem",["copyProperties","createArrayFrom","CSS","cx","DOM","FacebarFragmentRenderer","hasArrayNature","tx"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('createArrayFrom'),i=b('CSS'),j=b('cx'),k=b('DOM'),l=b('FacebarFragmentRenderer'),m=b('hasArrayNature'),n=b('tx'),o="_7gk",p="_53ad",q=l.renderFragment;function r(v){var w=v.getTypePart(0);return w?"fragment"+w.charAt(0).toUpperCase()+w.substr(1):"fragment";}function s(v,w){w.forEach(function(x){if(m(x)){s(v,x);}else if(x)v.push(x);});}function t(v,w){return k.create('span',{className:v},w);}function u(v){this._result=v;this._aux=null;this._debug=null;this._renderEducation=true;this._classes=(v.classNames||'').split(' ');this.addClass("_202");this._shouldVAlign=true;}g(u.prototype,{setVAlign:function(v){this._shouldVAlign=v;return this;},shouldVAlign:function(){return this._shouldVAlign;},addClass:function(v){this._classes.push(v);},setAux:function(v){this._aux=v;return this;},setShouldRenderEducation:function(v){this._renderEducation=v;return this;},setDebug:function(v){this._debug=v;return this;},cacheable:function(){return this._debug===null;},makeChildren:function(){var v=[];s(v,h(arguments));return v;},renderText:function(){return this._result.structure.toArray().map(function(v,w){var x=q(this._result,w,{});return i.addClass(x,r(v));}.bind(this));},renderAux:function(){return this._aux?[this._aux]:[];},renderSubtext:function(){return [];},renderIcon:function(){return [];},renderEduContent:function(){if(!this._renderEducation)return [];var v="Use {tab} key to select".split('{tab}'),w=k.create('span',{className:"_78d"},"Tab");return k.create('span',{className:"_6ji"},this.makeChildren(' '+v[0],w,v[1]));},render:function(){var v=this.renderAux(),w=this.renderIcon(),x=this.renderText(),y=this.renderEduContent(),z=this.renderSubtext(),aa=this._debug,ba=t(p,this.makeChildren(x,z));i.conditionClass(ba,"_55y-",this.shouldVAlign()&&z);var ca=t(o,this.makeChildren(ba,y)),da=k.create('a',{className:"_205",href:this._result.uri,rel:'ignore'},k.create('span',{className:"_6i1"},this.makeChildren(w,ca,aa))),ea=k.create('span',{className:"_6i2"},this.makeChildren(v,this._aux));if(w)this._classes.push("_6_k");var fa=k.create('li',{className:this._classes.join(' ')},[da,ea]);fa.setAttribute('aria-label',this._result.structure.toString());return fa;}});e.exports=u;});
__d("FacebarTypeaheadToken",["copyProperties","cx","DOM"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('cx'),i=b('DOM'),j=' '+'\u00B7'+' ',k="_53a9",l="_53aa",m="_53ab";function n(p,q){return i.create('span',{className:p},q);}function o(p,q){this._text=p;this._limit=null;this._innerClass=q?q:l;this._showLeadingMiddot=false;this._separateMainText=true;}g(o.prototype,{setLimit:function(p){this._limit=p;return this;},setLeadingMiddot:function(p){this._showLeadingMiddot=p;return this;},separateMainText:function(p){this._separateMainText=p;return this;},getText:function(){return this._text;},render:function(){var p=this.getText();if(p.length){if(this._showLeadingMiddot)p[0]=j+p[0];this._limit&&p.splice(this._limit);var q='';if(this._separateMainText){q=p.shift();p.unshift('');}var r=p.join(j),s=n(k,n(this._innerClass,[q,r.length?n(m,r):null]));return s;}}});e.exports=o;});
__d("FacebarTypeaheadEntityToken",["copyProperties","FacebarTypeaheadToken","Class","DOM","HTML"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('FacebarTypeaheadToken'),i=b('Class'),j=b('DOM'),k=b('HTML'),l='\u00B7';function m(n){this.parent.construct(this);this._entity=n;this._default={};}i.extend(m,h);g(m.prototype,{setDefaultText:function(n,o){this._default[n]=o;return this;},getText:function(){var n=[],o={},p=function(r){r=r.trim();if(!o[r]){n.push(r);o[r]=1;}},q=function(r){if(typeof r=='object')r=j.getText(k(r).getRootNode());r&&r.split(l).map(p);};q(this._entity.category||this._default[this._entity.type]);q(this._entity.subtext);return n;}});e.exports=m;});
__d("FacebarTypeaheadEntityItem",["Class","copyProperties","CSS","cx","DOM","FacebarTypeaheadItem","FacebarTypeaheadEntityToken","tx","TypeaheadFacepile"],function(a,b,c,d,e,f){var g=b('Class'),h=b('copyProperties'),i=b('CSS'),j=b('cx'),k=b('DOM'),l=b('FacebarTypeaheadItem'),m=b('FacebarTypeaheadEntityToken'),n=b('tx'),o=b('TypeaheadFacepile');function p(q){this.parent.construct(this,q);this.addClass("_20e");}g.extend(p,l);h(l.prototype,{renderSubtext:function(){return new m(this._result).setDefaultText('user',"Timeline").render();},renderIcon:function(){var q=this._result.photos||this._result.photo;if(!q)return null;if(q instanceof Array){q=o.render(q);i.addClass(q,"_51l_");return q;}else return k.create('img',{className:"_20h",alt:'',src:q});}});e.exports=p;});
__d("FacebarDisambiguationDialog",["Event","BrowseLogger","copyProperties","CSS","cx","Dialog","DOM","FacebarStructuredText","FacebarTypeaheadEntityItem","tx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('BrowseLogger'),i=b('copyProperties'),j=b('CSS'),k=b('cx'),l=b('Dialog'),m=b('DOM'),n=b('FacebarStructuredText'),o=b('FacebarTypeaheadEntityItem'),p=b('tx'),q=650;function r(s,t,u,v,w){this._sets=s;this._path=t;this._ondone=u;this._oncancel=v;this._selection=[];this._typeaheadSID=w;}i(r.prototype,{show:function(){new l().setTitle("Which of these did you mean?").setBody(this._createBody()).setContentWidth(q).setModal(true).setButtons([l.CONFIRM,l.CANCEL]).setHandler(this._handleDone.bind(this)).setCancelHandler(this._handleCancel.bind(this)).show();this._sets.forEach(function(s){var t=[];s.forEach(function(v){t.push(v.uid);});var u=s[0];h.logDisambiguationImpression(u.text,u.type,this._path,t.join(','),this._typeaheadSID);}.bind(this));},_createBody:function(){var s=[];this._sets.forEach(function(t,u){s.length&&s.push(m.create('li',{className:"_200"}));t.forEach(function(v){var w=this._createItem(v,u);this._selection[u]||this._selectItem(w);s.push(w.root);}.bind(this));}.bind(this));return m.create('ul',{className:'viewList disambiguationList'},s);},_createItem:function(s,t){var u={uri:null,subtext:s.subtext,category:s.category,photo:s.photo,type:s.type,structure:n.fromStruct([{text:s.text,type:'ent:'+s.type,uid:s.uid}])},v=m.create('div',{className:"_201"}),w=new o(u).setAux(j.hide(v)).setShouldRenderEducation(false).render(),x={setId:t,result:s,root:w,check:v};j.addClass(w,"_6i3");g.listen(w,'mouseover',this._toggleHover.bind(this,x,true));g.listen(w,'mouseout',this._toggleHover.bind(this,x,false));g.listen(w,'click',function(event){this._selectItem(x);return event.kill();}.bind(this));return x;},_toggleHover:function(s,t){j.conditionClass(s.root,'selected',t);},_toggleCheck:function(s,t){j.conditionShow(s.check,t);},_selectItem:function(s){var t=this._selection[s.setId];this._selection[s.setId]=s;t&&this._toggleCheck(t,false);this._toggleCheck(s,true);},_handleDone:function(s){this._ondone(s==l.CONFIRM?this._selection.map(function(t){var u=t.result;h.logDisambiguationClick(u.text,u.type,this._path,u.index,u.uid,this._typeaheadSID);return u;}.bind(this)):null);},_handleCancel:function(){this._oncancel();}});e.exports=r;});
__d("FacebarTypeahead",["Arbiter","Class","Typeahead","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Class'),i=b('Typeahead'),j=b('copyProperties'),k=b('emptyFunction');function l(m,n,o,p,q,r){this.parent.construct(this,m,n,o,p);this.getCore();this.proxyEvents();this.initBehaviors(q||[]);var s=this.core.subscribe('focus',function(){if(r)r.init(this);this.core.unsubscribe(s);this.data.bootstrap(false);this.core.input.focus();}.bind(this));this.data.bootstrap(true);this.inform('init',this,g.BEHAVIOR_PERSISTENT);g.inform('Facebar/init',this,g.BEHAVIOR_PERSISTENT);}h.extend(l,i);j(l.prototype,{init:k,proxyEvents:function(){var m,n=[],o=null,p=(function(){while(m=n.shift())this.inform(m[0],m[1]);o=null;}).bind(this);[this.data,this.view,this.core].forEach(function(q){q.subscribe(q.events,function(r,s){n.push([r,s]);o=o||p.defer();}.bind(this));},this);}});e.exports=l;});
__d("StructuredInputDOM",["createArrayFrom","CSS","cx","DOM"],function(a,b,c,d,e,f){var g=b('createArrayFrom'),h=b('CSS'),i=b('cx'),j=b('DOM'),k={ENTITY_CLASS:"_586o",encodeText:function(l){return l.replace(/ /g,'\u00a0');},decodeText:function(l){return l.replace(/\u00a0/g,' ');},createIconNode:function(l){if(l&&typeof l=='object'){var m=j.create('i',{className:l.className,style:l.uri&&{backgroundImage:'url("'+l.uri+'")'}});m.setAttribute('data-select','ignore');return m;}},createTextNode:function(l){return j.create('span',{'data-si':true},k.encodeText(l||""));},createEntityNode:function(l,m){var n=k.encodeText(l.text),o=k.createIconNode(m.icon),p=j.create('span',{},o?[o,n]:n),q=(m.className||'').split(/\s+/);q.push(k.ENTITY_CLASS);q.forEach(h.addClass.bind(h,p));var r={si:true,uid:l.uid,type:l.type,text:n,fulltext:n,group:m.group,select:m.select,icon:JSON.stringify(m.icon||null)};for(var s in r)if(r[s]!=null)p.setAttribute('data-'+s,r[s]);return p;},convertToTextNode:function(l){l.className='';l.setAttribute('data-type','text');l.removeAttribute('data-group');l.removeAttribute('data-select');l.removeAttribute('data-icon');l.removeAttribute('data-uid');for(var m=l.firstChild;m;m=m.nextSibling)if(!j.isTextNode(m))j.remove(m);},isEntityNode:function(l){return l&&h.hasClass(l,k.ENTITY_CLASS);},containsOnlyText:function(l,m){m=g(m);for(var n=l.firstChild;n;n=n.nextSibling)if(!(j.isTextNode(n)||l.nodeName in m))return false;return true;},getText:function(l){return j.getText(l).replace(/ /g,'\u00a0');},getDecodedText:function(l){return k.decodeText(j.getText(l));},getLength:function(l){return j.getText(l).length;},getMarker:function(l,m,n){var o=l.firstChild;while(o){var p=k.getLength(o);if(p>m||!o.nextSibling){if(j.isTextNode(o)||!n){return {node:o,offset:Math.min(m,p)};}else return k.getMarker(o,m);}else m-=p;o=o.nextSibling;}}};e.exports=k;});
__d("StructuredInputUtil",["StructuredInputDOM"],function(a,b,c,d,e,f){var g=b('StructuredInputDOM');function h(n,o,p){var q=n.substr(0,o).lastIndexOf(p);return q!==-1?q+1:0;}function i(n,o,p){var q=n.indexOf(p,o);return q!==-1?q:n.length;}function j(n,o,p){return (o===0||o===n.length||n.substr(o,p.length)==p);}function k(n,o,p,q){switch(o){case 'none':return p;case 'all':return q?n.length:0;case 'word':if(j(n,p,'\u00a0')){return p;}else if(q){return i(n,p,'\u00a0');}else return h(n,p,'\u00a0');}}function l(n,o){return o&&g.isEntityNode(n)&&!g.isEntityNode(o);}var m={getMarkerAtOffset:function(n,o){var p=n.firstChild,q=0,r=0;while(p){q+=r;r=g.getLength(p);if(q+r>o){break;}else p=p.nextSibling;}return {node:p||n.lastChild,offset:o-q};},validateEntityText:function(n){var o=g.getText(n),p=n.getAttribute('data-fulltext'),q=n.getAttribute('data-group'),r=o.indexOf(p),s={prefix:null,entity:null,suffix:null};switch(q){case 'none':s.entity=o;break;case 'all':if(r!=-1){s.prefix=o.substr(0,r);s.entity=o.substr(r,p.length);s.suffix=o.substr(r+p.length);}else s.suffix=o;break;case 'word':if(r!=-1){s.prefix=o.substr(0,r);o=o.substr(r);}var t=0,u=0;while(t<p.length){u=i(p,t+1,'\u00a0');if(o.substr(0,u)!=p.substr(0,u)){break;}else t=u;}s.entity=o.substr(0,t)||null;s.suffix=o.substr(t)||null;}return s;},getGrouping:function(n,o){var p=n.getAttribute('data-group'),q=n.getAttribute('data-select');if(o=='select'){return q=='group'?p:'none';}else return p;},snapMarkerToText:function(n,o){var p=n.node;if(g.isEntityNode(p)){var q=n.offset,r=m.getGrouping(p,o);if(r!='none')if(q===0){var s=p.previousSibling;if(l(p,s))return {node:s,offset:g.getLength(s)};}else if(q==g.getLength(p)){var t=p.nextSibling;if(l(p,t))return {node:t,offset:0};}}return n;},nextMarkerBoundary:function(n,o,p){var q=n.node;if(g.isEntityNode(q)){var r=m.getGrouping(q,p);if(r!='none')return {node:n.node,offset:k(g.getText(q),r,n.offset,o)};}return n;}};e.exports=m;});
__d("StructuredInputCleaner",["DOM","createArrayFrom","copyProperties","StructuredInputUtil","StructuredInputDOM","UserAgent"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('createArrayFrom'),i=b('copyProperties'),j=b('StructuredInputUtil'),k=b('StructuredInputDOM'),l=b('UserAgent');function m(n,o){this._node=n;this._wrapText=o;}i(m.prototype,{_cleanEntityNode:function(n){var o=n.getAttribute('data-text'),p=k.getText(n);n.style.cssText='';if(o==p&&k.containsOnlyText(n,{I:true}))return null;var q=[],r=j.validateEntityText(n),s=k.createIconNode(JSON.parse(n.getAttribute('data-icon')));if(!r.entity&&((r.suffix&&!r.prefix)||(r.prefix&&!r.suffix))){k.convertToTextNode(n);n.setAttribute('data-text',p);return null;}if(r.prefix)q.push(this._createTextNode(r.prefix));if(r.entity){g.setContent(n,s?[s,r.entity]:r.entity);n.setAttribute('data-text',r.entity);q.push(n);}if(r.suffix)q.push(this._createTextNode(r.suffix));return q;},_cleanTextNodes:(function(){var n=function(p){return (p.nodeName==='BR'||p.nodeName==='SPAN'&&o(p));},o=function(p){return p.getAttribute('data-si')&&k.containsOnlyText(p)&&k.getLength(p)>0;};return function(p){if(p.length!=1||!n(p[0])){var q=p.map(k.getText).join('');return q?[this._createTextNode(q)]:[];}else{p[0].style.cssText='';return;}};})(),_removeSpecialNodes:function(){var n=h(this._node.getElementsByTagName('script')),o=h(this._node.getElementsByTagName('style'));n.forEach(g.remove);o.forEach(g.remove);},_collapseNodes:function(){for(var n,o=this._node.firstChild;o;o=n){n=o.nextSibling;if(!g.isTextNode(o)&&!k.isEntityNode(o)&&!k.containsOnlyText(o))for(var p=o.lastChild;p;p=o.lastChild){this._node.insertBefore(p,n);n=p;}}},_createTextNode:function(n){if(this._wrapText){return k.createTextNode(n);}else return document.createTextNode(n);},replaceNodes:function(n,o){if(o==null)return;var p=n.length?n[n.length-1].nextSibling:null;n.forEach(g.remove);o.forEach(function(q){this._node.insertBefore(q,p);}.bind(this));},clean:function(){this._removeSpecialNodes();this._collapseNodes();var n=[],o=function(){if(n.length){this.replaceNodes(n,this._cleanTextNodes(n));n.length=0;}}.bind(this);h(this._node.childNodes).forEach(function(p){if(k.isEntityNode(p)){this.replaceNodes([p],this._cleanEntityNode(p));o(n);}else n.push(p);}.bind(this));o();if(!this._node.firstChild&&l.firefox())this._node.appendChild(this._createTextNode());},endOnText:function(){var n=function(o,p){if(k.isEntityNode(o))this._node.insertBefore(this._createTextNode(),p?o:null);}.bind(this);n(this._node.firstChild,true);n(this._node.lastChild,false);}});e.exports=m;});
__d("DOMSelection",[],function(a,b,c,d,e,f){(function(){var g=this,h={isPreceding:function(m,n){return n.compareDocumentPosition(m)&2;},contains:function(m,n){if(m.compareDocumentPosition!=null){return m.compareDocumentPosition(n)&16;}else return m.contains(n);},isCursorPreceding:function(m,n,o,p){if(m===o)return n<=p;if(h.isText(m)&&h.isText(o))return h.isPreceding(m,o);if(h.isText(m)&&!h.isText(o))return !h.isCursorPreceding(o,p,m,n);if(!h.contains(m,o))return h.isPreceding(m,o);if(m.childNodes.length<=n)return false;if(m.childNodes[n]===o)return 0<=p;return h.isPreceding(m.childNodes[n],o);},isText:function(m){return (m!=null?m.nodeType==3:false);},getChildIndex:function(m){var n=0;while(m=m.previousSibling)n++;return n;}},i=g.Selection=(function(){function m(n){this.win=n;}m.prototype.hasSelection=function(){return m.hasSelection(this.win);};m.prototype.isBidirectional=function(){return m.isBidirectional(this.win);};m.prototype.getOrigin=function(){return m.getOrigin(this.win);};m.prototype.getFocus=function(){return m.getFocus(this.win);};m.prototype.getStart=function(){return m.getStart(this.win);};m.prototype.getEnd=function(){return m.getEnd(this.win);};m.prototype.trySelection=function(n,o,p,q){return m.trySelection(this.win,n,o,p,q);};m.prototype.setSelection=function(n,o,p,q){return m.setSelection(this.win,n,o,p,q);};m.prototype.clearSelection=function(){return m.clearSelection(this.win);};return m;})();if(g.getSelection&&!g.document.selection){i.supported=true;i.hasSelection=function(m){var n;return (n=m.getSelection())&&(n.focusNode!=null)&&(n.anchorNode!=null);};i.isBidirectional=function(m){return true;};i.getOrigin=function(m){var n;if(!((n=m.getSelection())&&(n.anchorNode!=null)))return null;return [n.anchorNode,n.anchorOffset];};i.getFocus=function(m){var n;if(!((n=m.getSelection())&&(n.focusNode!=null)))return null;return [n.focusNode,n.focusOffset];};i.getStart=function(m){var n,o,p,q,r,s;if(!i.hasSelection(m))return null;r=i.getOrigin(m),n=r[0],p=r[1];s=i.getFocus(m),o=s[0],q=s[1];if(h.isCursorPreceding(n,p,o,q))return [n,p];return [o,q];};i.getEnd=function(m){var n,o,p,q,r,s;if(!i.hasSelection(m))return null;r=i.getOrigin(m),n=r[0],p=r[1];s=i.getFocus(m),o=s[0],q=s[1];if(h.isCursorPreceding(n,p,o,q))return [o,q];return [n,p];};var j=function(m,n,o,p,q,s){var t=n.getSelection();if(!t)return;if(q==null)q=o;if(s==null)s=p;if(t.collapse&&t.extend){t.collapse(o,p);t.extend(q,s);}else{r=n.document.createRange();r.setStart(o,p);r.setEnd(q,s);if(m||!i.hasSelection(n)||(r.endContainer===q&&r.endOffset===s&&r.startContainer===o&&r.startOffset===p)){try{t.removeAllRanges();}catch(u){}t.addRange(r);}}};i.setSelection=j.bind(i,true);i.trySelection=j.bind(i,false);i.clearSelection=function(m){try{var o=m.getSelection();if(!o)return;o.removeAllRanges();}catch(n){}};i.getText=function(m){var n=m.getSelection();if(!n)return;return n.toString();};}else if(g.document.selection){var k=function(m,n,o){var p,q,r,s,t;q=m.createElement('a');p=n.duplicate();p.collapse(o);t=p.parentElement();while(true){t.insertBefore(q,q.previousSibling);p.moveToElementText(q);if(!(p.compareEndPoints((o?'StartToStart':'StartToEnd'),n)>0&&(q.previousSibling!=null)))break;}if(p.compareEndPoints((o?'StartToStart':'StartToEnd'),n)===-1&&q.nextSibling){p.setEndPoint((o?'EndToStart':'EndToEnd'),n);r=q.nextSibling;s=p.text.length;}else{r=q.parentNode;s=h.getChildIndex(q);}q.parentNode.removeChild(q);return [r,s];},l=function(m,n,o,p,q){var r,s,t,u,v;v=0;r=h.isText(p)?p:p.childNodes[q];s=h.isText(p)?p.parentNode:p;if(h.isText(p))v=q;u=m.createElement('a');s.insertBefore(u,r||null);t=m.body.createTextRange();t.moveToElementText(u);u.parentNode.removeChild(u);n.setEndPoint((o?'StartToStart':'EndToEnd'),t);return n[o?'moveStart':'moveEnd']('character',v);};i.supported=true;i.hasSelection=function(m){var n;if(!m.document.selection)return false;n=m.document.selection.createRange();return n&&n.parentElement().document===m.document;};i.getStart=function(m){var n;if(!i.hasSelection(m))return null;n=m.document.selection.createRange();return k(m.document,n,true);};i.getEnd=function(m){var n;if(!i.hasSelection(m))return null;n=m.document.selection.createRange();return k(m.document,n,false);};i.isBidirectional=function(m){return false;};i.getOrigin=function(m){return i.getStart(m);};i.getFocus=function(m){return i.getEnd(m);};var j=function(m,n,o,p,q,r){if(q==null)q=o;if(r==null)r=p;var s=n.document.body.createTextRange();l(n.document,s,false,q,r);l(n.document,s,true,o,p);return s.select();};i.setSelection=j.bind(i,true);i.trySelection=j.bind(i,false);i.clearSelection=function(m){return m.document.selection.empty();};i.getText=function(m){if(!i.hasSelection(m))return null;var n=m.document.selection.createRange();return n&&n.text;};}else i.supported=false;}).call(this);e.exports=Selection;});
__d("StructuredInputSelection",["DOMSelection","Vector","copyProperties","StructuredInputUtil","StructuredInputDOM"],function(a,b,c,d,e,f){var g=b('DOMSelection'),h=b('Vector'),i=b('copyProperties'),j=b('StructuredInputUtil'),k=b('StructuredInputDOM');function l(n){var o=n.ownerDocument;this.window=o.defaultView||o.parentWindow;this.root=n;this.selection=false;this.start=new m(this,[]);this.end=new m(this,[]);this.update();}i(l.prototype,{isSupported:function(){return !!(g&&g.hasSelection);},update:function(){this.selection=false;if(this.isSupported()&&this.root==document.activeElement)if(g.hasSelection(this.window)){var n=g.getStart(this.window),o=g.getEnd(this.window),p=g.getFocus(this.window);this.start=this.makeMarker(n);this.end=this.makeMarker(o);this.backward=n[0]==p[0]&&n[1]==p[1];this.selection=this.start.node&&this.end.node;}},makeMarker:function(n){if(n[0]===this.root){return new m(this,[this.root.childNodes[n[1]],0]);}else return new m(this,n);},getFocus:function(){return this.backward?this.start:this.end;},getOrigin:function(){return this.backward?this.end:this.start;},move:function(n){if(this.selection){this.start.move(n);this.start.snap();this.end.setPosition(this.start);return this.apply();}},expand:function(n){if(this.selection){if(g.isBidirectional()){this.start.move(!n);this.start.snap();this.end.move(n);this.end.snap();}return this.apply();}},getText:function(){if(this.selection&&this.isSupported()){var n=g.getText(this.window);return n;}},getOffset:function(){if(this.selection)return this.start.rootOffset;},getLength:function(){return (this.getText()||"").length;},setPosition:function(n,o){this.backward=false;this.selection=true;this.start.setPosition(j.getMarkerAtOffset(this.root,n));this.start.snap();if(o>0){this.end.setPosition(j.getMarkerAtOffset(this.root,n+o));this.end.snap();}else this.end.setPosition(this.start);return this.apply();},hasRange:function(){return this.selection&&(this.start.node!=this.end.node||this.start.offset!=this.end.offset);},scrollToFocus:function(){var n=5,o=this.getFocus();if(o.node){var p=h.getElementDimensions(this.root).x,q=this.root.scrollLeft,r=o.node.offsetLeft+o.node.offsetWidth;if(r-q<n){this.root.scrollLeft=r-n;}else if(r-q>p-n)this.root.scrollLeft=r-p+n;}},apply:function(){if(this.start.hasChanged()||this.end.hasChanged()){var n=this.getOrigin().getMarker(true),o=this.getFocus().getMarker(true);this.selection=this.selection&&n&&n.node&&o&&o.node;if(this.selection&&this.isSupported()){this.start.changed=false;this.end.changed=false;g.trySelection(this.window,n.node,n.offset,o.node,o.offset);return true;}}}});function m(n,o){this.selection=n;this.node=o[0];this.offset=o[1];this.rootOffset=this.getRootOffset(o[0],o[1]);this.sibling=this.node&&this.node.previousSibling;this.changed=false;}i(m.prototype,{hasChanged:function(){return this.changed||!this.isNodeValid();},isNodeValid:function(){if(k.getLength(this.node)>this.offset){var n=this.node;while(n=n.parentNode)if(n==this.selection.root)return true;}},getMarker:function(n){if(this.isNodeValid()&&((n&&!this.node.firstChild)||(!n&&this.node.parentNode==this.selection.root))){return this;}else return k.getMarker(this.selection.root,this.rootOffset,n);},move:function(n){this.node&&this.setPosition(j.nextMarkerBoundary(this.getMarker(false),n,'select'));},snap:function(){this.node&&this.setPosition(j.snapMarkerToText(this.getMarker(false),'select'));},setPosition:function(n){if(n.offset!=this.offset||n.node!=this.node){this.changed=true;this.node=n.node;this.offset=n.offset;this.rootOffset=this.getRootOffset(this.node,this.offset);}},getRootOffset:function(n,o){var p=0,q=5;while(n&&p++<q)if(n===this.selection.root){return o;}else{var r=n;while(r=r.previousSibling)o+=k.getLength(r);n=n.parentNode;}}});e.exports=l;});
__d("StructuredInput",["Event","Arbiter","ArbiterMixin","CSS","cx","csx","DataStore","DOM","Input","InputSelection","Keys","Parent","requestAnimationFrame","StructuredInputCleaner","StructuredInputDOM","StructuredInputSelection","StructuredInputUtil","Style","UserAgent","copyProperties","createArrayFrom","createObjectFrom","emptyFunction"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('ArbiterMixin'),j=b('CSS'),k=b('cx'),l=b('csx'),m=b('DataStore'),n=b('DOM'),o=b('Input'),p=b('InputSelection'),q=b('Keys'),r=b('Parent'),s=b('requestAnimationFrame'),t=b('StructuredInputCleaner'),u=b('StructuredInputDOM'),v=b('StructuredInputSelection'),w=b('StructuredInputUtil'),x=b('Style'),y=b('UserAgent'),z=b('copyProperties'),aa=b('createArrayFrom'),ba=b('createObjectFrom'),ca=b('emptyFunction'),da=229,ea=ba([q.UP,q.DOWN,q.LEFT,q.RIGHT]),fa=ba([q.BACKSPACE,q.DELETE]),ga=ba([q.SPACE,q.RETURN]),ha=ba('IUB'.split('').map(function(ma){return ma.charCodeAt(0);})),ia=y.firefox(),ja=y.ie(),ka=y.webkit();function la(ma){m.set(ma,'StructuredInput',this);this._root=ma;this._richInput=n.find(ma,"._586i");this._textInput=n.find(ma,"._586f");this._placeholderText=n.scry(ma,"._586j")[0];this._hintText=n.find(ma,"._586k");this._contentWidth=null;this._richWidth=null;this._hintNodes=[];this.init();}la.getInstance=function(ma){var na=r.byClass(ma,"_586g");return na?m.get(na,'StructuredInput'):null;};z(la.prototype,i,{init:function(){this.init=ca;this._initSelection();this._initCleaner();this._initInputs();this._initEvents();this._scheduledCleanInput=false;this._richChanged=false;this._textChanged=false;this._selectionChanged=false;this._selectionIgnore=false;this._imeMode=false;this.cleanInput();this.inform('init',null,h.BEHAVIOR_PERSISTENT);},_initInputs:function(){this._richInput.contentEditable=true;this._richInput.spellcheck=false;this._richInput.tabIndex=0;this._textInput.tabIndex=-1;this._multiline=this._textInput.nodeName=='TEXTAREA';if(!j.shown(this._richInput)){var ma=p.get(this._textInput);n.setContent(this._richInput,u.encodeText(o.getValue(this._textInput)));j.hide(this._textInput);j.show(this._richInput);this.cleanInput();this.setSelection({offset:ma.start,length:ma.end-ma.start});}this.togglePlaceholder();this._toggleHint();},_initEvents:function(){var ma=null;g.listen(this._richInput,'keydown',function(na){ma=na.keyCode;if(na.ctrlKey&&na.keyCode in ha){return na.kill();}else if(na.keyCode in ea){this._selectionChanged=true;this.scheduleCleanInput(false);}else if(na.keyCode in fa){this._richChanged=true;this.scheduleCleanInput(true);if(na.keyCode===q.BACKSPACE)if(this._deleteTrailingChunk())return na.kill();}else if(na.keyCode==da){this._imeMode=true;j.hide(this._placeholderText);}}.bind(this));g.listen(this._richInput,'keyup',function(na){if((this._imeMode||na.keyCode!=ma)&&na.keyCode in ga){this._imeMode=false;this._richChanged=true;this.scheduleCleanInput();return na.kill();}else if(this._imeMode){this._textChanged=true;this.cleanInput();}}.bind(this));g.listen(this._richInput,'keypress',function(na){if(na.keyCode==q.RETURN){this._multiline&&this._insertText("\n");return na.kill();}else if(!this._selectionChanged&&this._selectionIsText()){this._textChanged=true;this.scheduleCleanInput(false);}else{this._richChanged=true;this.scheduleCleanInput(true);}}.bind(this));g.listen(document,'selectionchange',function(){if(this._selectionIgnore){this._selectionIgnore=false;}else this._selectionChanged=true;}.bind(this));g.listen(this._richInput,'mousedown',function(){this._selectionChanged=true;this._selectionLength=0;this._selectionOffset=0;}.bind(this));g.listen(this._richInput,'mouseup',function(){this._selectionChanged=true;s(this.cleanInput.bind(this));}.bind(this));g.listen(this._richInput,'cut',function(){this._richChanged=true;this.scheduleCleanInput(false);}.bind(this));g.listen(this._richInput,'paste',function(na){if(this._insertClipboard(na&&na.clipboardData||window.clipboardData)){return na.kill();}else{this._richChanged=true;this.scheduleCleanInput(true);}}.bind(this));g.listen(this._richInput,'drop',function(na){this.focus();this.selectAll();this._insertClipboard(na&&na.dataTransfer);return na.kill();}.bind(this));g.listen(this._richInput,'dragover',function(na){na.dataTransfer.dropEffect='move';na.dataTransfer.effectAllowed='move';return na.kill();});g.listen(this._richInput,'focus',function(na){this._toggleHint();this.inform('focus');}.bind(this));g.listen(this._richInput,'blur',function(na){j.hide(this._hintText);this._imeMode=false;this._richChanged=true;this.scheduleCleanInput(false);this.inform('blur');}.bind(this));},_initCleaner:function(){this._cleaner=new t(this._richInput,true);},_initSelection:function(){this._selection=new v(this._richInput);this._selectionLength=0;this._selectionOffset=0;},_insertClipboard:function(ma){if(ma&&ma.getData){if(!ma.types){this._insertText(ma.getData('Text'));}else if(ma.types.indexOf('text/html')!=-1){this._insertHTML(ma.getData('text/html'));}else if(ma.types.indexOf('text/plain')!=-1)this._insertText(ma.getData('text/plain'));return true;}else return false;},_deleteTrailingChunk:function(ma){var na=this.getSelection();if(na.length>0||na.offset===0)return false;var oa=this.getSelection().offset-1,pa=w.getMarkerAtOffset(this._richInput,oa);if(pa&&pa.node&&u.isEntityNode(pa.node)){n.remove(pa.node);return true;}return false;},_selectionIsText:function(){var ma=this._selection.start.node,na=this._selection.end.node;return ma&&ma===na&&!u.isEntityNode(ma)&&!u.isEntityNode(ma.parentNode);},_insertHTML:(function(){var ma=n.create('div'),na=new t(ma,false);return function(oa){if(oa){ma.innerHTML=oa;na.clean();return this._insertNodes(ma);}};})(),_insertText:function(ma){if(ma){var na=n.create('div',{},ma);return this._insertNodes(na);}},_insertNodes:function(ma){if(document.selection){document.selection.createRange().pasteHTML(ma.innerHTML);}else document.execCommand('insertHTML',false,ma.innerHTML);this._richChanged=true;this.cleanInput();},togglePlaceholder:function(ma){if(!this._placeholderText)return;var na=u.getLength(this._richInput)===0;if(ma&&na){j.show(this._placeholderText);}else j.conditionShow(this._placeholderText,na&&!this._imeMode);},_toggleHint:function(){var ma=aa(this._hintNodes),na=null,oa='',pa=u.getText(this._richInput).toLowerCase();if(!this.hasFocus())return;if(this._contentOverflows()){j.hide(this._hintText);return;}while(ma.length&&oa.length<pa.length){na=ma.shift();oa+=u.getText(na);}if(pa.length&&oa.substr(0,pa.length).toLowerCase()==pa.toLowerCase()){n.setContent(this._hintText,aa(this._richInput.cloneNode(true).childNodes));var qa=u.createTextNode(oa.substr(pa.length));ma.unshift(qa);n.appendContent(this._hintText,n.create('span',{className:"_586h"},ma));j.show(this._hintText);j.hide(this._placeholderText);}else j.hide(this._hintText);},_contentOverflows:function(){if(this._richWidth===null)this._richWidth=this._richInput.clientWidth;if(this._contentWidth===null){var ma=this._richInput.lastChild;this._contentWidth=n.isElementNode(ma)?ma.offsetLeft+ma.offsetWidth:0;}return this._contentWidth>this._richWidth;},_forceTop:function(){if(!this._multiline)this._richInput.scrollTop=0;this._root.scrollTop=0;},_createStructureNodes:function(ma){return ma.map(function(na){return na.uid||(na.type&&na.type!='text')?u.createEntityNode(na,na.display||{}):u.createTextNode(na.text);}.bind(this));},_suppressInput:function(){if(ia||ja){if(this._richClean)return;this._richClean=this._richInput.cloneNode(true);this._richClean.contentEditable=false;this._root.insertBefore(this._richClean,this._richInput.nextSibling);this._richClean.scrollLeft=this._richInput.scrollLeft;x.set(this._richInput,'padding',0);x.set(this._richInput,'height',0);}},_revealInput:function(){if(!this._richClean)return;x.set(this._richInput,'height','');x.set(this._richInput,'padding','');this._root.removeChild(this._richClean);this.focus();this._richClean=null;},_cleanInput:function(){var ma;if(this._textChanged&&!this._richChanged){this._selection.update();ma='change';}else if(this._richChanged||this._selectionChanged){this._selection.update();if(this._richChanged){this._contentWidth=null;this._cleaner.clean();this._cleaner.endOnText();this._selection.apply();ma='change';}if(this._selectionChanged){this._cleanSelection();if(this._selectionLength||!this._richChanged)ma='select';}}this._revealInput();this._forceTop();if(this._richChanged||this._textChanged){this.togglePlaceholder();this._toggleHint();}this._selectionIgnore=true;this._selectionChanged=false;this._richChanged=false;this._textChanged=false;ma&&this.inform(ma);},_cleanSelection:function(){var ma=this._selection.getLength(),na=this._selection.getOffset();if(ma){this._selection.expand(ma>=this._selectionLength);ma=this._selection.getLength();na=this._selection.getOffset();}this._selectionLength=ma;this._selectionOffset=na;},cleanInput:function(){this._scheduledCleanInput||this._cleanInput();},scheduleCleanInput:function(ma){ma&&this._suppressInput();if(!this._scheduledCleanInput){this._scheduledCleanInput=true;s(function(){this._cleanInput();this._scheduledCleanInput=false;}.bind(this));}},setEnabled:function(ma){this._textInput.disabled=!ma;this._richInput.contentEditable=ma;},getRoot:function(){return this._root;},getRichInput:function(){return this._richInput;},getEnabled:function(){return !this._textInput.disabled;},getText:function(){return u.getDecodedText(this._richInput);},setText:function(ma){n.setContent(this._richInput,u.createTextNode(ma));this._richChanged=false;this._selectionChanged=false;this.inform('change');},setHint:function(ma){this._hintNodes=this._createStructureNodes(ma);this._toggleHint();},getStructure:function(){var ma=[];aa(this._richInput.childNodes).forEach(function(na){var oa=!n.isTextNode(na),pa=u.getDecodedText(na);pa.length&&ma.push({text:pa,uid:oa?na.getAttribute('data-uid'):null,type:(oa&&na.getAttribute('data-type'))||'text'});}.bind(this));return ma;},setStructure:function(ma){n.setContent(this._richInput,this._createStructureNodes(ma));this._cleaner.endOnText();this._cleaner.clean();this.togglePlaceholder();this._toggleHint();this._richChanged=false;this._selectionChanged=false;this.inform('change');},getContentDimensions:function(){var ma=this._richInput.lastChild;return {width:ma?ma.offsetLeft+ma.offsetWidth:0,height:ma?ma.offsetTop+ma.offsetHeight:0};},getSelection:function(){return {offset:this._selection.getOffset(),length:this._selection.getLength()};},setSelection:function(ma){if(this.hasFocus()){this._selection.update();this._selection.setPosition(ma.offset,ma.length);this._selection.scrollToFocus();this._selectionChanged=false;this.inform('select');}},moveSelectionToEnd:function(){this.setSelection({length:0,offset:u.getLength(this._richInput)});},isSelectionAtEnd:function(){var ma=this.getSelection().offset,na=u.getLength(this._richInput);return ma>=na;},selectAll:function(){this.setSelection({offset:0,length:u.getLength(this._richInput)});},hasFocus:function(){return n.contains(this._root,document.activeElement);},focus:function(){this._richInput.focus();},blur:function(){var ma=n.create('input',{type:'text',tabIndex:-1,style:{position:'absolute',top:0,left:'-100px',width:'1px',height:'1px'}});n.appendContent(this._root,ma);var na=function(){if(this.hasFocus()||(ka&&document.activeElement===document.body)){ma.focus();ma.blur();}};this.blur=na;this.blur();}});e.exports=la;});
__d("FacebarTypeaheadInput",["ArbiterMixin","csx","DOM","FacebarStructuredText","StructuredInput","Vector","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('csx'),i=b('DOM'),j=b('FacebarStructuredText'),k=b('StructuredInput'),l=b('Vector'),m=b('copyProperties'),n={text:{className:"text",group:"all",select:"none"},grammar:{className:"grammar",group:"all",select:"none"},ent:{className:"entity",group:"all",select:"group"}};function o(q){return m(q.toStruct(),{display:n[q.getTypePart(0)]||{}});}function p(q){this.root=q;this.input=k.getInstance(q);this.value=null;this.selection={offset:0,length:0};this.resetOnChange=true;this.initEvents();}m(p.prototype,g,{events:['change','focus','blur'],initEvents:function(){var q=function(r,s){this.inform(r,s);}.bind(this);this.input.subscribe('blur',q);this.input.subscribe('focus',q);this.input.subscribe('change',function(r,s){if(this.resetOnChange)this.value=null;this.inform('change',s);}.bind(this));},togglePlaceholder:function(q){return this.input.togglePlaceholder(q);},focus:function(){this.input.focus();},blur:function(){this.input.blur();},getElement:function(){return this.root;},getRawPlaceholderElement:function(){return i.find(this.root,"._586j");},getRawInputElement:function(){return i.scry(this.root,"._586i")[0];},getValue:function(){if(this.value===null)this.value=j.fromStruct(this.input.getStructure());return this.value;},getLength:function(){return this.getValue().getLength();},resetPlaceholder:function(){this.input.resetPlaceholder();},setValue:function(q){q.pad();this.value=q;this.resetOnChange=false;var r=q.toArray().map(o);this.input.setStructure(r);this.input.setSelection({offset:q.getLength(),length:0});this.resetOnChange=true;},storeSelection:function(){this.selection=this.input.getSelection();},restoreSelection:function(){this.input.setSelection(this.selection);},setHint:function(q){var r=q?q.toArray().map(o):[];this.input.setHint(r);},isSelectionAtEnd:function(){return this.input.isSelectionAtEnd();},selectInput:function(q){this.input.setSelection({offset:q||0,length:this.getLength()});},getEndOffset:function(){var q=l.getElementDimensions(this.root),r=this.input.getContentDimensions();return Math.min(q.x,r.width);}});e.exports=p;});
__d("FacebarTypeaheadWebSearch",["startsWith","copyProperties","FacebarStructuredFragment","FacebarStructuredText"],function(a,b,c,d,e,f){var g=b('startsWith'),h=b('copyProperties'),i=b('FacebarStructuredFragment'),j=b('FacebarStructuredText'),k=new i({type:'ent:websuggestion',text:'Web Search: ',uid:null}),l=k.getText().toLowerCase().trim();function m(p,q){if(!p||p.type!=='websuggestion')return;var r=q.getValue().toArray();r.forEach(function(s){if(s.isType('ent')&&!s.isType('ent','user')&&s.getUID())if(p.extra_uri_params){p.extra_uri_params.qh=s.getUID();return;}});}function n(p){return p.getType()===k.getType();}function o(p){this._core=p.getCore();this._view=p.getView();this._input=this._core.input;this._isEnabled=false;}h(o,{addPrefix:function(p){if(!n(p.getFragment(0))){var q=[k].concat(p.toArray());return new j(q);}else return p;}});h(o.prototype,{enable:function(){this._isEnabled=true;this.changeListener=this._input.subscribe('change',this._changeWebSearch.bind(this));this.lockListener=this._input.subscribe('shortcut',this._lockWebSearch.bind(this));this.beforeSelectListener=this._view.subscribe('beforeSelect',this._beforeSelect.bind(this));this.beforeRenderListener=this._view.subscribe('beforeRender',this._beforeRender.bind(this));},_changeWebSearch:function(){var p=this._input.getValue(),q=p.toArray(),r=q[0];if(r&&r.getType()==='text')if(g(r.getText().toLowerCase(),l)){q.splice(0,1,k,new i({text:r.getText().substr(l.length).replace(/^ /,'')}));this._replaceFragments(q);}else if(q.length>1&&q.some(n))this._replaceFragments([new i({text:p.toString()})]);},_replaceFragments:function(p){this._input.storeSelection();this._input.setValue(new j(p));this._input.restoreSelection();},_beforeSelect:function(p,q){m(q.selected,this._input);return true;},_beforeRender:function(p,q){var r=this._input.getValue().toArray()[0],s=r&&n(r);q.results.forEach(function(t){if(t.type==='websuggestion')t.isLockedWebSearchMode=s;});return true;},_lockWebSearch:function(p,q){if(q.shift){var r=this._input.getValue().toArray()[0];if(!r||!n(r))this._input.setValue(new j([k]));}},disable:function(){this.beforeSelectListener.unsubscribe();this.changeListener.unsubscribe();this.lockListener.unsubscribe();this.beforeRenderListener.unsubscribe();this._isEnabled=false;}});e.exports=o;});
__d("FacebarTypeaheadCore",["Event","Arbiter","ArbiterMixin","Animation","arrayContains","Base64","copyProperties","csx","CSS","DOM","FacebarStructuredText","FacebarTypeaheadInput","FacebarTypeaheadWebSearch","invariant","Keys","startsWith","Style","URI"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('ArbiterMixin'),j=b('Animation'),k=b('arrayContains'),l=b('Base64'),m=b('copyProperties'),n=b('csx'),o=b('CSS'),p=b('DOM'),q=b('FacebarStructuredText'),r=b('FacebarTypeaheadInput'),s=b('FacebarTypeaheadWebSearch'),t=b('invariant'),u=b('Keys'),v=b('startsWith'),w=b('Style'),x=b('URI');function y(z){m(this,z);}m(y.prototype,i,{events:['session','focus','select','change','execute','blur'],dataSourceReady:false,init:function(z,aa,ba){this.init=function(){};this.data=z;this.view=aa;this.root=ba;this.windowFocused=true;this.isFocused=false;this.keepOpen=false;this.hoverAnimation=null;this.stickyQuery=null;this.settedQuery=null;this.selectedQuery=null;this.currentQuery=null;this._prefillTextInInputField=this.data.allowGrammar();this._webSearchLockedInMode=this.data.isWebSearchLockedInModeEnabled();this.initSubcomponents();this.initEvents();this.checkValue();},initSubcomponents:function(){var z=p.find(this.root,"._5861");this.input=new r(z);this.view.setInputElement(this.input.getRawInputElement());},initEvents:function(){g.listen(this.root,'keydown',this.keydown.bind(this));g.listen(this.root.parentNode,'mousedown',this.mousedown.bind(this));g.listen(this.view.getElement(),'mousedown',this.mousedown.bind(this));g.listen(document.body,'mouseup',this.mouseup.bind(this));g.listen(window,'focus',this.focusWindow.bind(this));g.listen(window,'blur',this.blurWindow.bind(this));this.view.subscribe('select',this.selectView.bind(this));this.view.subscribe('highlight',this.highlightView.bind(this));this.view.subscribe('render',this.highlightView.bind(this));this.view.subscribe('hideHelp',this.performQuery.bind(this));this.input.subscribe('focus',this.focusInput.bind(this));this.input.subscribe('blur',this.blurInput.bind(this));this.input.subscribe('change',this.changeInput.bind(this));this.data.subscribe('activity',this.typeaheadActivity.bind(this));this.data.subscribe('respond',this.completeData.bind(this));this.data.subscribe('ready',this.typeaheadReady.bind(this));if(p.contains(this.input.root,document.activeElement)){this.isFocused=true;this._newSession();this.open();}},cleanQuery:function(z){z=m({},z)||{};if(!z.structure)z.structure=new q();if(!this._prefillTextInInputField)z.structure=q.fromString(z.structure.toString());t(z.structure instanceof q);if(z.type=='websuggestion'&&this._prefillTextInInputField&&this._webSearchLockedInMode)z.structure=s.addPrefix(z.structure);return z;},setPageQuery:function(z){z=this.cleanQuery(z);var aa=this.input.getValue(),ba=z.structure,ca=!ba.isEmptyOrWhitespace()&&(aa.isEmptyOrWhitespace()||aa.toString().trim()==ba.toString().trim());return this.selectQuery(z,ca);},selectQuery:function(z,aa){aa=aa!==false;z=this.cleanQuery(z);if(aa||!this.selectedQuery){if(aa||this.getValue().isEmptyOrWhitespace())this.setQuery(z);this.selectedQuery=z;}return z;},completeSelection:function(){var z=this.view.getSelection();if(z&&z.type==='somethingnew_mystery'){return true;}else if(z&&!z.search){this.data.saveResult(z);this.setQuery(z);return true;}},setQuery:function(z,aa){z=this.cleanQuery(z);this.input.setValue(z.structure);this.settedQuery=z;this.stickyQuery=aa===false?this.stickyQuery:z;this.checkValue();},checkValue:function(){if(!this.view.visible||!this.dataSourceReady||(this.value&&this.value.getHash()==this.input.getValue().getHash()))return;this.value=this.nextQuery=this.getValue();this.performQuery();},performQuery:function(){this.data.query(this.nextQuery);this.currentQuery=this.nextQuery;},expandView:function(){this.data.query(this.currentQuery,false,[],true);this.input.restoreSelection();},collapseView:function(){this.requery();},requery:function(){if(this.currentQuery)this.data.query(this.currentQuery);},executeQuery:function(z){z=this.cleanQuery(z);var aa=this.inform('execute',z),ba=this.getSessionID();this.inform('session',null,h.BEHAVIOR_STATE);this.close();if(this._prefillTextInInputField){this.selectQuery(z);}else this.selectQuery();if(!aa)this._navigateToQuery(z,ba);},getSearchType:function(){return 'facebar';},_newSession:function(){this._sessionID=Math.random().toString();this.inform('session',this._sessionID,h.BEHAVIOR_STATE);},getSessionID:function(){return this._sessionID;},_navigateToQuery:function(z,aa){var ba=this.data.facebarConfig;if(z.uri){z.uri.addQueryData(z.extra_uri_params);z.uri.addQueryData({ref:'br_tf'});if(z.structure&&(z.type=='websuggestion'||(z.type=='grammar'&&(!ba||v(z.uri.getPath(),ba.search_path))))){var ca=this.data.getRawStructure(z.structure).text_form,da=l.encode(ca).replace(/\=+$/,''),ea={sid:aa,qs:da,gv:this.data.getQueryData().grammar_version},fa=l.encode(JSON.stringify(ea)).replace(/\=+$/,'');z.uri.addQueryData({ref:fa});}if(v(z.type,'somethingnew'))this.data.refetchNullState();z.uri.go();return;}},reset:function(){this.selectQuery();this.inform('reset');},animateInputValue:function(z,aa,ba){this.hoverAnimation&&this.hoverAnimation.stop();var ca=new j(aa).from('opacity',1).to('opacity',0).duration(150).ondone(function(){this.input.setValue(ba);this.hoverAnimation=da.go();}.bind(this)),da=new j(z).from('opacity',0).to('opacity',1).duration(150).ondone(function(){this.hoverAnimation=null;w.set(aa,'opacity','');w.set(z,'opacity','');}.bind(this));w.set(z,'opacity',0);this.hoverAnimation=ca.go();},open:function(){o.addClass(document.body,'facebarOpened');this.inform('open');this.view.show();this.input.focus();this.checkValue();if(!this.isFocused){this.isFocused=true;this._newSession();this.inform('focus');}},close:function(){if(this.inform('close')===false)return;if((!this.value||this.value.isEmptyOrWhitespace())&&this.selectedQuery){this.input.setValue(this.selectedQuery.structure);}else if(this.stickyQuery)this.input.setValue(this.stickyQuery.structure);this.input.blur();this.view.hide();this.view.setAutoSelect(false);this.inform('session',null,h.BEHAVIOR_STATE);if(this.isFocused){o.addClass(document.body,'facebarClosing');o.removeClass(document.body,'facebarOpened');o.removeClass.curry(document.body,'facebarClosing').defer(355);this.isFocused=false;this.inform.bind(this,'blur').defer();}},getElement:function(){return this.root;},getValue:function(){return this.input.getValue();},getText:function(){return this.getValue().toString();},keydown:function(event){var z=true,aa=g.getKeyCode(event);switch(aa){case u.ESC:this.close();break;case u.RIGHT:z=this.input.isSelectionAtEnd()&&this.completeSelection();break;case u.TAB:if(event.getModifiers().shift||(!this.completeSelection()&&!this.loading)){this.view.setAutoSelect(false);this.view.hide();z=false;}break;case u.UP:this.view.prev();break;case u.DOWN:this.view.next();break;case u.RETURN:this.view.select();break;case u.PAGE_UP:this.view.first();break;default:if(aa>='0'.charCodeAt(0)&&aa<='z'.charCodeAt(0))this.view.setAutoSelect(true);this.stickyQuery=null;z=false;break;}this.input.storeSelection();if(z)return event.kill();},mousedown:function(){this.view.setAutoSelect(true);this.input.storeSelection();this.keepOpen=true;},mouseup:function(z){if(this.keepOpen)this.open();this.keepOpen=false;},focusWindow:function(){this.windowFocused=true;},blurWindow:function(){this.windowFocused=false;},selectView:function(z,aa){if(!aa||!aa.selected)return;aa.selected.see_more=this.data.isSeeMore();this.inform('select',aa);var ba=this.cleanQuery(aa.selected);this.executeQuery(ba);},highlightView:function(){var z=this.view.getSelection();z&&this.input.setHint(z.structure);},blurInput:function(){setTimeout((function(){if(this.windowFocused||x.getRequestURI().getSubdomain()=='apps'){this.input.togglePlaceholder();if(!this.keepOpen)this.close();}}).bind(this),0);},changeInput:function(){this.inform('change');this.checkValue();this.inform('change_end');},focusInput:function(){this.open();this.input.togglePlaceholder(false);},typeaheadReady:function(){this.dataSourceReady=true;this.checkValue();},updateData:function(){this.view.setLoading(this.loading);},completeData:function(z,aa){if(aa.forceDisplay||(this.value&&this.value.matches(aa.value)))this.view.render(aa.value,aa.results,aa.isAsync,(aa.results.length===0)&&aa.isEmptyResults,aa.isScrollable);},typeaheadActivity:function(z,aa){this.fetching=aa.activity;if(this.loading!=this.fetching){this.loading=this.fetching;this.updateData();}},getNameTextFromSelected:function(){var z=this.settedQuery&&this.settedQuery.semantic,aa=this.data.facebarConfig&&this.data.facebarConfig.name_functions,ba=z&&aa&&z.match(/[a-z-]+\([^()]+\)/g);if(ba)for(var ca=0;ca<ba.length;ca++){var da=ba[ca].match(/([a-z-]+)\(([^()]+)\)/);if(da&&k(aa,da[1]))return da[2];}return this.value.toString();}});e.exports=y;});
__d("FacebarTypeaheadRecorder",["Class","clickRefAction","copyProperties","Env","Event","Keys","ScubaSample","SearchTypeaheadRecorder","URI","userAction","Arbiter"],function(a,b,c,d,e,f){var g=b('Class'),h=b('clickRefAction'),i=b('copyProperties'),j=b('Env'),k=b('Event'),l=b('Keys'),m=b('ScubaSample'),n=b('SearchTypeaheadRecorder'),o=b('URI'),p=b('userAction'),q=b('Arbiter'),r=function(s){this.typeahead=s;this.parent.construct(this,s);this.userText="";this.queryTimes=[];this._sessionDisabled=false;};g.extend(r,n);i(r.prototype,{_endPoint:'/ajax/typeahead/search/record_metrics.php',_sessionEnded:true,_extraRecorder:[],_banzaiRoute:'facebar',initEvents:function(){this.typeahead.getCore().subscribe('session',function(s,t){if(t===null){this.sessionEnd();}else this.sessionStart(t);}.bind(this));this.typeahead.getCore().subscribe('select',function(s,t){this.recordSelectInfo(t);}.bind(this));this.typeahead.getCore().input.subscribe('shortcut',function(s,t){this.recordShortcut(t);}.bind(this));this.typeahead.getCore().subscribe('quickSelectRedirect',function(s,t){this.recordQuickSelectInfo(t);}.bind(this));this.typeahead.getView().subscribe('render',function(s,t){this.recordRender(t);}.bind(this));this.typeahead.data.subscribe('query',function(s,t){if(!t.value.isEmpty())this.recordCountStat('num_queries');if(t.see_more)this.recordStat('clicked_see_more',1);this.recordAvgStat('num_results_from_cache',t.results.length);this.queryTimes[t.queryId-this.startQueryId]={send:Date.now()};}.bind(this));this.typeahead.subscribe('navigation',function(s,t){if(t&&t.structure){this.recordStat('navigation_input',JSON.stringify(t.structure.toStruct()));this.recordStat('navigation_text',t.structure.toString());}}.bind(this));this.typeahead.data.subscribe('response_received',function(s,t,u){if(t.queryId>=this.startQueryId){var v=this.queryTimes[t.queryId-this.startQueryId];v.recv=Date.now()-v.send;}}.bind(this));this.typeahead.data.subscribe('backend_response',function(s,t){if(t.queryId>=this.startQueryId){var u=this.queryTimes[t.queryId-this.startQueryId];u.render=Date.now()-u.send;if(t.payload.incomplete)u.incomplete=true;u.backendInfo=t.payload.info;if(this.core.scubaInfo)this.logToScuba(t,u,this.core.scubaInfo);}}.bind(this));q.subscribe('BrowseNUX/typing',this.disableThisSession.bind(this));this.typeahead.getCore().subscribe('change',function(s,t){this.userInput(this.core.getText());}.bind(this));this.typeahead.subscribe('clear',function(){this.recordAppendStat('before_clear_queries',this.userText);}.bind(this));k.listen(this.element,'keydown',function(event){this.recordStat('keypressed',1);if(k.getKeyCode(event)==l.BACKSPACE){if(!this._backspacing){this._backspacing=true;this.recordAppendStat('before_backspace_queries',this.userText);}}else this._backspacing=false;}.bind(this));this.typeahead.subscribe('record_after_reorder',function(s,t){this._reorderInfo=t;this._reorderInfo.s_organic_results=this._reorderInfo.s_organic_results.map(this.buildTypeaheadRecord.bind(this));}.bind(this));this.typeahead.subscribe('filter',function(s,t){this._unsupportedGrammarInfo=this.buildUnsupportedGrammarInfo(t);}.bind(this));this.typeahead.getCore().subscribe('recordFunction',function(s,t){this._extraRecorder.push(t);}.bind(this));},_reset:function(s){this.stats={};this.avgStats={};this.appendStats={};this._backspacing=false;this._topreplace=false;this._inflightRequests={};},sessionStart:function(s){this._sessionEnded=false;this.data.setQueryData({sid:s});this.recordStat('sid',s);if(!this.stats.session_start_time)this.recordStat('session_start_time',Date.now());this.startQueryId=this.data.getCurQueryId()+1;this.recordStat('keypressed',0);this.queryTimes=[];},sessionEnd:function(){if(this._sessionEnded||this._sessionDisabled){if(this._sessionDisabled){this.reset();this._sessionDisabled=false;this._sessionEnded=true;}return;}this._sessionEnded=true;this.recordStat('session_end_time',Date.now());this.recordStat('grammar_version',this.data.getQueryData().grammar_version);this.submit();},disableThisSession:function(){this._sessionDisabled=true;},userInput:function(s){this.userText=s;},buildUnsupportedGrammarInfo:function(s){var t=s.results?s.results[0]:null;if(!t||t.results_set_type!=='unimplemented')return null;return {unsupported_grammar:{category:t.error_info.category||'unknown',edge:t.error_info.blamed_edge}};},buildTypeaheadRecord:function(s,t){var u=s.rankType||s.render_type||s.type,v=0,w=t;if(typeof s.groupIndex=='number'){v=s.groupIndex;w=s.indexInGroup;}var x={group_index:v,index_in_group:w,cost:s.cost,s_value:s.s_value||0,semantic:s.semantic,text:s.structure.toString(),cache_only:(s.cacheOnlyResult?1:0),parse:s.parse,semantic_forest:s.semanticForest,normalized_input:s.entityTypes,category:s.category,type:u,source:s.bootstrapped,grammar_results_type:(s.results_set_type||'').replace(/[\[\{](.*)[\]\}]/,'$1'),result_from_memcache:s.memcache,websuggestion_source:s.websuggestion_source,dynamic_cost:s.dynamic_cost};if(s.logInfo)x.backend_log_info=s.logInfo;if(s.s_token)x.s_token=s.s_token;if(s.s_categories)x.s_categories=s.s_categories;return x;},buildListTypeaheadRecords:function(){var s=[];this.results&&this.results.forEach(function(t,u){if(t.uid!=='search')s.push(this.buildTypeaheadRecord(t,u));}.bind(this));return s;},recordShortcut:function(s){this.recordStat('shortcut',1);this.recordStat('shortcut_with_shift',s.shift);},recordStats:function(s,t){for(var u in t)this.recordStat(s+'_'+u,t[u]);},getTypeaheadIndex:function(s,t){var u=typeof s.groupIndex=='number'?s.groupIndex+1:0;return t-u;},recordQuickSelectInfo:function(s){var t={input_query:s.input_query,semantic:s.semantic,type:s.type,position:s.position,with_mouse:s.with_mouse,text:s.text};this.recordStats('selected',t);},recordSelectInfo:function(s){var t=s.selected,u=this.getTypeaheadIndex(t,s.index),v={};if(t.uid=='search'){v.selected_search=1;}else{v=this.buildTypeaheadRecord(t);var w=(v.type=='friend'?'user':v.type);v.position=u;v[w]=1;}v.with_mouse=s.clicked?1:0;v.see_more=t.see_more?1:0;v.input_query=this.userText;v.input_fragments=JSON.stringify(this.core.currentQuery.toStruct());var x=t.dataGT?{gt:JSON.parse(t.dataGT)}:{},y={href:t.path};h('click',y,null,null,x);p('search').uai('click');this.recordStats('selected',v);this.recordAppendStat('selection_history',{selected:v,candidate_results:this.buildListTypeaheadRecords(),timestamp:Date.now()});var z={};this._extraRecorder.forEach(function(aa){aa(s,this.results,z);}.bind(this));this.recordStat('extra_select_info',JSON.stringify(z));this.recordStat('selected_with_mouse',s.clicked?1:0);},_dataToSubmit:function(){this.recordStat('max_results',this.data._maxResults);if(this.stats&&this.stats.selected_input_query){this.recordStat('input_query',this.stats.selected_input_query);}else this.recordStat('input_query',this.userText);this.recordStat('uri',o().toString());if(!this.stats.shortcut){this.recordStat('shortcut',0);this.recordStat('shortcut_with_shift',false);}var s=this.stats;for(var t in this.avgStats){var u=this.avgStats[t];s[t]=u[0]/u[1];}var v={candidate_results:this.buildListTypeaheadRecords(),timestamp:Date.now(),input_query:this.userText};if(this._reorderInfo)i(v,this._reorderInfo);if(this._unsupportedGrammarInfo)i(v,this._unsupportedGrammarInfo);this.recordAppendStat('suggestions_at_end_of_session',v);this.recordAppendStat('query_times',this.queryTimes);for(var w in this.appendStats)s[w]=JSON.stringify(this.appendStats[w]);return s;},getDataToSubmit:function(){return this._dataToSubmit();},reset:function(){return this._reset();},submit:function(){if(!this._sessionDisabled)this.parent.submit();this.view.inform('feedback');this._reset();},logToScuba:function(s,t,u){if(this._sessionDisabled)return;var v=new m('search_facebar_js',null,{addBrowserFields:true});v.addInteger('sample_rate',u.sample_rate);v.addNormal('site',u.site);v.addDenorm('query',s.request.uri.query_s);var w=s.payload;w.entities&&v.addInteger('num_entities',w.entities.length);w.results&&v.addInteger('num_results',w.results.length);if(w.times){v.addInteger('time_bootstrap',w.times.bootstrap);v.addInteger('time_php_end_to_end',w.times.end_to_end);v.addInteger('time_fetchers',w.times.fetchers);v.addInteger('time_grammar',w.times.grammar);}v.addInteger('incomplete',t.incomplete?1:0);v.addInteger('time_render',t.render-t.recv);v.addInteger('time_js_async',t.recv);v.addInteger('query_id',t.queryId);v.addInteger('user_id',j.user);v.addInteger('session_id',this.typeahead.getCore().getSessionID());v.flush();}});e.exports=r;});
__d("FacebarTypeaheadView",["Event","Animation","Arbiter","Class","copyProperties","ContextualLayer","CSS","csx","cx","DOM","Ease","Parent","ScrollableArea","Style","TypeaheadView","throttle","tx","Vector","ViewportBounds","FacebarStructuredText"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Animation'),i=b('Arbiter'),j=b('Class'),k=b('copyProperties'),l=b('ContextualLayer'),m=b('CSS'),n=b('csx'),o=b('cx'),p=b('DOM'),q=b('Ease'),r=b('Parent'),s=b('ScrollableArea'),t=b('Style'),u=b('TypeaheadView'),v=b('throttle'),w=b('tx'),x=b('Vector'),y=b('ViewportBounds'),z=b('FacebarStructuredText'),aa=981,ba=500,ca='unimplemented';function da(ea,fa){this.parent.construct(this,ea,fa);this.sid='';this.index=-1;this.animation=null;this.warningShown=false;this.autoSelect=false;this.minResults=fa.minResults||3;this.maxResults=fa.maxResults;this.animateHeightThrottled=v(this.animateHeight,50,this);this.animateCount=-1;this.animateWidth=-1;this.loading=false;}j.extend(da,u);k(da.prototype,{events:['highlight','render','filter'],init:function(){this.initializeElements();this.parent.init();},initializeElements:function(){var ea=this.element;this.content=p.find(ea,"._21r");this.throbber=p.find(ea,"._21f");this.warningNode=p.find(ea,"._553e");this.scroller=p.find(ea,"._8v2");this.scrollableArea=s.getInstance(this.scroller);this.footer=this.createFooter();},initializeLayer:function(){var ea=p.scry(document.body,'#blueBar')[0],fa,ga,ha;if(ea&&p.contains(ea,this.element)){fa=ea;ha="_53df";ga='100%';}else{fa=this.element.parentNode;ha='';ga=aa+'px';}this.wrapper=p.create('div');p.appendContent(this.wrapper,this.element);this.layer=new l({context:fa,position:'below',alignment:this.alignment,causalElement:this.causalElement},this.wrapper);m.addClass(this.layer.getRoot(),ha);t.set(this.layer.getContentRoot(),'width',ga);},initializeEvents:function(){g.listen(this.content,{click:this.click.bind(this),mouseover:this.mouseover.bind(this)});},setInputElement:function(ea){this.setAccessibilityControlElement(ea);this.causalElement=ea;this.initializeLayer();},setAutoSelect:function(ea){this.autoSelect=ea;if(this.index===-1&&ea)this.first();},click:function(event){if(!event.isMiddleClick()&&!event.getModifiers().any){var ea=r.byTag(event.getTarget(),'a');if(!ea||m.hasClass(ea,"_205")){this.select(true);return event.kill();}}},show:function(){if(!this.visible){var ea=this.parent.show();this.first();this.layer.show();this.layer.updatePosition();this.recalculateScrollableArea();this.animateCount=-1;this.animateHeight();this.inform('show');i.inform('layer_shown',{type:'FacebarTypeahead'});return ea;}},hide:function(){if(this.visible){this.layer.hide();this.parent.hide();t.set(this.scroller,'height','0px');this.inform('hide');i.inform('layer_hidden',{type:'FacebarTypeahead'});}return this;},select:function(ea){var fa=this.results[this.index];if(!fa){this.inform('quickSelect');return;}var ga=this.inform('beforeSelect',{index:this.index,selected:fa});if(ga!==false&&this.isIndexFooter(this.index))ga=false;if(ga!==false)this.parent.select(ea);},buildResults:function(ea){this.list=m.addClass(this.parent.buildResults(ea),"_21c");return this.list;},animateHeight:function(){if(this.items.length==this.animateCount){var ea=x.getViewportDimensions().x;if(this.animateWidth!=ea){this.animateWidth=ea;this.recalculateScrollableArea();}return;}if(this.list&&m.shown(this.list)){this.animateCount=this.items.length;var fa=Math.min(x.getElementDimensions(this.list).y,this.calculateMaxAllowableHeight());this.animation&&this.animation.stop();this.animation=new h(this.scroller).to('height',fa).duration(ba).ease(q.makePowerOut(5)).ondone(this.recalculateScrollableArea.bind(this)).go();}},calculateMaxAllowableHeight:function(){var ea=x.getViewportDimensions().y,fa=y.getTop()||48,ga=56,ha=Math.max(this.minResults,Math.floor((ea-fa-25)/ga)-1)+1;return ha*ga+(ga/4);},render:function(ea,fa,ga,ha,ia){this.inform('filter',{results:fa,value:ea,isScrollable:ia});if(this.loading)fa.push({uid:'search',node:this.footer,structure:new z(),search:true});var ja=fa[0];if(ha){this.showWarning(w._("There are no results for '{query}'.",{query:ea.toString()}));}else if(ja&&ja.results_set_type===ca){if(!ja.error_info.suppress)this.showWarning(ja.error_info.errorMessage||"This search isn't currently supported.");}else this.hideWarning();if(this.inform('removeUnimplementedGrammar')!==false)fa=fa.filter(function(ka){return ka.results_set_type!==ca;}.bind(this));this.parent.render(ea,fa,ga);this.renderFooter();this.animateHeightThrottled();},showWarning:function(ea){m.show(this.warningNode);p.setContent(this.warningNode,ea);this.warningShown=true;this.highlight(-1,false);},hideWarning:function(){m.hide(this.warningNode);this.warningShown=false;this.highlight(this.index,false);},recalculateScrollableArea:function(){t.set(this.scroller,'width',x.getElementDimensions(this.element).x+'px');this.scrollableArea.resize();this.scrollableArea.poke();},setLoading:function(ea){this.loading=ea;this.renderFooter();},scrollTo:function(ea){ea&&this.scrollableArea.scrollIntoView(ea,true);},renderFooter:function(){m.conditionShow(this.throbber,this.loading);m.conditionShow(this.footer,this.loading);if(this.loading){this.inform('showingFooter');}else this.inform('hidingFooter');},isIndexFooter:function(ea){var fa=this.results[ea];return fa&&fa.node==this.footer;},first:function(){this.index=this.autoSelect?0:-1;this.highlight(this.index);},prev:function(){if(this.index<=0)this.index=this.items.length;if(this.isIndexFooter(this.index-1))this.index-=1;this.parent.prev();},next:function(){if(this.index+1>=this.items.length)this.index=-1;if(this.isIndexFooter(this.index+1))this.index=-1;this.parent.next();},highlight:function(ea,fa){fa=fa!==false&&(this.index!=ea);if(!fa||this.inform('beforeHighlight')!==false){var ga=this.warningShown||!this.autoSelect?-1:0;this.parent.highlight(Math.max(ga,ea),fa);}},createFooter:function(){return p.create('li',{className:"_3su hidden_elem"},this.throbber);}});e.exports=da;});
__d("FacebarFaviconAnimation",["$","Animation","BrowseMouse","CSS","csx","DOM","Event","Style","SubscriptionsHandler","copyProperties"],function(a,b,c,d,e,f){var g=b('$'),h=b('Animation'),i=b('BrowseMouse'),j=b('CSS'),k=b('csx'),l=b('DOM'),m=b('Event'),n=b('Style'),o=b('SubscriptionsHandler'),p=b('copyProperties');function q(r){this._core=r.getCore();this._blueBar=g('blueBar');this._pageLogo=l.find(g('pageLogo'),'a');this._searchIcon=l.find(g('blueBar'),"._585_");this._mouseStopBar=false;this._mouseOverLogo=false;this._focusInput=false;this._showingSearch=false;this._animation=null;this._handler=new o();i.init();}p(q.prototype,{enable:function(){i.makeTarget(this._blueBar);i.makeTarget(this._pageLogo);this._handler.addSubscriptions(i.onMouseOver(this._blueBar,function(){this._mouseStopBar=true;this._update();}.bind(this),true),i.onMouseOut(this._blueBar,function(){this._mouseStopBar=false;this._update();}.bind(this),true),i.onMouseOver(this._pageLogo,function(){this._mouseStopLogo=true;this._update();}.bind(this),true),m.listen(this._pageLogo,'mouseover',function(){this._mouseOverLogo=true;this._update();}.bind(this)),m.listen(this._pageLogo,'mouseout',function(){this._mouseOverLogo=false;this._mouseStopLogo=false;this._update();}.bind(this)),this._core.subscribe('focus',function(){this._focusInput=true;this._update();}.bind(this)),this._core.subscribe('blur',function(){this._focusInput=false;this._update();}.bind(this)));},disable:function(){this._handler.release();},_update:function(){var r=this._showingSearch?this._mouseStopLogo:this._mouseOverLogo;if(!r&&(this._mouseStopBar||this._focusInput)){this._showSearch();}else this._showFavicon();},_showSearch:function(){this._core.inform('faviconHide');this._showingSearch=true;this._animate(this._pageLogo,this._searchIcon,function(){j.addClass(document.body,'searchIconShowing');});},_showFavicon:function(){this._core.inform('faviconShow');this._showingSearch=false;this._animate(this._searchIcon,this._pageLogo,function(){j.removeClass(document.body,'searchIconShowing');});},_animate:function(r,s,t){this._fade(r,0,function(){t();this._fade(s,1);}.bind(this));},_fade:function(r,s,t){this._animation&&this._animation.stop();var u=n.get(r,'opacity'),v=Math.abs(s-Number(u))*150;if(v<10){n.set(r,'opacity',s);t&&t();return;}this._animation=new h(r).to('opacity',s).ondone(function(){this._animation=null;t&&t();}.bind(this)).duration(v).go();}});e.exports=q;});
__d("FacebarTypeaheadTypeNamedX",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=3,i={browse_type_user:'user',browse_type_page:'page',browse_type_place:'place',browse_type_group:'group',browse_type_application:'app'},j=1,k=2;function l(){}g(l.prototype,{buildTypeNamedXBuckets:function(m,n,o){var p={};m.forEach(function(u,v){var w=u.render_type||u.type;if(p[w]===undefined)p[w]={index:v,matchCount:0};if(u.text.toLowerCase().indexOf(o.toLowerCase())>=0)p[w].matchCount++;});var q=[],r=0,s=[];n.forEach(function(u){var v=i[u.results_set_type];if(p[v]!==undefined&&p[v].matchCount>=j&&r<k){q.push([u,p[v].index]);r++;}else s.push(u);});q.sort(function(u,v){return u[1]-v[1];});var t=q.map(function(u){return u[0];});return [t,s];},replaceResults:function(m,n,o,p){var q=[];for(var r=0;r<n.length;r++){var s=0,t=-1;m.forEach(function(w,x){if(m[x].cost!==undefined&&m[x].cost>s){t=x;s=m[x].cost;}});if(t>=0){q.push(m[t]);m.splice(t,1);}}var u=m.length;while(u>0&&(m[u-1].type=='websuggestion'))u--;if(o)this.decorateBrowseResults(n,q,p);for(var v=0;v<n.length;v++){m.splice(u,0,n[v]);u++;}return q;},decorateBrowseResults:function(m,n,o){var p=n.slice();p.push.apply(p,o);var q={};p.forEach(function(r){var s=r.render_type||r.type;if(q[s]===undefined)q[s]=[];q[s].push(r);});m.forEach(function(r){var s=i[r.results_set_type],t=[];if(q[s]!==undefined)q[s].forEach(function(u){if(u.photo!==undefined&&u.text!==undefined)t.push({photo:u.photo,subtext:u.text});});t.length=Math.min(t.length,h);if(t.length>0)r.entityInfo=t;});}});e.exports=l;});
__d("FacebarTypeaheadBucketResults",["copyProperties","FacebarTypeaheadTypeNamedX","FacebarBrowseSnippetOptions"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('FacebarTypeaheadTypeNamedX'),i=b('FacebarBrowseSnippetOptions');function j(r){return r.type=='grammar'&&!r.isSeeMore;}function k(r){return r.type=='websuggestion'&&!r.isSeeMore;}function l(r){return !!r.isSeeMore;}function m(r,s){var t={unimplemented:[],grammar:[],websuggestions:[],entity:[],seeMore:[]};r.forEach(function(u,v){var w;if(l(u)){w=t.seeMore;}else if(k(u)){w=t.websuggestions;}else if(u.results_set_type==='unimplemented'){w=t.unimplemented;}else if(s||j(u)){w=t.grammar;}else w=t.entity;u.bucketing={originalIndex:v,bucketIndex:w.length};w.push(u);});return t;}function n(r){var s=[],t={};r.forEach(function(v,w){var x=v.render_type||v.type;if(t[x]===undefined){t[x]=[];s.push(x);}t[x].push(v);});var u=[];s.forEach(function(v){u.push.apply(u,t[v]);});return u;}function o(r,s,t,u,v,w,x,y,z,aa){z.forceToBottom=!aa;var ba=[w,v,u,z];ba.sort(function(ia,ja){if(!ia||ia.forceToBottom||ia.length===0){return 1;}else if(!ja||ja.forceToBottom||ja.length===0){return -1;}else return ia[0].cost-ja[0].cost;});r.length=0;ba.forEach(function(ia){Array.prototype.push.apply(r,ia);});var ca=new h(),da=ca.buildTypeNamedXBuckets(u,x,t),ea=da[0],fa=da[1],ga=i.enabled,ha=ca.replaceResults(r,ea,ga,y);ha.push.apply(ha,fa);fa=ha;if(s)r.push.apply(r,fa);}function p(r,s,t,u,v){var w=[],x=[];r.forEach(function(ca){if(ca.unusedEntity===true){w.push(ca);}else x.push(ca);});r.length=0;r.push.apply(r,x);var y=m(r,u),z=y.grammar,aa=y.entity,ba=y.unimplemented;aa=n(aa);o(r,s,t,aa,z,ba,y.seeMore,w,y.websuggestions.slice(0),v);}function q(r){this._typeahead=r;this._enabled=false;}g(q.prototype,{enable:function(){this._enabled=true;this._mixGrammarAndEntity=!!this._typeahead.getData().mixGrammarAndEntity;this._allowWebSuggOnTop=!!this._typeahead.getData().allowWebSuggOnTop;this._typeahead.view.subscribe('filter',function(r,s){if(s.value.isEmptyOrWhitespace())return;this._enabled&&p(s.results,s.isScrollable,s.value.toString(),this._mixGrammarAndEntity,this._allowWebSuggOnTop);}.bind(this));},disable:function(){this._enabled=false;}});e.exports=q;});
__d("FacebarTypeaheadDecorateEntities",["arrayContains","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('arrayContains'),h=b('copyProperties'),i=b('emptyFunction');function j(n){var o=[];n.forEach(function(p){if(p.isType('ent'))o.push(p.getUID());});return o;}function k(n,o){var p=null;n.structure.forEach(function(q){if(q.isType('ent')&&!g(o,q.getUID()))p=q;});return p;}function l(n,o,p){n.forEach(function(q){var r=k(q,o);q.decoration={entity:r&&p.getEntryForFragment(r)};});}function m(n){this._typeahead=n;}h(m.prototype,{enable:function(){this._typeahead.view.subscribe('filter',function(n,o){l(o.results,j(this._typeahead.core.getValue()),this._typeahead.data);}.bind(this));},disable:i});e.exports=m;});
__d("FacebarTypeaheadDisambiguateResults",["FacebarDisambiguationDialog","FacebarStructuredFragment","FacebarStructuredText","URI","copyProperties","emptyFunction","getObjectValues"],function(a,b,c,d,e,f){var g=b('FacebarDisambiguationDialog'),h=b('FacebarStructuredFragment'),i=b('FacebarStructuredText'),j=b('URI'),k=b('copyProperties'),l=b('emptyFunction'),m=b('getObjectValues');function n(w,x){var y={};w.forEach(function(ba){if(ba.type=='grammar'){var ca=x(ba.structure).toLowerCase();y[ca]=y[ca]||[];y[ca].push(ba);}});var z=[];for(var aa in y)if(y[aa].length>1)z.push(y[aa]);return z;}function o(w){var x=[];w.toArray().forEach(function(y,z){if(y.isType('ent'))x.push(z);});return x;}function p(w,x,y){var z={},aa={},ba={};x.forEach(function(da){var ea=w[0].structure.getFragment(da),fa=ea.getHash();aa[fa]=aa[fa]||[];ba[da]=aa[fa];w.forEach(function(ga){var ha=ga.structure.getFragment(da),ia=ha&&ha.getUID();if(ia&&!z.hasOwnProperty(ia)){aa[fa].push(y.getEntryForFragment(ha));z[ia]=true;}});});for(var ca in ba)if(ba[ca].length<=1)delete ba[ca];return ba;}function q(w,x){var y={},z=[];w.forEach(function(aa){var ba=aa.structure.getFragment(x).getUID();if(!y.hasOwnProperty(ba)){y[ba]=z.length;z.push([]);}z[y[ba]].push(aa);});return z;}function r(w,x,y){var z=w.shift();z.ambiguity.entities=x;y.push.apply(y,w);return z;}function s(w,x){var y=[],z=[],aa=false;w.forEach(function(ca){ca.ambiguity={fragment:null,entities:null,text:null};});n(w,function(ca){return ca.getHash();}).forEach(function(ca){var da=ca[0].structure,ea=o(da),fa=p(ca,ea,x);if(aa){r(ca,fa,y);return;}var ga=ea.pop();if(typeof ga=='number'){var ha=q(ca,ga);aa=ha.length>1;if(aa)delete fa[ga];ha.forEach(function(ia){var ja=r(ia,fa,y);if(aa){var ka=ja.structure.getFragment(ga).getUID();ja.ambiguity.entity=x.getEntry(ka);z.push(ja);}});}});y.forEach(function(ca){var da=w.indexOf(ca);da!=-1&&w.splice(da,1);});n(w,function(ca){return ca.toString();}).forEach(function(ca){ca.forEach(function(da){if(!da.ambiguity.entities)da.ambiguity.text=da.queryTypeText;});});var ba=w.indexOf(z[0]);z.slice(1).forEach(function(ca){var da=w.indexOf(ca);if(da!=-1&&da!=++ba){w.splice(da,1);w.splice(ba,0,ca);}});}function t(w,x){var y=w&&w.ambiguity&&w.ambiguity.entities,z=y&&Object.keys(y).map(Number),aa=x.core.input;if(!z||z.length===0)return false;var ba=function(ea){x.core.executeQuery(u(w,z,ea));},ca=function(){aa.focus();aa.input.moveSelectionToEnd();},da=new g(m(y),w.uri.getPath(),ba,ca,x.getCore().getSessionID());aa.blur();da.show();return true;}function u(w,x,y){var z=w.structure.toArray(),aa=j(w.uri),ba=aa.getPath().split('/');x.forEach(function(ca){var da=z[ca],ea=y.shift(),fa=ba.indexOf(String(da.getUID()));if(fa!=-1)ba[fa]=ea.uid;z[ca]=new h({uid:ea.uid,text:ea.text,type:'ent:'+ea.type});});return {uri:aa.setPath(ba.join('/')),structure:new i(z)};}function v(w){this._typeahead=w;}k(v.prototype,{enable:function(){this._typeahead.view.subscribe('filter',function(w,x){s(x.results,this._typeahead.data);}.bind(this));this._typeahead.view.subscribe('beforeSelect',function(w,x){return !t(x.selected,this._typeahead);}.bind(this));},disable:l});e.exports=v;});
__d("FacebarTypeaheadNavigation",["Arbiter","FacebarNavigation","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('FacebarNavigation'),i=b('copyProperties'),j=b('emptyFunction');function k(l){this._core=l.core;this._preserveQuery=false;this._typeahead=l;}i(k.prototype,{enable:function(){h.registerBehavior(this);this._core.subscribe('execute',this.executedUserQuery.bind(this));this._core.subscribe('change',this.changeUserQuery.bind(this));},disable:j,executedUserQuery:function(l,m){if(m.type!=='somethingnew_mystery')this._preserveQuery=true;},changeUserQuery:function(){this._navigatedQuery=false;},pageTransition:function(){if(!this._preserveQuery){this._core.close();this._core.reset();}else this._preserveQuery=false;},setPageQuery:function(l){l=this._core.setPageQuery(l);this._typeahead.inform('navigation',l,g.BEHAVIOR_PERSISTENT);}});e.exports=k;});
__d("FacebarTypeaheadQuickSelect",["copyProperties","FacebarStructuredText","URI"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('FacebarStructuredText'),i=b('URI'),j='/search/web/direct_search.php?q=';function k(l){this._core=l.getCore();this._view=l.getView();this._input=this._core.input;this._beforeSelectListener=null;this._quickSelectListener=null;}g(k.prototype,{enable:function(){this._beforeSelectListener=this._view.subscribe('beforeSelect',this._quickSelect.bind(this));this._quickSelectListener=this._view.subscribe('quickSelect',this._quickSelect.bind(this));},_quickSelect:function(l,m){if(m&&m.selected&&m.selected.uid!=='search')return true;var n=this._input.getValue().toArray(),o=new h(n),p=o.toString();if(!p)return true;var q=j+escape(p),r={input_query:p,type:'quickselect',text:p,position:0,with_mouse:0,semantic:'uri(path('+q+'))',extra_uri_params:{source:'quickselect',sid:this._core.getSessionID()},uri:new i(q)};this._core.inform('quickSelectRedirect',r);this._core.executeQuery(r);return false;},disable:function(){this._beforeSelectListener&&this._view.unsubscribe(this._beforeSelectListener);this._quickSelectListener&&this._view.unsubscribe(this._quickSelectListener);}});e.exports=k;});
__d("FacebarTypeaheadRecorderBasic",["Arbiter","FacebarTypeaheadRecorder","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('FacebarTypeaheadRecorder'),i=b('copyProperties');function j(k){this._typeahead=k;}i(j.prototype,{_subscription:null,enable:function(){var k=this._typeahead;this._subscription=k.subscribe('init',function(l,m){var n=new h(k);k.inform('recorder',n,g.BEHAVIOR_PERSISTENT);});},disable:function(){this._typeahead.unsubscribe(this._subscription);this._subscription=null;}});e.exports=j;});
__d("FacebarTypeaheadSeeMore",["copyProperties","CSS","cx","DOM","FacebarStructuredText","tx"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('CSS'),i=b('cx'),j=b('DOM'),k=b('FacebarStructuredText'),l=b('tx');function m(n){this._core=n.getCore();this._view=this._core.view;this._moreBar=null;this._isOpen=false;}g(m.prototype,{enable:function(){this._subscriptions=[this._core.subscribe('close',this._close.bind(this)),this._view.subscribe('filter',this._buildSeeMore.bind(this)),this._view.subscribe('beforeSelect',this._beforeSelect.bind(this)),this._view.subscribe('next',this._scrollView.bind(this)),this._view.subscribe('prev',this._scrollView.bind(this)),this._view.subscribe('showingFooter',this._footerShow.bind(this)),this._view.subscribe('hidingFooter',this._footerHide.bind(this))];},disable:function(){while(this._subscriptions.length)this._subscriptions.pop().unsubscribe();},_beforeSelect:function(n,event){if(!event.selected||event.selected.node!==this._moreBar)return true;this._view.first();this._core.expandView();return false;},_buildSeeMore:function(n,event){var o=event.results;if(o.length===0||event.isScrollable||event.value.toString().trim()=="")return;if(o.length<this._view.maxResults){var p=o.some(function(r){return r.type!=='websuggestion';});if(!p)return;}else if(o.length>this._view.maxResults+1){this._isOpen=true;return;}var q="See More";this._isOpen=false;this._moreBar=j.create('li',{className:"_70_ calltoaction"},q);this._moreBar.setAttribute('aria-label',q);o.push({uid:'search',node:this._moreBar,structure:new k(),search:true});},_close:function(){if(this._isOpen){this._core.collapseView();this._isOpen=false;}return true;},_footerHide:function(){if(this._moreBar){h.show(this._moreBar);this._view.animateCount=-1;this._view.animateHeightThrottled();}return true;},_footerShow:function(){this._moreBar&&h.hide(this._moreBar);return true;},_scrollView:function(n,o){if(this._isOpen)this._view.scrollTo(o);return true;}});e.exports=m;});
__d("FacebarTypeaheadSelectAll",["copyProperties","requestAnimationFrame"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('requestAnimationFrame');function i(j){this._core=j.getCore();this._listener=null;}g(i.prototype,{enable:function(){var j=this._core.input;this._listener=this._core.subscribe('focus',function(){h(function(){var k=j.getValue().toArray()[0];if(k&&k.isType('ent','websuggestion')){j.selectInput(k.getLength());}else j.selectInput();}.bind(this));}.bind(this));},disable:function(){this._listener&&this._core.unsubscribe(this._listener);}});e.exports=i;});
__d("FacebarTypeaheadShortcut",["KeyEventController","Run","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('KeyEventController'),h=b('Run'),i=b('copyProperties'),j=b('emptyFunction');function k(l){this._input=l.core.input;this._view=l.view;this._listener=null;}i(k.prototype,{enable:function(){this._registerListener();},disable:j,_registerListener:function(){g.registerKey('SLASH',this._handleKeydown.bind(this));h.onLeave(function(){this._registerListener.bind(this).defer();}.bind(this));},_handleKeydown:function(l){this._view.setAutoSelect(true);this._input.focus();this._input.inform('shortcut',{shift:l.getModifiers().shift});return false;}});e.exports=k;});
__d("FacebarTypeaheadSizeAdjuster",["copyProperties","createArrayFrom","clip","emptyFunction","Style","Vector"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('createArrayFrom'),i=b('clip'),j=b('emptyFunction'),k=b('Style'),l=b('Vector'),m=12,n=20,o=50,p=200,q=5;function r(s){this._core=s.getCore();this._view=this._core.view;this._input=this._core.input;this._cachedSizes={};this._appliedSize=null;this._defaultSize=this.getDefaultFontSize();this._calculatedSize=this._defaultSize;this._containerWidth=this.getContainerWidth();}g(r.prototype,{enable:function(){this._input.subscribe('change',this.adjustFontSize.bind(this));this.adjustFontSize();},disable:j,getContainerWidth:function(){return l.getElementDimensions(this._input.getElement()).x;},getDefaultFontSize:function(){var s=k.get(this._input.getElement(),'font-size'),t=/^([\d\.]+)px$/.exec(s),u=t&&Number(t[1]);return Math.max(m,Math.min(n,u));},calculateFontSize:function(){var s=this.getTextWidth(),t=this._calculatedSize;if(s>this._containerWidth-o){t--;}else if(s<this._containerWidth-p)t++;this._calculatedSize=i(t,m,this._defaultSize);return this._calculatedSize;},getTextWidth:function(){var s=this._calculatedSize+this.getValueKey();if(!this._cachedSizes.hasOwnProperty(s))this._cachedSizes[s]=this.measureTextWidth();return this._cachedSizes[s];},getValueKey:function(){var s=this._core.getValue().getHash(),t=q*Math.floor(s.length/q);return s.substr(0,t);},measureTextWidth:function(){var s=0,t=this._input.getRawInputElement().childNodes;h(t).forEach(function(u){s+=l.getElementDimensions(u).x;});return s;},adjustFontSize:function(){for(var s=0;s<10;s++){var t=this.calculateFontSize();if(t!=this._appliedSize){this._appliedSize=t;k.set(this._input.getElement(),'font-size',t+'px');k.set(this._view.content,'font-size',t+'px');}else break;}}});e.exports=r;});
__d("FacebarTypeaheadSponsoredResults",["Arbiter","copyProperties","FacebarStructuredText","FacebarURI","FacebarResultStoreUtils","TypeaheadSearchSponsoredUtils"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('FacebarStructuredText'),j=b('FacebarURI'),k=b('FacebarResultStoreUtils'),l=b('TypeaheadSearchSponsoredUtils'),m={};function n(u,v,w,x,y){var z=u[v],aa=h(null,z);aa.isSponsored=true;aa.s_message=x.s_message;aa.s_token=x.s_token;u[v]=aa;if(v<w)return;if(v>w)u.splice(w,0,u.splice(v,1)[0]);}function o(u,v,w){u.splice(w,0,v);}function p(u){return 'cost' in u;}function q(u){return u.removable===true;}function r(u,v,w){if(w.rerankingStrategy!=6)return;if(u.length>0)u[0].score=-1*u[0].cost;var x=l.getTopAdPosition(u,v,w),y=l.buildResultIndices(u);for(var z=v.length-1;z>=0;z--){var aa=v[z],ba=y[aa.selected_target_id];if(aa.setSMessage)aa=aa.setSMessage(u[ba]);if(l.isSelfPromoted(aa)){n(u,ba,x,aa,w);}else o(u,aa,x);y=l.buildResultIndices(u);}}function s(u){this._typeahead=u;this._data=u.getData();this._enabled=false;this._sponsoredResults={};this._organicECPM=null;this._hiddenAds=null;this._dialog=null;}s.setAuctionOptions=function(u){h(m,u);};function t(u,v,w){var x=u.filter(p),y={};for(var z=0;z<x.length;z++)y[x[z].uid]=z;x.sort(function(fa,ga){return fa.cost-ga.cost;});var aa={},ba=x.map(function(fa){if(fa.s_categories)aa[fa.uid]=fa.s_categories;return String(fa.uid);}),ca=null;for(z=x.length-1;z>=0;--z)if(!q(x[z])){ca=String(x[z].uid);break;}var da=l.selectAds(ba,aa,v,w,ca);if(da.length===0)return da;var ea=da.filter(function(fa){return !l.isSelfPromoted(fa);}).length;x.splice(w.maxNumberResultsAndAds-ea).map(function(fa){return y[fa.uid];}).sort(function(fa,ga){return ga-fa;}).forEach(function(fa){u.splice(fa,1);});return da;}s.runAuction=function(u,v,w,x){if(u.length===0)return [];var y=l.prepareAndSortAds(u,v,w),z=t(u,y,x);if(z.length===0)return y;r(u,z,x);return y;};s.Ad=function(){};h(s.prototype,{enable:function(){this._enabled=true;g.subscribe('TypeaheadSearchSponsored/hideAdResult',function(u,v){this._hiddenAds=this._hiddenAds||{};this._hiddenAds[v.uid]=true;this._dialog=v.reason_dialog;this._forceRefreshResults();}.bind(this));g.subscribe('TypeaheadSearchSponsored/undoHideAdResult',function(u,v){this._hiddenAds&&delete this._hiddenAds[v.uid];this._dialog&&this._dialog.hide();this._dialog=null;this._forceRefreshResults();}.bind(this));this._typeahead.data.subscribe('beginFetchHandler',function(u,v){this._processResponse(u,v.response);}.bind(this));this._typeahead.data.subscribe('response_received',this._processResponse.bind(this));this._typeahead.view.subscribe('filter',function(u,v){if(v.value.isEmptyOrWhitespace())return;l.setOrganicECPM(this._organicECPM,v.results);var w=v.results.filter(p),x=v.results.length,y=[];for(var z=0;z<x;z++){var aa=v.results[z];if(this._sponsoredResults[aa.uid]){var ba=this._sponsoredResults[aa.uid];for(var ca in ba)y.push(ba[ca].s_token);}}var da=w.length;if(v.isScrollable)da+=m.maxNumberAds;s.setAuctionOptions({maxNumberResultsAndAds:Math.max(da,(this._typeahead.data&&this._typeahead.data._maxResults)||m.maxNumberResultsAndAds)});var ea=s.runAuction(v.results,this._sponsoredResults,this._hiddenAds,m);this._typeahead.data.inform('debug_facebar_typeahead_sponsored',{options:m,query:v.value.toString(),results:v.results,original_organic:w,ads_in_auction:ea});this._typeahead.inform('record_after_reorder',{s_organic_results:w,s_candidate_tokens:y,s_count:v.results.length-x,s_bootstrap_id:0,s_options:m,s_variant:m.rerankingStrategy});}.bind(this));this._dataSubscriptions=[];},disable:function(){this._enabled=false;},_forceRefreshResults:function(){if(this._data&&this._data.value)this._data.respond(this._data.value,this._data.buildUids(this._data.value));},_processResponse:function(u,v){if(!this._enabled||!v.payload||!v.payload.s_entries)return;v.payload.s_entries.forEach(function(w){var x=new s.Ad();h(x,w);h(x,k.processEntityResult(w.type,w.uid,w.text,0));x.isSponsored=true;x.uri=j.getURI(this.facebarConfig,x);x.structure=i.fromStruct(x.structure);var y=x.s_target;if(!this._sponsoredResults[y])this._sponsoredResults[y]={};this._sponsoredResults[y][x.uid]=x;}.bind(this));if(v.payload.organic_s_value)this._organicECPM=h(this._organicECPM,v.payload.organic_s_value);}});e.exports=s;});
__d("FacebarTypeaheadTourItem",["Class","cx","DOM","copyProperties","FacebarTypeaheadItem"],function(a,b,c,d,e,f){var g=b('Class'),h=b('cx'),i=b('DOM'),j=b('copyProperties'),k=b('FacebarTypeaheadItem');function l(m){this.parent.construct(this,m);}g.extend(l,k);j(l.prototype,{renderIcon:function(){return i.create('span',{className:"_k83"},i.create('span',{className:"_4c7a"}));}});e.exports=l;});
__d("FacebarTypeaheadTour",["event-extensions","Arbiter","AsyncRequest","BrowseNUXController","copyProperties","FacebarStructuredText","FacebarTypeaheadTourItem","tx"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('AsyncRequest'),i=b('BrowseNUXController'),j=b('copyProperties'),k=b('FacebarStructuredText'),l=b('FacebarTypeaheadTourItem'),m=b('tx');function n(o){this._core=o.getCore();this._view=this._core.view;this._moreBar=null;this._events=[];this._subscriptions=[];this._item={uid:'tour',uri:'#',structure:k.fromString("Take the tour")};}j(n.prototype,{enable:function(){this._subscriptions=[g.subscribe('BrowseNUX/initialized',this._initEvents.bind(this)),g.subscribe('BrowseNUX/starting',this._removeEvents.bind(this)),g.subscribe('BrowseNUX/finished',this._initEvents.bind(this))];},disable:function(){while(this._subscriptions.length)this._subscriptions.pop().unsubscribe();},_initEvents:function(){this._events=[this._view.subscribe('filter',this._addTour.bind(this)),this._view.subscribe('beforeSelect',this._beforeSelect.bind(this))];this._core.requery();},_removeEvents:function(){while(this._events.length)this._events.pop().unsubscribe();this._core.requery();},_isNullState:function(){return this._core.input.getValue().isEmpty();},_addTour:function(o,event){var p=event.results;if(p.length===0||!this._isNullState())return;var q=new l(this._item);q.setShouldRenderEducation(false);this._moreBar=q.render();var r=p.length;while(--r>=0)if(p[r].removable===true)break;p.splice(r+1,0,j(this._item,{node:this._moreBar}));},_beforeSelect:function(o,event){if(event.selected.node===this._moreBar){i.showSearchBarTour();return false;}new h('/ajax/browse/nux_addquery.php').send();return true;}});e.exports=n;});
__d("FacebarTypeaheadTrigger",["copyProperties","Arbiter"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('Arbiter');function i(j){this._typeahead=j;this._core=j.getCore();this._subscription=null;}g(i.prototype,{enable:function(){this._subscription=h.subscribe('FacebarTrigger/select',this._activateTrigger.bind(this));},disable:function(){h.unsubscribe(this._subscription);},_activateTrigger:function(j,k){var l=g({type:'grammar',uri:null,structure:null},k);if(!l.uri){this._core.open();this._core.setQuery(l,false);}else this._core.executeQuery(l);}});e.exports=i;});
__d("FacebarTypeaheadBrowseItem",["Class","CSS","cx","DOM","copyProperties","FacebarTypeaheadItem","FacebarTypeaheadToken","TypeaheadFacepile","FacebarBrowseSnippetOptions","fbt"],function(a,b,c,d,e,f){var g=b('Class'),h=b('CSS'),i=b('cx'),j=b('DOM'),k=b('copyProperties'),l=b('FacebarTypeaheadItem'),m=b('FacebarTypeaheadToken'),n=b('TypeaheadFacepile'),o=b('FacebarBrowseSnippetOptions'),p=b('fbt');function q(r){this.parent.construct(this,r);this.addClass("_207");}g.extend(q,l);k(q.prototype,{renderIcon:function(){var r=this._result.entityInfo;if(o.showFacepile&&r!==undefined){var s=r.map(function(u){return u.photo;});if(s.length>=2){var t=n.render(s);h.addClass(t,"_51l_");return t;}}return j.create('span',{className:"_k83"},j.create('span',{className:this._result.icon_class}));},renderSubtext:function(){var r=[],s=this._result.entityInfo;if(s!==undefined)r=s.map(function(v){return v.subtext;});if(r.length){var t="More...";r.push(t);var u=new m(r).separateMainText(false);if(o.inlineSubtext){u.setLeadingMiddot(true);this.setVAlign(false);}return u.render();}}});e.exports=q;});
__d("FacebarTypeaheadGrammarItem",["Class","cx","DOM","copyProperties","FacebarTypeaheadItem","FacebarTypeaheadToken","FacebarTypeaheadEntityToken","tx"],function(a,b,c,d,e,f){var g=b('Class'),h=b('cx'),i=b('DOM'),j=b('copyProperties'),k=b('FacebarTypeaheadItem'),l=b('FacebarTypeaheadToken'),m=b('FacebarTypeaheadEntityToken'),n=b('tx');function o(p){this.parent.construct(this,p);this.addClass("_207");}g.extend(o,k);j(o.prototype,{renderIcon:function(){if(this._result.photo)return i.create('img',{className:"_20h",alt:'',src:this._result.photo});return i.create('span',{className:"_k83"},i.create('span',{className:this._result.icon_class}));},renderSubtext:function(){var p=this._result.decoration,q=this._result.ambiguity,r=q&&q.text,s=(p&&p.entity)||(q&&q.entity);if(r){return new l([r]).render();}else if(s){this.setVAlign(false);return new m(s).setDefaultText('user',"Person").setLeadingMiddot(true).setLimit(2).render();}}});e.exports=o;});
__d("FacebarTypeaheadSomethingNewItem",["Class","copyProperties","FacebarTypeaheadGrammarItem","FacebarTypeaheadToken"],function(a,b,c,d,e,f){var g=b('Class'),h=b('copyProperties'),i=b('FacebarTypeaheadGrammarItem'),j=b('FacebarTypeaheadToken');function k(l){this.parent.construct(this,l);this.setShouldRenderEducation(this._result.type=='somethingnew_grammar');}g.extend(k,i);h(k.prototype,{renderSubtext:function(){if(this._result.type=='somethingnew_grammar'){this.setVAlign(false);return new j([' \u00B7 Suggested']).render();}}});e.exports=k;});
__d("FacebarTypeaheadSponsoredEntityItem",["ReactDOM","AsyncRequest","Bootloader","Class","copyProperties","CSS","cx","DOM","emptyFunction","Event","HTML","FacebarTypeaheadEntityItem","FacebarTypeaheadToken","tx","TypeaheadSearchSponsored"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('Bootloader'),i=b('Class'),j=b('copyProperties'),k=b('CSS'),l=b('cx'),m=b('DOM'),n=b('emptyFunction'),o=b('Event'),p=b('HTML'),q=b('FacebarTypeaheadEntityItem'),r=b('FacebarTypeaheadToken'),s=b('tx'),t=b('TypeaheadSearchSponsored'),u='\u00B7';function v(w){this.parent.construct(this,w);this.addClass("_20e");}i.extend(v,q);j(v.prototype,{renderSubtext:function(){var w=this._result,x=w.category;if(w.category.__html)x=m.getText(p(x).getRootNode());var y=[];y.push(s._("Sponsored {category}",{category:x}));y.push(this.getHideLink());return new r(y).render();},render:function(){var w=this.parent.render();k.addClass(w,"_55y_");return w;},getHideLink:function(){var w=m.create('a',{className:"_a0s",href:'#',title:"Hide the ad"},'\u2715');o.listen(w,'click',this.hideSponsoredResult.bind(this));return w;},renderText:function(){var w=this.parent.renderText();w.push(this.getSponsoredMessage());return w;},getSponsoredMessage:function(){if(this._result.s_message)return m.create('span',{className:"_a0t"},[' '+u+' ',this._result.s_message]);return [];},hideSponsoredResult:function(event){t.hideAdResult(this._result.uid);h.loadModules(['AdsHidePoll','Dialog'],function(w,x){var y=new x().setModal(true).setTitle("Ad was hidden").setButtons(x.CLOSE);new w(y.getBody(),this._result.s_token).setShowTitle(false).setUndoHandler(function(){t.undoHideAdResult(this._result.uid);y.hide();}.bind(this)).renderAsync(function(){y.show();});}.bind(this));new g('/ajax/ads/hide').setData({action:'hide',impression:this._result.s_token}).setMethod('post').setHandler(n).send();}});e.exports=v;});
__d("FacebarTypeaheadWebSuggestionItem",["Class","cx","DOM","copyProperties","FacebarTypeaheadItem","FacebarTypeaheadToken"],function(a,b,c,d,e,f){var g=b('Class'),h=b('cx'),i=b('DOM'),j=b('copyProperties'),k=b('FacebarTypeaheadItem'),l=b('FacebarTypeaheadToken'),m={EXACT_MATCH:1,BING:2,BING_POPULAR:3,WEBSUGGESTIONS_AS_KEYWORDS:4},n="_57q5";function o(p){this.parent.construct(this,p);this.addClass("_207");}g.extend(o,k);j(o.prototype,{renderIcon:function(){return i.create('span',{className:"_k83"},i.create('span',{className:"_6-a"}));},renderSubtext:function(){if(this._result.isLockedWebSearchMode)return;var p,q;p=this._result.websuggestion_source;var r=p===m.WEBSUGGESTIONS_AS_KEYWORDS?'Search':p===m.BING_POPULAR?"Popular Web Search":"Web Search";q=new l([r],n);return q.render();}});e.exports=o;});
__d("FacebarTypeaheadRenderer",["FacebarTypeaheadEntityItem","FacebarTypeaheadBrowseItem","FacebarTypeaheadGrammarItem","FacebarTypeaheadWebSuggestionItem","FacebarTypeaheadSponsoredEntityItem","FacebarTypeaheadSomethingNewItem"],function(a,b,c,d,e,f){var g=b('FacebarTypeaheadEntityItem'),h=b('FacebarTypeaheadBrowseItem'),i=b('FacebarTypeaheadGrammarItem'),j=b('FacebarTypeaheadWebSuggestionItem'),k=b('FacebarTypeaheadSponsoredEntityItem'),l=b('FacebarTypeaheadSomethingNewItem'),m={};function n(p){if(p.isSponsored){return new k(p);}else if(p.type=='websuggestion'){return new j(p);}else if(p.type=='grammar'){if(p.isSeeMore===true){return new h(p);}else return new i(p);}else if(p.type=='somethingnew_mystery'||p.type=='somethingnew_grammar'){return new l(p);}else return new g(p);}function o(p){var q=!p.fetchType&&!p.isSponsored&&!p.isLockedWebSearchMode,r=p.uid,s=q&&m[r];if(!s){var t=n(p);this.inform('renderingItem',{item:t,result:p});s=t.render();q=q&&t.cacheable();}if(q){m[r]=s;return s.cloneNode(true);}else return s;}e.exports=o;});